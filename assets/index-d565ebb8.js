var ie=Object.defineProperty;var oe=(s,t,n)=>t in s?ie(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n;var O=(s,t,n)=>(oe(s,typeof t!="symbol"?t+"":t,n),n);import{X as le,j as e,B as k,S as U,r as h,d as M,C as j,f as Y,L as T,a as q,b as _,c as ce,e as de,F as R,g as w,I as P,h as me,i as ue,k as he,A as X,l as pe,u as fe,R as te,M as g,m as Z,n as J,o as xe,p as ye,q as je,s as ne,H as ge,t as ve,v as F,N as C,w as G,x as we,y as Se,z as ke}from"./vendor-1a3c4621.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(r){if(r.ep)return;r.ep=!0;const l=n(r);fetch(r.href,l)}})();const be={$id:"/Player",type:"object",required:["id","name"],properties:{id:{type:"number"},name:{type:"string"},present:{type:"boolean"}}},Ce={$id:"/Game",type:"object",anyOf:[{required:["id","stage","round","n","p1id"]},{required:["id","stage","round","n","p2id"]}],properties:{id:{type:"number"},stage:{type:"string",enum:["seed","elim"]},round:{type:"number"},n:{type:"number"},p1id:{type:"number"},p2id:{type:"number"},p1points:{type:"number"},p2points:{type:"number"},p1twenties:{type:"number"},p2twenties:{type:"number"}}};class Ne extends le{constructor(){super("crokinole-tourney");O(this,"players");O(this,"games");this.version(1).stores({players:"++id, name",games:"++id, stage, match, p1id, p2id"})}async anyData(){return!!(await this.players.count()||await this.games.count())}async reset(n){n||await m.players.clear(),await m.games.clear()}async replace(n){const{players:a,games:r=[]}=n;await m.games.clear(),await m.players.bulkPut(a),await m.games.bulkPut(r)}}const m=new Ne;const K=s=>{const{working:t,children:n}=s,a=s.disabled||t;let r=(s.className||"")+" btn-working";t&&(r+=" working");const l={...s,disabled:a,className:r};return delete l.children,delete l.working,e.jsxs(k,{...l,children:[e.jsx("span",{children:n}),e.jsx("span",{className:"spinner",children:e.jsx(U,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"})})]})},E=s=>s>0?Array.from(Array(Math.floor(s)).keys()):[],ae=(s,t,n)=>Math.min(Math.max(t,s),n),D=s=>{let t=s.length;for(;t>0;){const n=Math.floor(Math.random()*t--);[s[t],s[n]]=[s[n],s[t]]}return s};function Me(s,...t){let n;return typeof t[0]=="function"&&(n=t.shift()),t.forEach(a=>{const r=n?s.findIndex(l=>n(l,a)):s.indexOf(a);r>=0&&(s=s.splice(r,1))}),s}const Re=["Joey Tribbiani","Rachel Green","Monica Geller","Phoebe Buffay","Chandler Bing","Ross Geller","Fraiser Crane","Niles Crane","Daphne Moon","Roz Doyle","Martin Crane","Jerry Seinfeld","George Costanza","Elain Benes","Cosmo Kramer","Fran Fine","Max Sheffield","C.C. Babcock","Niles","Maggie Sheffield","Brighton Sheffield","Gracie Sheffield","Will Truman","Grace Adler","Karen Walker","Jack McFarland","Carrie Bradshaw","Charlotte York","Miranda Hobbes","Samantha Jones","Homer Simpson","Marge Simpson","Bart Simpson","Lisa Simpson","Maggie Simpson","Ned Flanders","Moe Szyslak","Seymour Skinner","Apu Nahasapeemapetilon","Barney Gumble","Clancy Wiggum","Kent Brockman","Jim Kirk","Spock","Montgomery Scott","Leonard McCoy","Nyota Uhura","Hikaru Sulu","Pavel Chekov","Jean-Luc Picard","William Riker","Geordi La Forge","Tasha Yar","Worf","Beverly Crusher","Diana Troi","Data","Wesley Crusher","Christopher Pike","Christine Chapel","La'an Noonien-Singh","Erica Ortegas","Joseph M'Benga","Una Chin-Riley","Clark Kent","Louis Lane","Jimmy Olsen","Perry White","Lex Luthro","Lana Lang","Vicki Vale","Luke Charles","Heracles Panhellenios","Dane Whitman","Victor Shade","Clint Barton","Peter Parker","Bruce Banner","Steve Rogers","Pietro Maximoff","Thor Odinson","Janet Van Dyne","Hank Pym","Tony Stark","Wanda Maximoff","Carol Danvers","Bucky Barnes","Natasha Romanoff","Sam Wilson","Steven Strange","Jessica Jones","Trish Walker","Maria Hill","Ben Grimm","Matt Murdock","Susan Storm","Reed Richards","Amadeus Cho","Jimmy Howlett","Nick Fury","Phil Coulson","Hubert Wolfeschlegelsteinhausenbergerdorff"],Ae=async(s,t=0)=>{const n=D(Re).slice(0,s).map((a,r)=>({name:a,present:r>=t}));return m.players.bulkAdd(D(n))},ee=(s,t)=>n=>n.p1id==s.id&&n.p2id==t.id||n.p1id==t.id&&n.p2id==s.id,Pe=(s,t)=>{for(let n=0;n<s.length;n+=2){let a=t.find(ee(s[n],s[n+1])),r=n+2;for(;a!=null&&r<s.length;)[s[n+1],s[r]]=[s[r],s[n+1]],a=t.find(ee(s[n],s[n+1])),r+=1}},Q=(s,t,n=!0,a=!1)=>{let l,i,o,c;const d=s==null||t==null;if(n){const u=s>t?.75:s==null?0:1;l=i=0,o=c=0;for(let p=0;p<4;p++)if(!d&&Math.random()<.02){l+=1,i+=1;const f=Math.floor(Math.random()*5);o+=f,c+=f}else if(Math.random()<u){if(l+=2,!d){const f=Math.floor(Math.random()*5);o=f,c=Math.floor(Math.random()*f)}}else if(i+=2,!d){const f=Math.floor(Math.random()*5);c=f,o=Math.floor(Math.random()*f)}if(a&&l==i&&o==c){const p=Math.floor(Math.random()*5);Math.random()<.5?(l+=2,o+=p,c+=Math.floor(Math.random()*p)):(i+=2,c+=p,o+=Math.floor(Math.random()*p))}}return{p1points:l,p2points:i,p1twenties:o,p2twenties:c}},$=(s,t)=>{if(t.length==0)return D(s);const n={};return t.forEach(a=>{if(a.p1id!=null){const r=n[a.p1id]=n[a.p1id]||{points:0,twenties:0};r.points+=a.p1points||0,r.twenties+=a.p1twenties||0}if(a.p2id!=null){const r=n[a.p2id]=n[a.p2id]||{points:0,twenties:0};r.points+=a.p2points||0,r.twenties+=a.p2twenties||0}}),s.sort((a,r)=>{const l=a.id==null?Number.NEGATIVE_INFINITY:a.id,i=r.id==null?Number.NEGATIVE_INFINITY:r.id,o=n[l]||{points:0,twenties:0},c=n[i]||{points:0,twenties:0};return o.points>c.points?-1:o.points<c.points?1:o.twenties>c.twenties?-1:o.twenties<c.twenties?1:0}),s},Le=async(s,t)=>{s=Math.max(0,s);const{randomScores:n=!1}=t||{};let a=await m.games.filter(o=>o.stage=="seed"&&o.round===s).toArray();const r=await m.players.filter(o=>!!o.present).toArray(),l=a.filter(o=>o.p1points!=null||o.p2points!=null);if(l.length>0&&l.forEach(o=>Me(r,(c,d)=>c.id==d,o.p1id,o.p2id)),r.length%2!=0&&r.push({name:"bye"}),s===0)D(r);else{const o=await m.games.filter(c=>c.stage=="seed"&&c.round<s).toArray();$(r,o),Pe(r,o)}const i=a.filter(o=>o.p1points==null&&o.p2points==null);await m.games.bulkDelete(i.map(o=>o.id)),a=l;for(let o=0;o<r.length;o+=2){const c=r[o].id,d=r[o+1].id,{p1points:u,p2points:p,p1twenties:f,p2twenties:v}=Q(c,d,n);a.push({stage:"seed",round:s,n:o/2,p1id:c,p2id:d,p1points:u,p2points:p,p1twenties:f,p2twenties:v})}return m.games.bulkAdd(a)},V=s=>{if(s.p1id==null)return s.p2id;if(s.p2id==null||s.p1points>s.p2points)return s.p1id;if(s.p1points<s.p2points)return s.p2id;if(s.p1twenties>s.p2twenties)return s.p1id;if(s.p1twenties<s.p2twenties)return s.p2id},Ie=async(s,t,n)=>{const{randomScores:a=!1,removeExisting:r=!1}=n||{},l=await m.games.filter(o=>o.stage=="elim"&&o.round>=s).toArray();if(l.length>0)if(r)await m.games.bulkDelete(l.map(o=>o.id));else throw new Error(`games for elimination round ${s} already exist`);const i=[];if(s==0){const o=await m.games.filter(d=>d.stage=="seed").toArray();let c=await m.players.filter(d=>!!d.present).toArray();c.length%2!=0&&c.push({name:"bye"}),$(c,o),c=c.slice(0,t);for(let d=0;d<c.length/2;d++){const u=c[d].id,p=c[c.length-1-d].id,{p1points:f,p2points:v,p1twenties:b,p2twenties:N}=Q(u,p,a,!0);i.push({stage:"elim",round:s,n:d,p1id:u,p2id:p,p1points:f,p2points:v,p1twenties:b,p2twenties:N})}}else{const c=(await m.games.filter(d=>d.stage=="elim"&&d.round==s-1).toArray()).reduce((d,u)=>{const p=V(u);return p!=null&&d.push(p),d},[]);for(let d=0;d<c.length;d+=2){const u=c[d],p=c[d+1],{p1points:f,p2points:v,p1twenties:b,p2twenties:N}=Q(u,p,a,!0);i.push({stage:"elim",round:s,n:d,p1id:u,p2id:p,p1points:f,p2points:v,p1twenties:b,p2twenties:N})}}return m.games.bulkAdd(i)},B=({done:s,icon:t,doneIcon:n,iconColor:a="var(--bs-gray-400)",doneIconColor:r="var(--bs-success)",children:l})=>e.jsxs("div",{className:"d-flex m-1 align-items-center",children:[e.jsx(R,{style:{minWidth:"1.5em"},size:"2x",icon:s!=!0?t:n||t,color:s?r:a})," ",s==!0?e.jsx("del",{children:l}):e.jsx("span",{children:l})]}),Be=()=>{const[s,t]=h.useState(!1),n=M.useLiveQuery(async()=>{const d=await m.players.toArray(),u=await m.games.toArray(),p=x=>x.p1points==null||x.p2points==null,f=u.filter(x=>x.stage=="elim"&&x.round==0),v=Math.floor(Math.log2(f.length)),b=u.filter(x=>x.stage=="seed"&&x.round==0),N=u.filter(x=>x.stage=="elim"&&x.round==v-1),L=u.find(x=>x.stage=="elim"&&x.round==v);return{anyplayers:d.length>0,anypresent:d.find(x=>!!x.present)!=null,seedzerodone:b.length>0&&b.find(p)==null,semifinaldone:N.length>0&&N.find(p)==null,finaldone:L!=null&&!p(L)}}),{anyplayers:a=!1,anypresent:r=!1,seedzerodone:l=!1,semifinaldone:i=!1,finaldone:o=!1}=n||{};if(!n)return e.jsx(U,{});const c=async()=>{t(!0),setTimeout(()=>t(!1),1e3),Ae(20,5).then(()=>E(4).forEach(d=>{Le(d,{randomScores:!0})})).then(()=>E(3).forEach(d=>{const u=Math.pow(2,3-d);Ie(d,u,{randomScores:u>2})}))};return e.jsxs("div",{className:"get-started",children:[e.jsxs("h1",{className:"w-100 text-center mt-3 mb-3",children:["Welcome to ",e.jsx("b",{children:"Crokinole Tourney"})]}),e.jsxs("div",{className:"d-flex gap-3 flex-wrap justify-content-center",children:[e.jsx(j,{children:e.jsx(j.Body,{children:e.jsxs("div",{children:["Just 6 easy steps!",e.jsxs(B,{done:a,icon:Y,children:["1. Add player names to the ",e.jsx(T,{to:"/players",children:"Players"})," tab."]}),e.jsxs(B,{done:r,icon:Y,children:["2. Register players as present on the ",e.jsx(T,{to:"/players",children:"Players"})," tab."]}),e.jsxs(B,{done:l,icon:q,doneIcon:_,children:["3. Score seed stage games on the ",e.jsx(T,{to:"/matches",children:"Matches"})," tab."]}),e.jsxs(B,{icon:ce,children:["4. View rankings of seed stage on the ",e.jsx(T,{to:"/rankings",children:"Rankings"})," tab."]}),e.jsxs(B,{done:i,icon:q,doneIcon:_,children:["5. Score elimination stage games on the ",e.jsx(T,{to:"/matches",children:"Matches"})," tab."]}),e.jsx(B,{done:o,icon:de,doneIconColor:"var(--bs-orange)",children:"6. Score the final game!"})]})})}),a?void 0:e.jsx(j,{children:e.jsxs(j.Body,{children:[e.jsxs("div",{className:"text-center",children:["To see how it all works, use a ",e.jsx("i",{children:"demo tournament"})," to add random players and game scores, then score the final game!",e.jsx("br",{})]}),e.jsx("div",{className:"mt-3 text-center",children:e.jsx(K,{working:s,onClick:c,children:"Demo Tournament"})})]})})]})]})},Ee=()=>e.jsx(e.Fragment,{children:e.jsx(Be,{})});function Te(s){const t=h.useRef(null),n=h.useCallback(a=>{t.current&&!t.current.contains(a.target)&&s()},[s]);return h.useEffect(()=>(document.addEventListener("click",n,!0),()=>document.removeEventListener("click",n,!0)),[n]),t}const Fe=s=>{const t=s.player,[n,a]=h.useState((t==null?void 0:t.name)||""),r=y=>{a(y),t&&m.players.update(t.id,{name:y.trim()})},l=!!s.present,i=y=>{t&&m.players.update(t.id,{present:y})},o=()=>i(!l),d=(M.useLiveQuery(()=>m.players.where("name").equalsIgnoreCase(n.trim()).count(),[n])||0)<=1,p=(M.useLiveQuery(async()=>{const y=await m.games.where("p1id").equals((t==null?void 0:t.id)||-1).count(),I=await m.games.where("p2id").equals((t==null?void 0:t.id)||-1).count();return y+I},[t==null?void 0:t.id])||0)>0,[f,v]=h.useState(!1),b=async()=>{(t==null?void 0:t.id)!=null&&(f?await m.players.delete(t.id):v(!0))},N=Te(()=>{v(!1)}),L=f?"danger":"outline-secondary",x=f?e.jsx(e.Fragment,{children:"Remove Player"}):e.jsx(R,{icon:ue}),H=t&&!n.trim()||!d,S=n.trim()?"Duplicate player name":"Player name is empty";return e.jsx(w,{className:"player-input",onSubmit:y=>y.preventDefault(),children:e.jsxs(P,{children:[e.jsx(P.Text,{children:e.jsx(w.Check,{type:"switch",checked:l,onChange:o})}),e.jsx(w.Control,{type:"text",placeholder:"Player name",value:n,onChange:y=>r(y.target.value),isInvalid:H}),e.jsx(w.Control.Feedback,{tooltip:!0,type:"invalid",children:S}),p?e.jsx(P.Text,{className:"lock",children:e.jsx(R,{icon:me})}):e.jsx(k,{ref:N,variant:L,onClick:b,onBlur:()=>v(!1),children:x})]})})};const Ge=()=>{const[s,t]=h.useState(""),[n,a]=h.useState(!1),r=()=>a(!n),i=(M.useLiveQuery(()=>m.players.where("name").equalsIgnoreCase(s.trim()).count(),[s])||0)==0,o=u=>{u.preventDefault(),s.trim()&&m.players.add({name:s.trim(),present:n}).then(()=>t(""))},c=!i,d="Duplicate player name";return e.jsx(w,{onSubmit:o,className:"add-player-input",children:e.jsxs(P,{children:[e.jsx(P.Text,{children:e.jsx(w.Check,{type:"switch",checked:n,onChange:r})}),e.jsx(w.Control,{type:"text",placeholder:"Player name",value:s,onChange:u=>t(u.target.value),isInvalid:c}),e.jsx(w.Control.Feedback,{tooltip:!0,type:"invalid",children:d}),e.jsx(k,{type:"submit",children:"Add Player"})]})})},De=()=>{const[s,t]=h.useState(!1),n=()=>t(!s),a=M.useLiveQuery(async()=>s?await m.players.orderBy("name").toArray():await m.players.toArray(),[s])||[],r=a.length?!a.find(i=>!i.present):!1,l=async()=>{a.forEach(i=>m.players.update(i.id,{present:!r}))};return e.jsx("div",{className:"players",children:e.jsxs("div",{className:"d-grid mt-4 gap-2",children:[e.jsxs("div",{className:"tool-bar",children:[e.jsx(w.Check,{id:"all-present",style:{marginLeft:"17px"},disabled:!a.length,type:"switch",checked:r,onClick:l,label:"All players present"}),e.jsx(k,{size:"sm",variant:"link",className:s?"active":"inactive",onClick:n,children:e.jsx(R,{size:"xl",icon:he})})]}),e.jsx("div",{className:"d-flex flex-wrap gap-2",children:a.map(i=>e.jsx(Fe,{player:i,present:i.present},i.id))}),e.jsx(Ge,{})]})})};const $e=({eventKey:s,children:t,callback:n})=>{const{activeEventKey:a}=h.useContext(pe),r=a===s,l=fe(s,()=>n&&n(s));return e.jsx(j.Header,{as:"button",className:`accordion-button h5${r?"":" collapsed"}`,onClick:l,"aria-expanded":r,children:t})},se=({title:s,children:t})=>e.jsx(X,{defaultActiveKey:"0",children:e.jsxs(j,{children:[e.jsx($e,{eventKey:"0",children:s}),e.jsx(X.Collapse,{eventKey:"0",children:t})]})}),z=h.createContext({seedrounds:4,setSeedrounds:s=>{},log2elimplayers:3,setLog2elimplayers:s=>{}});const ze=s=>Math.ceil(Math.log2(s)),We=({nplayers:s,className:t})=>{const{seedrounds:n,setSeedrounds:a}=h.useContext(z),r=1,l=s==null?4:ze(s);return h.useEffect(()=>{s!=null&&a(i=>ae(i,r,l))},[s,r,l,a]),e.jsx(te,{className:t,value:n,size:"sm",onChange:i=>a(Number.parseInt(i.target.value)),min:r,max:l,tooltipPlacement:"top"})};const re=({p1:s,p2:t})=>{const[n,a]=h.useState(!1),r=!s&&!t,l="outline-secondary",i=q,o=s?s.name:"",c=t?t.name:"";return e.jsxs("div",{className:"game-control",children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsxs("div",{className:"p1",children:[o," ",""]})}),e.jsx("div",{children:e.jsxs("div",{className:"p2",children:[c," ",""]})})]}),e.jsx(k,{variant:l,size:"sm",className:"round",disabled:r,children:e.jsx(R,{icon:i,size:"xl"})}),e.jsxs(g,{show:n,onHide:()=>a(!1),children:[e.jsxs(g.Header,{children:[o," v. ",c]}),e.jsx(g.Body,{})]})]})};const He=({round:s,players:t,games:n})=>{n.filter(l=>l.round==s-1);const a=n.filter(l=>l.round==s),r=t.length/2;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"seed-round-title",children:["Round ",s+1]}),e.jsx("div",{className:"seed-round d-flex flex-wrap gap-2 justify-content-center",children:E(r).map(l=>{const i=a.find(d=>d.n==l),o=i?t.find(d=>d.id==(i==null?void 0:i.p1id)):void 0,c=i?t.find(d=>d.id==(i==null?void 0:i.p2id)):void 0;return e.jsx(re,{g:i,p1:o,p2:c},l)})})]})},Oe=({nrounds:s,players:t,games:n})=>e.jsx(Z,{className:"seed-stage","data-bs-theme":"dark",interval:null,children:E(s).map(a=>e.jsx(Z.Item,{children:e.jsx(He,{round:a,players:t,games:n})},a))}),qe=s=>Math.pow(2,Math.trunc(Math.log2(s))),Je=({nplayers:s,className:t})=>{const{log2elimplayers:n,setLog2elimplayers:a}=h.useContext(z),r=1,l=s==null?3:Math.log2(qe(s));return h.useEffect(()=>{s!=null&&a(i=>ae(i,r,l))},[s,r,l,a]),e.jsx(te,{className:t,value:n,size:"sm",onChange:i=>a(Number.parseInt(i.target.value)),min:r,max:l,tooltipLabel:i=>Math.pow(2,i).toString(),tooltipPlacement:"top"})};const Ke=({player:s})=>e.jsx("div",{className:"winner-wrapper",children:e.jsx("div",{className:`winner${s?"":" empty"}`,children:s==null?void 0:s.name})}),Qe=({round:s,players:t,games:n})=>{const a=t.length/Math.pow(2,s+1),r=n.filter(l=>l.round==s);return e.jsx("div",{className:"elim-round",children:E(a).map(l=>{const i=r.find(d=>d.n==l),o=i?t.find(d=>d.id==(i==null?void 0:i.p1id)):void 0,c=i?t.find(d=>d.id==(i==null?void 0:i.p2id)):void 0;return e.jsx(re,{g:i,p1:o,p2:c},l)})})},Ve=({players:s,games:t})=>{let n=0;for(let a=s.length;a>1;a/=2)n++;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:`elim-stage elim-${Math.pow(2,n)}`,children:[E(n).map(a=>e.jsx(Qe,{round:a,players:s,games:t},a)),e.jsx(Ke,{player:void 0})]})})},Ue=()=>{const s=M.useLiveQuery(async()=>await m.players.filter(o=>!!o.present).toArray())||[],t=M.useLiveQuery(async()=>await m.games.where("stage").equals("seed").toArray())||[],n=M.useLiveQuery(async()=>await m.games.where("stage").equals("elim").toArray())||[],{seedrounds:a,log2elimplayers:r}=h.useContext(z),l=Math.pow(2,r),i=$(s,t).slice(0,l);return e.jsxs("div",{className:"matches d-grid gap-4 mt-4",children:[e.jsx(se,{title:"Seed Stage",children:e.jsxs(e.Fragment,{children:[e.jsx(j.Body,{className:"pt-0 pb-0",children:e.jsx(We,{nplayers:s.length})}),e.jsx(j.Body,{children:e.jsx(Oe,{nrounds:a,players:s,games:t})})]})}),e.jsx(se,{title:"Elimination Stage",children:e.jsxs(e.Fragment,{children:[e.jsx(j.Body,{className:"pt-0 pb-0",children:e.jsx(Je,{nplayers:s.length})}),e.jsx(j.Body,{children:e.jsx(Ve,{players:i,games:n})})]})})]})};const Ye=({rank:s,player:t,games:n})=>{let a=0,r=0;const l=n.reduce((i,o)=>{if(o.p1id==t.id){a+=o.p1points||0,r+=o.p1twenties||0;const c=V(o);c==t.id?i.push("win"):c!=null?i.push("loss"):i.push("draw")}else if(o.p2id==t.id){a+=o.p2points||0,r+=o.p2twenties||0;const c=V(o);c==t.id?i.push("win"):c!=null?i.push("loss"):i.push("draw")}return i},[]);return e.jsx(J.Item,{children:e.jsxs("div",{className:"rank-item",children:[e.jsx("div",{className:"rank",children:s+1}),e.jsx("div",{className:"name",children:t.name}),e.jsx("div",{className:"record",children:l.map(i=>e.jsx("span",{className:i,children:i.charAt(0).toUpperCase()}))}),e.jsx("div",{className:"points",children:a}),e.jsx("div",{className:"twenties",children:r})]})})},_e=()=>{const s=M.useLiveQuery(async()=>{const a=await m.players.filter(l=>!!l.present).toArray(),r=await m.games.where("stage").equals("seed").toArray();return $(a,r),{players:a,games:r}});if(s==null)return e.jsx(U,{});const{players:t,games:n}=s;return e.jsxs(J,{className:"rankings mt-3",children:[e.jsx(J.Item,{children:e.jsxs("div",{className:"rank-item-header",children:[e.jsx("div",{className:"rank",children:"Rank"}),e.jsx("div",{className:"name",children:"Name"}),e.jsx("div",{className:"record",children:"Record"}),e.jsx("div",{className:"points",children:"Points"}),e.jsx("div",{className:"twenties",children:"20s"})]})}),t.map((a,r)=>e.jsx(Ye,{rank:r,player:a,games:n},a.id))]})},Xe=({show:s,onHide:t,keepPlayers:n,setKeepPlayers:a,onConfirm:r})=>e.jsxs(g,{show:s,onHide:t,children:[e.jsxs(g.Body,{children:[e.jsx("div",{className:"text-center mb-2",children:e.jsx(R,{color:"var(--bs-warning)",size:"5x",icon:xe})}),"Do you want to reset the tournament — removing all",n?"":" player names, "," games, scores, and rankings?"]}),e.jsx(g.Body,{children:e.jsx(w.Check,{type:"checkbox",checked:n,onClick:()=>a(!n),label:"Keep player names",id:"keep-players"})}),e.jsxs(g.Footer,{children:[e.jsx(k,{onClick:r,children:"Yes, Reset It"}),e.jsx(k,{variant:"dark",onClick:t,children:"No, Keep It"})]})]}),Ze=({anyData:s})=>{const[t,n]=h.useState(!1),[a,r]=h.useState(!0),l=o=>{o&&r(!0),n(o)},i=async()=>{await m.reset(a),l(!1)};return e.jsxs(j,{className:"text-center",border:"danger",children:[e.jsx(j.Header,{children:"Danger Zone"}),e.jsx(j.Body,{children:e.jsxs(j.Text,{className:"text-start d-flex gap-4 align-items-center",children:[e.jsx("span",{children:e.jsx(k,{className:"text-nowrap",disabled:!s,variant:"danger",onClick:()=>l(!0),children:s?"Reset Tournament":"No Tournament Data"})}),e.jsxs("span",{children:[e.jsx("i",{children:"Warning!"})," Resetting the tournament will remove all player names, game match-ups, scores, and ranking."]})]})}),e.jsx(Xe,{show:t,onHide:()=>l(!1),keepPlayers:a,setKeepPlayers:r,onConfirm:i})]})},es=({show:s,onHide:t,onConfirm:n})=>e.jsxs(g,{show:s,onHide:t,children:[e.jsxs(g.Body,{children:[e.jsx("div",{className:"text-center mb-2",children:e.jsx(R,{color:"var(--bs-gray)",size:"5x",icon:ye})}),"Do you want to restore a previously saved tournament, replacing the current one? All current player names, games, scores, and rankings will be lost."]}),e.jsxs(g.Footer,{children:[e.jsx(k,{onClick:n,children:"Yes, Replace It"}),e.jsx(k,{variant:"dark",onClick:t,children:"No, Keep It"})]})]}),ss={type:"object",required:["players"],properties:{players:{type:"array",items:{$ref:"/Player"},minItems:1},games:{type:"array",items:{$ref:"/Game"}}}},W=new je;W.addSchema(be,"/Player");W.addSchema(Ce,"/Game");const ts=W.compile(ss),ns=s=>{const t=s;if(!ts(t))throw new Error(W.errorsText());const{players:n,games:a}=t;if(!a)return;const r=new Set,l=c=>{if(r.has(c))return!0;const d=n==null?void 0:n.find(u=>u.id===c);return d&&r.add(d.id),!!d},i=[],o=new Set;if(a.forEach((c,d)=>{c.p1id&&!o.has(c.p1id)&&!l(c.p1id)&&(o.has(c.p1id)||i.push(`instance.games[${d}].p1id is not found in instance.players`),o.add(c.p1id)),c.p2id&&!o.has(c.p2id)&&!l(c.p2id)&&(o.has(c.p2id)||i.push(`instance.games[${d}].p2id is not found in instance.players`),o.add(c.p2id))}),o.size>0)throw new Error(i.map((c,d)=>`${d}: ${c}`).join(`
`))},as=({show:s,onHide:t,details:n})=>e.jsxs(g,{show:s,onHide:t,children:[e.jsxs(g.Body,{className:"text-center",children:[e.jsx("div",{className:"pb-2",children:e.jsx(R,{color:"var(--bs-red)",size:"5x",icon:ne})}),"The chosen file could not be restored. See details below."]}),n?e.jsx(g.Body,{children:e.jsx("pre",{className:"text-wrap",children:n})}):void 0,e.jsx(g.Footer,{children:e.jsx(k,{variant:"dark",onClick:t,children:"Ok, I'll try another file"})})]}),rs=({show:s,onHide:t})=>e.jsxs(g,{show:s,onHide:t,children:[e.jsxs(g.Body,{className:"text-center",children:[e.jsx("div",{className:"pb-2",children:e.jsx(R,{color:"var(--bs-red)",size:"5x",icon:ne})}),"There is no tournament data to save.",e.jsx("br",{}),"Enter some players and try again."]}),e.jsx(g.Footer,{children:e.jsx(k,{variant:"dark",onClick:t,children:"Ok, I get it"})})]}),is=({anyData:s})=>{const[t,n]=h.useState(!1),[a,r]=h.useState("crokinole-tourney.json"),[l,i]=h.useState(!1),[o,c]=h.useState(),[d,u]=h.useState(!1),[p,f]=h.useState(),[v,b]=h.useState(!1),N=async S=>{if(S.preventDefault(),!s){b(!0);return}n(!0),setTimeout(()=>n(!1),1e3);const y=document.createElement("a"),I=await m.players.toArray(),A=await m.games.toArray();y.href=window.URL.createObjectURL(new Blob([JSON.stringify({players:I,games:A},null,2)])),y.setAttribute("download",a),document.body.appendChild(y),y.click()},L=()=>{if(!o)return;u(!1),i(!0),setTimeout(()=>i(!1),1e3);const S=new FileReader;S.onload=y=>{var I;try{const A=JSON.parse((I=y.target)==null?void 0:I.result);ns(A),m.replace(A)}catch(A){f(A==null?void 0:A.toString())}},S.readAsText(o)},x=async S=>{S.preventDefault(),o!=null&&(s?u(!0):L())},H=S=>{const y=S.target;y.files&&c(y.files[0])};return e.jsxs(j,{className:"text-center",children:[e.jsxs(j.Header,{children:["Save and Restore",e.jsx("div",{style:{color:"var(--bs-gray)",fontSize:"smaller",fontStyle:"italic"},children:"All data is stored locally and is never uploaded to a server."})]}),e.jsxs(j.Body,{className:"d-flex flex-column flex-lg-row gap-3 flex-wrap justify-content-lg-stretch",children:[e.jsx(w,{onSubmit:N,className:"flex-lg-grow-1",children:e.jsxs(P,{children:[e.jsx(P.Text,{children:"Save As"}),e.jsx(w.Control,{placeholder:"Filename",value:a,onChange:S=>r(S.target.value),"aria-label":"filename","aria-describedby":"basic-addon"}),e.jsx(K,{working:t,type:"submit",id:"button-addon",children:"Save"})]})}),e.jsx(w,{onSubmit:x,className:"flex-lg-grow-1",children:e.jsxs(P,{children:[e.jsx(w.Control,{type:"file",onChange:H}),e.jsx(K,{working:l,type:"submit",id:"button-addon",children:"Restore"})]})})]}),e.jsx(es,{show:d,onHide:()=>u(!1),onConfirm:L}),e.jsx(as,{show:!!p,onHide:()=>f(void 0),details:p}),e.jsx(rs,{show:v,onHide:()=>b(!1)})]})},os=()=>{const s=M.useLiveQuery(async()=>await m.anyData());return e.jsxs("div",{className:"d-flex mt-4 gap-4 flex-column",children:[e.jsx(is,{anyData:s}),e.jsx(Ze,{anyData:s})]})},ls=({children:s})=>{const[t,n]=h.useState(4),[a,r]=h.useState(3);return e.jsx(z.Provider,{value:{seedrounds:t,setSeedrounds:n,log2elimplayers:a,setLog2elimplayers:r},children:s})};function cs(){return e.jsxs(C,{variant:"tabs",children:[e.jsx(C.Item,{children:e.jsx(C.Link,{as:G,to:"/",children:e.jsx(R,{icon:we})})}),e.jsx(C.Item,{children:e.jsx(C.Link,{as:G,to:"/players",children:"Players"})}),e.jsx(C.Item,{children:e.jsx(C.Link,{as:G,to:"/matches",children:"Matches"})}),e.jsx(C.Item,{children:e.jsx(C.Link,{as:G,to:"/rankings",children:"Ranking"})}),e.jsx(C.Item,{children:e.jsx(C.Link,{as:G,to:"/settings",children:"Settings"})})]})}function ds(){return e.jsx(e.Fragment,{children:e.jsx(ls,{children:e.jsxs(ge,{children:[e.jsx(cs,{}),e.jsxs(ve,{children:[e.jsx(F,{path:"/",element:e.jsx(Ee,{})}),e.jsx(F,{path:"/players",element:e.jsx(De,{})}),e.jsx(F,{path:"/matches",element:e.jsx(Ue,{})}),e.jsx(F,{path:"/rankings",element:e.jsx(_e,{})}),e.jsx(F,{path:"/settings",element:e.jsx(os,{})})]})]})})})}Se.createRoot(document.getElementById("root")).render(e.jsx(ke.StrictMode,{children:e.jsx(ds,{})}));
