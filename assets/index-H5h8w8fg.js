var ra=Object.defineProperty;var ia=(e,t,a)=>t in e?ra(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var le=(e,t,a)=>(ia(e,typeof t!="symbol"?t+"":t,a),a);import{t as la,k as da,r as c,m as s,n as U,L as Oe,N as hs,C as We,p as Ie,q as Ss,v as ca,X as ma,w as Ue,x as K,y as ua,z as fa,F as Rs,A as z,B as pa,R as se,D as ha,E as xa,G as ba,H as ga,I as va,J as wa,K as ja,M as xs,S as ya,O as Na}from"./vendor-nECk2hBg.js";import{d as Cs,e as $s,f as Ts,C as Ps,g as As,h as Ms,i as Es,j as ka,k as Sa,l as Ds,m as Ra,n as Is,o as Ca,p as Ls,q as zs,r as Gs,s as Fs,t as _e,u as Vs,D as $a,v as Bs,w as Os,x as Ta,y as Pa,z as Ws,A as Us,B as Aa,E as _s,F as Hs,G as Ma,H as Js,I as Ea,M as Ks,J as He,K as he,L as xe,N as qs,O as be,P as ge,Q as Ys,R as Da,S as Ia,T as La,U as za,V as Xs,W as Zs,X as Qs,Y as Ga,Z as Fa,_ as Va,a0 as et,a1 as Ba,a2 as Oa,a3 as st,a4 as tt,a5 as Wa,a6 as at,a7 as nt,a8 as ot,a9 as rt,aa as it,ab as lt,ac as Ua,ad as _a,ae as Ha,af as Ja,ag as Ka,ah as qa,ai as Ya,aj as dt,ak as Xa}from"./@radix-ui-kssleYa8.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function a(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=a(o);fetch(o.href,r)}})();function f(...e){return la(da(e))}const Je=e=>e>0?Array.from(Array(Math.floor(e)).keys()):[],ue=e=>{let t=e.length;for(;t>0;){const a=Math.floor(Math.random()*t--);[e[t],e[a]]=[e[a],e[t]]}return e},Le=c.forwardRef(({className:e,children:t,...a},n)=>s.jsxs(Cs,{ref:n,className:f("relative z-10 flex max-w-max flex-1 items-center justify-center",e),...a,children:[t,s.jsx(ct,{})]}));Le.displayName=Cs.displayName;const ze=c.forwardRef(({className:e,...t},a)=>s.jsx($s,{ref:a,className:f("group flex flex-1 list-none items-center justify-center space-x-1",e),...t}));ze.displayName=$s.displayName;const Ae=ka,Za=U("group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50"),Qa=c.forwardRef(({className:e,children:t,...a},n)=>s.jsxs(Ts,{ref:n,className:f(Za(),"group",e),...a,children:[t," ",s.jsx(Ps,{className:"relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180","aria-hidden":"true"})]}));Qa.displayName=Ts.displayName;const en=c.forwardRef(({className:e,...t},a)=>s.jsx(As,{ref:a,className:f("left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",e),...t}));en.displayName=As.displayName;const ct=c.forwardRef(({className:e,...t},a)=>s.jsx("div",{className:f("absolute left-0 top-full flex justify-center"),children:s.jsx(Ms,{className:f("origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",e),ref:a,...t})}));ct.displayName=Ms.displayName;const sn=c.forwardRef(({className:e,...t},a)=>s.jsx(Es,{ref:a,className:f("top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",e),...t,children:s.jsx("div",{className:"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md"})}));sn.displayName=Es.displayName;const Ke=U("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),E=c.forwardRef(({className:e,variant:t,size:a,asChild:n=!1,...o},r)=>{const l=n?Sa:"button";return s.jsx(l,{className:f(Ke({variant:t,size:a,className:e})),ref:r,...o})});E.displayName="Button";const tn=c.forwardRef(({className:e,inset:t,children:a,...n},o)=>s.jsxs(Ds,{ref:o,className:f("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",e),...n,children:[a,s.jsx(Ra,{className:"ml-auto h-4 w-4"})]}));tn.displayName=Ds.displayName;const an=c.forwardRef(({className:e,...t},a)=>s.jsx(Is,{ref:a,className:f("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));an.displayName=Is.displayName;const nn=c.forwardRef(({className:e,sideOffset:t=4,...a},n)=>s.jsx(Ca,{children:s.jsx(Ls,{ref:n,sideOffset:t,className:f("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a})}));nn.displayName=Ls.displayName;const on=c.forwardRef(({className:e,inset:t,...a},n)=>s.jsx(zs,{ref:n,className:f("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...a}));on.displayName=zs.displayName;const rn=c.forwardRef(({className:e,children:t,checked:a,...n},o)=>s.jsxs(Gs,{ref:o,className:f("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:a,...n,children:[s.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:s.jsx(Fs,{children:s.jsx(_e,{className:"h-4 w-4"})})}),t]}));rn.displayName=Gs.displayName;const ln=c.forwardRef(({className:e,children:t,...a},n)=>s.jsxs(Vs,{ref:n,className:f("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[s.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:s.jsx(Fs,{children:s.jsx($a,{className:"h-4 w-4 fill-current"})})}),t]}));ln.displayName=Vs.displayName;const dn=c.forwardRef(({className:e,inset:t,...a},n)=>s.jsx(Bs,{ref:n,className:f("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...a}));dn.displayName=Bs.displayName;const cn=c.forwardRef(({className:e,...t},a)=>s.jsx(Os,{ref:a,className:f("-mx-1 my-1 h-px bg-muted",e),...t}));cn.displayName=Os.displayName;const mn={theme:"system",setTheme:()=>null},un=c.createContext(mn);function fn({children:e,defaultTheme:t="system",storageKey:a="vite-ui-theme",...n}){const[o,r]=c.useState(()=>localStorage.getItem(a)||t);c.useEffect(()=>{const i=window.document.documentElement;if(i.classList.remove("light","dark"),o==="system"){const d=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";i.classList.add(d);return}i.classList.add(o)},[o]);const l={theme:o,setTheme:i=>{localStorage.setItem(a,i),r(i)}};return s.jsx(un.Provider,{...n,value:l,children:e})}function pn({pages:e}){const t="sticky top-0 z-50 flex justify-center w-full shadow-sm backgrop-blur p-1 border-b border-border/40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/40",a="group inline-flex h-9 w-max items-center justify-center font-light rounded-md px-4 py-2 text-sm transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50",n=o=>{if(o.icon)return o.icon;if(o.label=="Players")return s.jsx(We,{strokeWidth:1})};return s.jsxs(s.Fragment,{children:[s.jsx("header",{className:t,children:s.jsxs(Le,{className:"flex w-full justify-center sm:justify-between max-w-2xl",children:[s.jsx(Oe,{to:"/",children:s.jsxs(Ae,{className:f(a,"mx-1 px-1 pr-4 font-bold"),children:[s.jsx("img",{alt:"hand-flick-logo",className:"max-h-6 pr-2",src:"/crokinole-tourney//hand-flick-sticker.svg"}),s.jsx("span",{children:"Crokinole Tourney"})]})}),s.jsx(ze,{className:"bg-none hidden sm:inline",children:e.map(o=>s.jsx(hs,{to:o.path,children:({isActive:r})=>s.jsx(Ae,{className:f(a,{"font-semibold":r}),children:o.label})},o.label))}),void 0]})}),s.jsx("footer",{className:"sm:hidden w-full z-50 flex justify-around text-white bg-sky-800 fixed bottom-0 p-1 font-light",children:s.jsx(Le,{children:s.jsx(ze,{className:"bg-none",children:e.map(o=>s.jsx(hs,{to:o.path,children:({isActive:r})=>s.jsx(Ae,{className:f(a,{"font-semibold":r}),children:n(o)})},o.label))})})})]})}const V=({className:e,...t})=>s.jsx(Oe,{className:f("font-bold rounded hover:underline cursor-pointer border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background",e),...t});function oe({children:e}){return s.jsx("div",{className:"flex w-full justify-center mb-20",children:s.jsx("div",{className:"w-full max-w-2xl",children:e})})}const J=c.forwardRef(({className:e,...t},a)=>s.jsx("div",{ref:a,className:f("rounded-xl border bg-card text-card-foreground shadow",e),...t}));J.displayName="Card";const ve=c.forwardRef(({className:e,...t},a)=>s.jsx("div",{ref:a,className:f("flex flex-col space-y-1.5 p-6",e),...t}));ve.displayName="CardHeader";const we=c.forwardRef(({className:e,...t},a)=>s.jsx("h3",{ref:a,className:f("font-semibold leading-none tracking-tight",e),...t}));we.displayName="CardTitle";const X=c.forwardRef(({className:e,...t},a)=>s.jsx("p",{ref:a,className:f("text-sm text-muted-foreground",e),...t}));X.displayName="CardDescription";const O=c.forwardRef(({className:e,...t},a)=>s.jsx("div",{ref:a,className:f("p-6 pt-0",e),...t}));O.displayName="CardContent";const hn=c.forwardRef(({className:e,...t},a)=>s.jsx("div",{ref:a,className:f("flex items-center p-6 pt-0",e),...t}));hn.displayName="CardFooter";const xn=()=>s.jsxs(oe,{children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("h1",{className:"text-xl font-extrabold my-5",children:"Welcome to Crokinole Tourney!"}),s.jsx("p",{children:"A super-simple way to score Crokinole tournaments."}),s.jsx("img",{className:"inline h-24 my-4",alt:"hand-flick-logo",src:"/crokinole-tourney//hand-flick-sticker.svg"}),s.jsx("p",{children:"Just 3 easy steps."})]}),s.jsxs("div",{className:"flex flex-wrap justify-center",children:[s.jsxs(J,{className:"my-6 w-60 mx-3",children:[s.jsx("div",{className:"relative -top-4 w-full",children:s.jsx("span",{className:"m-auto bg-sky-700 rounded-full text-center text-white font-black block pt-0.5 w-8 h-8 text-xl",children:"1"})}),s.jsxs(O,{className:"text-center text-xl",children:["Start by adding ",s.jsx(V,{to:"/players",children:"Players"})," to the tournament.",s.jsx("div",{className:"w-full flex justify-center mt-4",children:s.jsx(Oe,{to:"/players",children:s.jsx(E,{variant:"ghost",className:"p-0 w-16 h-16",children:s.jsx(We,{size:"3em"})})})})]})]}),s.jsxs(J,{className:"my-6 w-60 mx-3",children:[s.jsx("div",{className:"relative -top-4 w-full",children:s.jsx("span",{className:"m-auto bg-teal-700 rounded-full text-center text-white font-black block pt-0.5 w-8 h-8 text-xl",children:"2"})}),s.jsxs(O,{className:"text-center text-xl",children:["Score the Seed ",s.jsx(V,{to:"/players",children:"Matches"})," to ",s.jsx(V,{to:"/rankings",children:"Rank"})," players.",s.jsxs("div",{className:"w-full flex justify-center items-center mt-4",children:[s.jsx(V,{to:"/matches",children:s.jsx(E,{variant:"ghost",className:"p-0 w-16 h-16",children:s.jsx(Ie,{size:"3em",className:"rotate-90"})})}),s.jsx("span",{className:"-mx-2 z-10 text-black text-2xl",children:"+"}),s.jsx(V,{to:"/rankings",children:s.jsx(E,{variant:"ghost",className:"p-0 w-16 h-16",children:s.jsx(Ss,{size:"3em"})})})]})]})]}),s.jsxs(J,{className:"my-6 w-60 mx-3",children:[s.jsx("div",{className:"relative -top-4 w-full",children:s.jsx("span",{className:"m-auto bg-green-700 rounded-full text-center text-white font-black block pt-0.5 w-8 h-8 text-xl",children:"3"})}),s.jsxs(O,{className:"text-center text-xl",children:["Score the Elimination ",s.jsx(V,{to:"/players",children:"Matches"})," to decide the champion!",s.jsx("div",{className:"w-full flex justify-center items-center mt-4",children:s.jsx(V,{to:"/matches",children:s.jsx(E,{variant:"ghost",className:"p-0 w-16 h-16",children:s.jsx(Ie,{size:"3em",className:"rotate-90"})})})})]})]})]})]}),bn=Aa,mt=c.forwardRef(({className:e,...t},a)=>s.jsx(Ta,{ref:a,className:f("border-b",e),...t}));mt.displayName="AccordionItem";const ut=c.forwardRef(({className:e,children:t,...a},n)=>s.jsx(Pa,{className:"flex",children:s.jsxs(Ws,{ref:n,className:f("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",e),...a,children:[t,s.jsx(Ps,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}));ut.displayName=Ws.displayName;const ft=c.forwardRef(({className:e,children:t,...a},n)=>s.jsx(Us,{ref:n,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...a,children:s.jsx("div",{className:f("pb-4 pt-0",e),children:t})}));ft.displayName=Us.displayName;function je({id:e,title:t,children:a}){const[n,o]=ca(e,!1),r=()=>o(!n);return s.jsx(bn,{className:"pb-2 w-full",type:"single",defaultValue:n?void 0:"item-1",collapsible:!0,onValueChange:r,children:s.jsxs(mt,{value:"item-1",className:"px-2",children:[s.jsx(ut,{children:t}),s.jsx(ft,{className:"grid gap-2",children:a})]})})}const gn=U("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),W=c.forwardRef(({className:e,...t},a)=>s.jsx(_s,{ref:a,className:f(gn(),e),...t}));W.displayName=_s.displayName;const Ge=c.forwardRef(({className:e,...t},a)=>s.jsx(Hs,{className:f("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...t,ref:a,children:s.jsx(Ma,{className:f("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Ge.displayName=Hs.displayName;function qe(e){if(!e.children)return s.jsx(Ge,{...e});const t=e.id||Math.random().toString(36).slice(2);return s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Ge,{...e,id:t}),s.jsx(W,{htmlFor:t,...e.labelProps,children:e.children})]})}const vn=U("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-3",sm:"h-8 px-2",lg:"h-10 px-3"}},defaultVariants:{variant:"default",size:"default"}}),pt=c.forwardRef(({className:e,variant:t,size:a,...n},o)=>s.jsx(Js,{ref:o,className:f(vn({variant:t,size:a,className:e})),...n}));pt.displayName=Js.displayName;class wn extends ma{constructor(){super("crokinole-tourney");le(this,"tournament");le(this,"players");le(this,"games");this.version(1).stores({tournament:"++id, name",players:"++id, name",games:"++id, stage, p1id, p2id"})}async anyData(){return!!(await this.players.count()||await this.games.count())}async allData(){const a=await this.players.toArray(),n=await this.games.toArray();return{players:a,games:n}}async reset(a){a||await w.players.clear(),await w.games.clear()}async replace(a){const{players:n,games:o=[]}=a;await w.games.clear(),await w.players.bulkPut(n),await w.games.bulkPut(o)}}const w=new wn,B=c.forwardRef(({className:e,type:t,...a},n)=>s.jsx("input",{type:t,className:f("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...a}));B.displayName="Input";const jn=U("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Ye({className:e,variant:t,...a}){return s.jsx("div",{className:f(jn({variant:t}),e),...a})}function ht({empty:e,duplicate:t}){const a=t===!0,n=t===void 0,o=e?"empty":t===!0?"duplicate":"possible duplicate";return s.jsx(s.Fragment,{children:a||n?s.jsx(Ye,{className:f("text-center",{"bg-amber-500 hover:bg-amber-400":n}),variant:a?"destructive":void 0,children:o}):void 0})}const re=c.createContext({players:[],nPlayers:0,nPresent:0,findPlayer:()=>{},hasPresentUndo:!1,storePresentUndo:()=>{},retrievePresentUndo:()=>[],shownPlayerProfile:void 0,showPlayerProfile:()=>{},hidePlayerProfile:()=>{}}),xt=({players:e=[],children:t})=>{const a=e.length,n=e.filter(b=>b.present).length,o=b=>b?e==null?void 0:e.find(N=>N.id==b):void 0,r=c.useRef([]),[l,i]=c.useState(!1),[d,m]=c.useState(),p=b=>{const N=b===void 0?void 0:o(b);m(N)},g={players:e,nPlayers:a,nPresent:n,findPlayer:o,hasPresentUndo:l,storePresentUndo:b=>{r.current=[...b.map(N=>({...N}))],i(!!b.length)},retrievePresentUndo:()=>{const b=r.current;return r.current=[],i(!1),b},shownPlayerProfile:d,showPlayerProfile:p,hidePlayerProfile:()=>p(void 0)};return s.jsx(re.Provider,{value:g,children:t})},Y=()=>c.useContext(re);function yn({player:e,isDuplicate:t}){const{showPlayerProfile:a}=Y(),[n,o]=c.useState(e.name||""),[r,l]=c.useState(e.alias||void 0),[i,d]=Ue(e.name||"",250);c.useEffect(()=>{o(e.name),l(e.alias)},[e]);const m=S=>{const D=/^([^ ]*) "([^"]+)" (.*)$/.exec(S);let A,F;D!=null?(A=`${D[1]} ${D[3]}`,F=D[2]):(A=S,F=void 0),o(A),l(F),d(A),e&&w.players.update(e.id,{name:A,alias:F})},p=n.split(" "),u=p.slice(1).join(" "),h=r?`${p[0]} "${r}" ${u}`:n,j=!!e.present,g=S=>{e&&w.players.update(e.id,{present:S})},b=()=>g(!j),N=c.useMemo(()=>t(i,e),[t,i,e]),y=!n.trim(),R=(K(async()=>{const S=await w.games.where("p1id").equals((e==null?void 0:e.id)||-1).count(),M=await w.games.where("p2id").equals((e==null?void 0:e.id)||-1).count();return S+M},[e==null?void 0:e.id])||0)>0,[$,P]=c.useState(!1),G=async()=>{(e==null?void 0:e.id)!=null&&($?await w.players.delete(e.id):P(!0))},x=c.useRef(null);ua(x,()=>P(!1));const v=$?"destructive":"ghost",C=$?"":"text-slate-500",T=$?s.jsx(s.Fragment,{children:"Remove Player"}):s.jsx(Ea,{});return s.jsxs("form",{className:"flex items-center space-x-2 mb-1",onSubmit:S=>S.preventDefault(),children:[s.jsx(qe,{checked:j,onCheckedChange:b}),s.jsxs("div",{className:"w-full max-w-sm relative",children:[s.jsx(B,{className:"pr-9",type:"text",placeholder:"Player name",value:h,onChange:S=>m(S.target.value)}),s.jsx(E,{variant:"ghost",size:"icon",className:"w-8 h-8 rounded-full absolute right-0.5 z-50 inset-y-0.5 text-slate-500 shrink-0 p-2",onClick:()=>a(e.id),children:s.jsx(fa,{strokeWidth:1})})]}),s.jsx("span",{className:"shrink-0",children:R?s.jsx(Ye,{variant:"secondary",className:"text-slate-500 px-1",children:"locked"}):s.jsx(E,{ref:x,variant:v,size:$?void 0:"icon",className:f(C,"mr-[13px] sm:mr-0"),onClick:G,onBlur:()=>P(!1),children:T})}),s.jsx(ht,{empty:y,duplicate:N})]})}const Nn=({isDuplicate:e})=>{const[t,a]=c.useState(""),[n,o]=c.useState(void 0),[r,l]=Ue("",250),i=y=>{const R=/^([^ ]*) "([^"]+)" (.*)$/.exec(y);let $,P;R!=null?($=`${R[1]} ${R[3]}`,P=R[2]):($=y,P=void 0),a($),o(P),l($)},d=t.split(" "),m=d.slice(1).join(" "),p=n?`${d[0]} "${n}" ${m}`:t,[u,h]=c.useState(!0),j=()=>h(!u),g=y=>{y.preventDefault(),t.trim()&&w.players.add({name:t.trim(),present:u}).then(()=>i(""))},b=c.useMemo(()=>e(r),[e,r]),N=b===!0;return s.jsxs("form",{onSubmit:g,className:"flex items-center space-x-2",children:[s.jsx(qe,{checked:u,onCheckedChange:j}),s.jsx(B,{className:"max-w-sm",type:"text",placeholder:"Player name",value:p,onChange:y=>i(y.target.value)}),s.jsx(E,{type:"submit",disabled:N,children:"Add"}),s.jsx(ht,{duplicate:b})]})};function kn(e=250){const[t,a]=c.useState(""),[n,o]=Ue("",e),r=i=>{a(i),o(i)},l=c.useCallback((i,d,m)=>{var h;if(!n.trim())return[i,Number.MAX_SAFE_INTEGER];const p=new Rs(i,{...d,includeScore:!0},m).search(n);let u=(h=p[0])==null?void 0:h.score;return u=u??Number.MAX_SAFE_INTEGER,[p.map(j=>j.item),u]},[n]);return[t,r,l]}var ks;const Sn=(ks=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value"))==null?void 0:ks.set;function bs(e){const t={...e};delete t.divClassName,delete t.onValueChange;const[a,n]=c.useState(""),o=e.value||"";c.useEffect(()=>n(o),[o]);const r=m=>{n(m),e.onValueChange&&e.onValueChange(m)};return s.jsxs("div",{className:f("relative text-sm",e.divClassName),children:[s.jsx("input",{placeholder:"Search...",type:"text",...t,className:f("flex h-7 w-full rounded-full bg-slate-200 hover:bg-slate-100 focus-visible:bg-slate-100 px-7 py-0 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e.className),value:a,onChange:m=>r(m.target.value)}),s.jsx(Ks,{className:"absolute text-muted-foreground left-[0.5rem] top-[0.5rem] pointer-events-none text-sm"}),a&&Sn?s.jsx(E,{onClick:()=>r(""),variant:"ghost",size:"icon",className:"absolute h-5 w-5 rounded-full absolute top-1 right-[0.25rem] text-muted-foreground mx-0 hover:bg-slate-300",children:s.jsx(He,{})}):void 0]})}function Xe({children:e,className:t,...a}){return s.jsx("div",{className:f("w-full sm:x-xl2 grid gap-2 px-2",t),...a,children:e})}const Rn=Da,Cn=Ys,bt=c.forwardRef(({className:e,...t},a)=>s.jsx(he,{className:f("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:a}));bt.displayName=he.displayName;const $n=U("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),gt=c.forwardRef(({side:e="right",className:t,children:a,...n},o)=>s.jsxs(Cn,{children:[s.jsx(bt,{}),s.jsxs(xe,{ref:o,className:f($n({side:e}),t),...n,children:[a,s.jsxs(qs,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[s.jsx(He,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));gt.displayName=xe.displayName;const vt=({className:e,...t})=>s.jsx("div",{className:f("flex flex-col space-y-2 text-center sm:text-left",e),...t});vt.displayName="SheetHeader";const wt=c.forwardRef(({className:e,...t},a)=>s.jsx(be,{ref:a,className:f("text-lg font-semibold text-foreground",e),...t}));wt.displayName=be.displayName;const jt=c.forwardRef(({className:e,...t},a)=>s.jsx(ge,{ref:a,className:f("text-sm text-muted-foreground",e),...t}));jt.displayName=ge.displayName;const Tn=Ys,yt=c.forwardRef(({className:e,...t},a)=>s.jsx(he,{ref:a,className:f("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));yt.displayName=he.displayName;const Pn=c.forwardRef(({className:e,children:t,...a},n)=>s.jsxs(Tn,{children:[s.jsx(yt,{}),s.jsxs(xe,{ref:n,className:f("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...a,children:[t,s.jsxs(qs,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[s.jsx(He,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Pn.displayName=xe.displayName;const An=c.forwardRef(({className:e,...t},a)=>s.jsx(be,{ref:a,className:f("text-lg font-semibold leading-none tracking-tight",e),...t}));An.displayName=be.displayName;const Mn=c.forwardRef(({className:e,...t},a)=>s.jsx(ge,{ref:a,className:f("text-sm text-muted-foreground",e),...t}));Mn.displayName=ge.displayName;const Nt=c.forwardRef(({className:e,...t},a)=>s.jsx(z,{ref:a,className:f("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...t}));Nt.displayName=z.displayName;const kt=c.forwardRef(({className:e,...t},a)=>s.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[s.jsx(Ks,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),s.jsx(z.Input,{ref:a,className:f("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...t})]}));kt.displayName=z.Input.displayName;const St=c.forwardRef(({className:e,...t},a)=>s.jsx(z.List,{ref:a,className:f("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...t}));St.displayName=z.List.displayName;const Rt=c.forwardRef((e,t)=>s.jsx(z.Empty,{ref:t,className:"py-6 text-center text-sm",...e}));Rt.displayName=z.Empty.displayName;const Ct=c.forwardRef(({className:e,...t},a)=>s.jsx(z.Group,{ref:a,className:f("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...t}));Ct.displayName=z.Group.displayName;const En=c.forwardRef(({className:e,...t},a)=>s.jsx(z.Separator,{ref:a,className:f("-mx-1 h-px bg-border",e),...t}));En.displayName=z.Separator.displayName;const $t=c.forwardRef(({className:e,...t},a)=>s.jsx(z.Item,{ref:a,className:f("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...t}));$t.displayName=z.Item.displayName;const Dn=1,In=1e6;let Me=0;function Ln(){return Me=(Me+1)%Number.MAX_SAFE_INTEGER,Me.toString()}const Ee=new Map,gs=e=>{if(Ee.has(e))return;const t=setTimeout(()=>{Ee.delete(e),ce({type:"REMOVE_TOAST",toastId:e})},In);Ee.set(e,t)},zn=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,Dn)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(a=>a.id===t.toast.id?{...a,...t.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=t;return a?gs(a):e.toasts.forEach(n=>{gs(n.id)}),{...e,toasts:e.toasts.map(n=>n.id===a||a===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(a=>a.id!==t.toastId)}}},Gn=[];let De={toasts:[]};function ce(e){De=zn(De,e),Gn.forEach(t=>{t(De)})}function de({...e}){const t=Ln(),a=o=>ce({type:"UPDATE_TOAST",toast:{...o,id:t}}),n=()=>ce({type:"DISMISS_TOAST",toastId:t});return ce({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:o=>{o||n()}}}),{id:t,dismiss:n,update:a}}const Fn=U("transition-all border inline-flex items-center text-sm pl-2 rounded-md",{variants:{variant:{default:"bg-secondary text-secondary-foreground hover:bg-secondary/80",primary:"bg-primary border-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive border-destructive text-destructive-foreground hover:bg-destructive/90"},size:{sm:"text-xs h-7",md:"text-sm h-8",lg:"text-base h-9",xl:"text-lg h-10"},shape:{default:"rounded-sm",rounded:"rounded-lg",square:"rounded-none",pill:"rounded-full"},borderStyle:{default:"border-solid",none:"border-none"},textCase:{uppercase:"uppercase",lowercase:"lowercase",capitalize:"capitalize"},interaction:{clickable:"cursor-pointer hover:shadow-md",nonClickable:"cursor-default"},animation:{none:"",fadeIn:"animate-fadeIn",slideIn:"animate-slideIn",bounce:"animate-bounce"},textStyle:{normal:"font-normal",bold:"font-bold",italic:"italic",underline:"underline",lineThrough:"line-through"}},defaultVariants:{variant:"default",size:"md",shape:"default",borderStyle:"default",textCase:"capitalize",interaction:"nonClickable",animation:"fadeIn",textStyle:"normal"}}),Vn=({tagObj:e,direction:t,onTagClick:a,onRemoveTag:n,variant:o,size:r,shape:l,borderStyle:i,textCase:d,interaction:m,animation:p,textStyle:u})=>s.jsxs("span",{className:f(Fn({variant:o,size:r,shape:l,borderStyle:i,textCase:d,interaction:m,animation:p,textStyle:u}),{"justify-between":t==="column"}),onClick:()=>a==null?void 0:a(e),children:[e,s.jsx(E,{type:"button",variant:"ghost",onClick:h=>{h.stopPropagation(),n(e)},className:f("py-1 px-3 h-full hover:bg-transparent"),children:s.jsx(pa,{size:14})})]},e),Bn=({tags:e,customTagRenderer:t,direction:a,...n})=>s.jsx("div",{className:f("rounded-md max-w-[450px]",{"flex flex-wrap gap-2":a==="row","flex flex-col gap-2":a==="column"}),children:e.map(o=>t?t(o):s.jsx(Vn,{tagObj:o,...n},o))}),On=({tags:e,setTags:t,autocompleteOptions:a,maxTags:n,onTagAdd:o,allowDuplicates:r,children:l})=>s.jsxs(Nt,{className:"border",children:[l,s.jsxs(St,{children:[s.jsx(Rt,{children:"No results found."}),s.jsx(Ct,{heading:"Suggestions",children:a.map(i=>s.jsx($t,{children:s.jsx("div",{className:"w-full",onClick:()=>{n&&e.length>=n||!r&&e.some(d=>d===i)||(t([...e,i]),o==null||o(i))},children:i})},i))})]})]}),Tt=se.forwardRef(e=>{const{id:t,placeholder:a,tags:n,setTags:o,variant:r,size:l,shape:i,className:d,enableAutocomplete:m,autocompleteOptions:p,maxTags:u,delimiter:h=",",onTagAdd:j,onTagRemove:g,allowDuplicates:b,showCount:N,validateTag:y,placeholderWhenFull:k="Max tags reached",sortTags:R,delimiterList:$,truncate:P,autocompleteFilter:G,borderStyle:x,textCase:v,interaction:C,animation:T,textStyle:S,minLength:M,maxLength:D,direction:A="row",onInputChange:F,customTagRenderer:$e,onFocus:is,onBlur:ls,onTagClick:Yt,inputFieldPostion:ds="bottom",clearAll:Xt=!1,onClearAll:Te,inputProps:Zt={},restrictTagsToAutocompleteOptions:Qt}=e,[Pe,cs]=se.useState(""),[ea,ms]=se.useState(Math.max(0,n.length)),us=se.useRef(null);if(u!==void 0&&u<0||e.minTags!==void 0&&e.minTags<0)return console.warn("maxTags and minTags cannot be less than 0"),de({title:"maxTags and minTags cannot be less than 0",description:"Please set maxTags and minTags to a value greater than or equal to 0",variant:"destructive"}),null;const fs=L=>{const I=L.target.value;cs(I),F==null||F(I)},ps=L=>{if($?$.includes(L.key):L.key===h||L.key==="Enter"){L.preventDefault();const I=Pe.trim();if(Qt&&!(p!=null&&p.some(ee=>ee===I))){de({title:"Invalid Tag",description:"Please select a tag from the autocomplete options.",variant:"destructive"});return}if(y&&!y(I))return;if(M&&I.length<M){console.warn("Tag is too short"),de({title:"Tag is too short",description:"Please enter a tag with more characters",variant:"destructive"});return}if(D&&I.length>D){de({title:"Tag is too long",description:"Please enter a tag with less characters",variant:"destructive"}),console.warn("Tag is too long");return}I&&(b||!n.some(ee=>ee===I))&&(u===void 0||n.length<u)&&(o([...n,I]),j==null||j(I),ms(ee=>ee+1)),cs("")}},sa=L=>{o(n.filter(I=>I!==L)),g==null||g(n.find(I=>I===L)||""),ms(I=>I-1)},ta=()=>{Te==null||Te()},aa=G?p==null?void 0:p.filter(L=>G(L)):p,na=R?[...n].sort():n,oa=P?n.map(L=>L.length>P?`${L.substring(0,P)}...`:L):na;return s.jsxs("div",{className:`w-full flex gap-3 ${ds==="bottom"?"flex-col":ds==="top"?"flex-col-reverse":"flex-row"}`,children:[s.jsx(Bn,{tags:oa,customTagRenderer:$e,variant:r,size:l,shape:i,borderStyle:x,textCase:v,interaction:C,animation:T,textStyle:S,onTagClick:Yt,onRemoveTag:sa,direction:A}),m?s.jsx("div",{className:"w-full max-w-[450px]",children:s.jsx(On,{tags:n,setTags:o,autocompleteOptions:aa,maxTags:u,onTagAdd:j,allowDuplicates:b??!1,children:s.jsx(kt,{placeholder:u!==void 0&&n.length>=u?k:a,ref:us,value:Pe,disabled:u!==void 0&&n.length>=u,onChangeCapture:fs,onKeyDown:ps,onFocus:is,onBlur:ls,className:"w-full"})})}):s.jsx("div",{className:"w-full",children:s.jsx(B,{ref:us,id:t,type:"text",placeholder:u!==void 0&&n.length>=u?k:a,value:Pe,onChange:fs,onKeyDown:ps,onFocus:is,onBlur:ls,...Zt,className:d,autoComplete:m?"on":"off",list:m?"autocomplete-options":void 0,disabled:u!==void 0&&n.length>=u})}),N&&u&&s.jsx("div",{className:"flex",children:s.jsxs("span",{className:"text-muted-foreground text-sm mt-1 ml-auto",children:[`${ea}`,"/",`${u}`]})}),Xt&&s.jsx(E,{type:"button",onClick:ta,className:"mt-2",children:"Clear All"})]})});Tt.displayName="TagInput";const Wn=["adult","junior","competitive","rec"],Un=[["adult","junior"],["competitive","rec"]];function _n(){const{shownPlayerProfile:e,hidePlayerProfile:t}=Y(),a=r=>{e&&w.players.update(e,{name:r})},n=r=>{e&&(r!=null&&r.trim()||(r=""),w.players.update(e,{alias:r}))},o=r=>{e&&(Un.forEach(l=>{r.map((d,m)=>l.indexOf(d)>=0?m:-1).filter(d=>d>=0).slice(0,-1).forEach(d=>r.splice(d,1))}),w.players.update(e,{tags:r.length?r:void 0}))};return s.jsx(Rn,{open:e!==void 0,onOpenChange:t,children:s.jsxs(gt,{children:[s.jsxs(vt,{className:"text-left",children:[s.jsx(wt,{children:"Edit profile"}),s.jsx(jt,{children:"Make changes to user details here. Click save when you're done."})]}),s.jsxs("div",{className:"flex flex-col space-y-2 mt-2",children:[s.jsx(W,{htmlFor:"player-name",children:"Player Name"}),s.jsx(B,{id:"player-name",value:e==null?void 0:e.name,onChange:r=>a(r.target.value)}),s.jsx(W,{htmlFor:"alias",children:"Alias"}),s.jsx(B,{id:"alias",value:e==null?void 0:e.alias,onChange:r=>n(r.target.value)}),s.jsx("p",{className:"text-[0.8rem] text-muted-foreground",children:"This will be shown instead of the player name everwhere but the Players page."}),s.jsx(W,{htmlFor:"tags",children:"Tags"}),s.jsx(Tt,{id:"tags",textCase:"lowercase",enableAutocomplete:!0,autocompleteOptions:Wn,tags:(e==null?void 0:e.tags)||[],setTags:r=>o(r)})]})]})})}function Hn(){const[e,t]=c.useState(0),a=e!=0,n=()=>t((e+2)%3-1),[o,r,l]=kn(250),i=!!o.trim(),{hasPresentUndo:d,storePresentUndo:m,retrievePresentUndo:p}=Y(),u=K(async()=>{let x;return e&&!i?(x=await w.players.orderBy("name").toArray(),e==-1&&x.reverse()):x=await w.players.toArray(),x},[e]),[h,j]=c.useMemo(()=>l(u||[],{keys:["name"]}),[u,l]),g=.3,b=u!=null&&u.length?u.reduce((x,v)=>(v.present&&x++,x),0):0,N=u!=null&&u.length?b==u.length:!1,y=b==0,k=h.length==(u==null?void 0:u.length),R=async()=>{!N&&!y&&m(h),h.forEach(x=>w.players.update(x.id,{present:!N}))},$=async()=>{p().forEach(x=>w.players.update(x.id,{present:x.present}))},P=(N||y)&&d,G=c.useCallback((x,v)=>{const C=(new Rs(u||[],{keys:["name"],includeScore:!0}).search(x)||[]).filter($e=>$e.item.id!=(v==null?void 0:v.id)),T=C.slice(0,1)[0],S=(T==null?void 0:T.score)||Number.MAX_SAFE_INTEGER,M=1e-10,D=.3,A=.35,F=C.length==1;if(S<M)return!0;if(x.trim().length<3)return!1;if(!(S<D)&&!(S<A&&F))return!1},[u]);return s.jsxs(oe,{children:[s.jsxs(je,{id:"players-title",title:"Players",children:[s.jsx("p",{children:"Add player names to the tournament roster. They can be marked absent between seed or elimination matches."}),s.jsx("p",{children:"Players will be locked and cannot be removed if have been matched in a game. Locked players can be marked absent for future rounds."})]}),s.jsxs(Xe,{children:[s.jsx("div",{className:"flex justify-center mb-1",children:s.jsx(bs,{divClassName:"sm:hidden",value:o,onValueChange:r})}),s.jsxs("div",{className:"w-full flex justify-between mb-2 space-x-2 items-center",children:[s.jsxs("div",{className:"flex space-x-2 items-center",children:[s.jsxs(qe,{disabled:!k,checked:N,onCheckedChange:R,children:[s.jsx("span",{className:"hidden sm:inline",children:"All Players Present"}),s.jsx("span",{className:"sm:hidden",children:"AllÂ Present"})]}),u!=null&&u.length?s.jsxs(Ye,{className:"ml-1 text-muted-foreground",variant:"outline",children:[b!=(u==null?void 0:u.length)?`${b} of`:void 0," ",u==null?void 0:u.length]}):void 0,P?s.jsx(E,{size:"icon",variant:"ghost",onClick:$,children:s.jsx(Ia,{})}):void 0]}),s.jsxs("div",{className:"flex align-end items-center space-x-2",children:[s.jsx(bs,{divClassName:"hidden sm:block",value:o,onValueChange:r}),s.jsx(pt,{className:f("px-2 py-2 h-9 w-9",{"text-slate-500":!a}),pressed:a&&!i,onClick:n,disabled:i,children:e!=-1?s.jsx(ha,{strokeWidth:1}):s.jsx(xa,{strokeWidth:1})})]})]}),i?s.jsxs("div",{className:"text-xs my-2 text-muted-foreground w-full text-center",children:[h.length==0?s.jsx(s.Fragment,{children:"No matches found."}):void 0,j>g?s.jsx(s.Fragment,{children:"No close matches found."}):s.jsxs(s.Fragment,{children:["Showing top ",h.length," matches."]})]}):void 0,h.map(x=>s.jsx(yn,{player:x,isDuplicate:G},x.id)),s.jsx(Nn,{isDuplicate:G})]}),s.jsx(_n,{})]})}const Pt=c.createContext(null);function ye(){const e=c.useContext(Pt);if(!e)throw new Error("useCarousel must be used within a <Carousel />");return e}const At=c.forwardRef(({orientation:e="horizontal",opts:t,setApi:a,plugins:n,className:o,children:r,...l},i)=>{const[d,m]=ba({...t,axis:e==="horizontal"?"x":"y"},n),[p,u]=c.useState(!1),[h,j]=c.useState(!1),g=c.useCallback(k=>{k&&(u(k.canScrollPrev()),j(k.canScrollNext()))},[]),b=c.useCallback(()=>{m==null||m.scrollPrev()},[m]),N=c.useCallback(()=>{m==null||m.scrollNext()},[m]),y=c.useCallback(k=>{k.key==="ArrowLeft"?(k.preventDefault(),b()):k.key==="ArrowRight"&&(k.preventDefault(),N())},[b,N]);return c.useEffect(()=>{!m||!a||a(m)},[m,a]),c.useEffect(()=>{if(m)return g(m),m.on("reInit",g),m.on("select",g),()=>{m==null||m.off("select",g)}},[m,g]),s.jsx(Pt.Provider,{value:{carouselRef:d,api:m,opts:t,orientation:e||((t==null?void 0:t.axis)==="y"?"vertical":"horizontal"),scrollPrev:b,scrollNext:N,canScrollPrev:p,canScrollNext:h},children:s.jsx("div",{ref:i,onKeyDownCapture:y,className:f("relative",o),role:"region","aria-roledescription":"carousel",...l,children:r})})});At.displayName="Carousel";const Fe=c.forwardRef(({className:e,...t},a)=>{const{carouselRef:n,orientation:o}=ye();return s.jsx("div",{ref:n,className:"overflow-hidden",children:s.jsx("div",{ref:a,className:f("flex",o==="horizontal"?"-ml-4":"-mt-4 flex-col",e),...t})})});Fe.displayName="CarouselContent";const me=c.forwardRef(({className:e,...t},a)=>{const{orientation:n}=ye();return s.jsx("div",{ref:a,role:"group","aria-roledescription":"slide",className:f("min-w-0 shrink-0 grow-0 basis-full",n==="horizontal"?"pl-4":"pt-4",e),...t})});me.displayName="CarouselItem";const Mt=c.forwardRef(({className:e,variant:t="outline",size:a="icon",...n},o)=>{const{orientation:r,scrollPrev:l,canScrollPrev:i}=ye();return s.jsxs(E,{ref:o,variant:t,size:a,className:f("absolute  h-8 w-8 rounded-full",r==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",e),disabled:!i,onClick:l,...n,children:[s.jsx(La,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Previous slide"})]})});Mt.displayName="CarouselPrevious";const Et=c.forwardRef(({className:e,variant:t="outline",size:a="icon",...n},o)=>{const{orientation:r,scrollNext:l,canScrollNext:i}=ye();return s.jsxs(E,{ref:o,variant:t,size:a,className:f("absolute h-8 w-8 rounded-full",r==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",e),disabled:!i,onClick:l,...n,children:[s.jsx(za,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Next slide"})]})});Et.displayName="CarouselNext";const Jn=Ga,Dt=c.forwardRef(({className:e,...t},a)=>s.jsx(Xs,{ref:a,className:f("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",e),...t}));Dt.displayName=Xs.displayName;const Ve=c.forwardRef(({className:e,...t},a)=>s.jsx(Zs,{ref:a,className:f("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",e),...t}));Ve.displayName=Zs.displayName;const Kn=c.forwardRef(({className:e,...t},a)=>s.jsx(Qs,{ref:a,className:f("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));Kn.displayName=Qs.displayName;const Ne=e=>Math.ceil(Math.log2(e)),ke=e=>Math.round(-.25+Math.log2(e/2)),It=c.createContext({nGameRounds:4,setNGameRounds:()=>{},defaultNGameRounds:4,nSeedRounds:4,setNSeedRounds:()=>{},defaultNSeedRounds:4,nElimRounds:4,setNElimRounds:()=>{},defaultNElimRounds:4,players:[],games:[]}),qn=({children:e})=>{const t=K(()=>w.players.toArray())||[],a=K(()=>w.games.toArray())||[],n=t.reduce((g,b)=>g+(b!=null&&b.present?1:0),0),o=Ne(n),r=ke(n),l=4,[i,d]=c.useState(l),[m,p]=c.useState(o),[u,h]=c.useState(r),j={nGameRounds:i,setNGameRounds:d,defaultNGameRounds:l,nSeedRounds:m,setNSeedRounds:p,defaultNSeedRounds:o,nElimRounds:u,setNElimRounds:h,defaultNElimRounds:r,players:t,games:a};return s.jsx(It.Provider,{value:j,children:s.jsx(xt,{players:t,children:e})})},Ze=()=>c.useContext(It),Z=e=>{if(e.p1id==null)return e.p2id;if(e.p2id==null||(e.p1points||0)>(e.p2points||0))return e.p1id;if((e.p1points||0)<(e.p2points||0))return e.p2id;if((e.p1twenties||0)>(e.p2twenties||0))return e.p1id;if((e.p1twenties||0)<(e.p2twenties||0))return e.p2id},Yn=(e,t=4)=>{if(e.p1twenties!=e.p2twenties||te(e,t))return!1;const a=e.gameRounds||[],[n,o]=a.reduce(([r,l],i)=>[r+((i==null?void 0:i.p1points)||0),l+(i==null?void 0:i.p2points)],[0,0]);return n==o},Xn=(e,t=4)=>{if(e.stage!="elim")return!1;let a=e.gameRounds||[];if(a.length<t||te(e,t,t))return!1;a=a.slice(0,t);const[n,o]=a.reduce(([r,l],i)=>[r+((i==null?void 0:i.p1points)||0),l+(i==null?void 0:i.p2points)],[0,0]);return n==o},te=(e,t=4,a=0)=>{if((e.p1twenties||0)>0||(e.p2twenties||0)>0||(e.p1points||0)>0||(e.p2points||0)>0)return!1;let n=e.gameRounds||[];if(n.length<t)return!0;a>0&&(n=n.slice(0,a));const o=n.findIndex(l=>l==null)>=0,r=n.find(l=>l==null?!0:l.p1points==0&&l.p2points==0);return o||!!r},Lt=e=>(e.p1twenties||0)>0||(e.p2twenties||0)>0||(e.p1points||0)>0||(e.p2points||0)>0?!0:!!(e.gameRounds||[]).find(n=>n==null?!1:n.p1points>0||n.p2points>0),fe=e=>e.p1id==null||e.p2id==null,Zn=U("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),ae=c.forwardRef(({className:e,variant:t,...a},n)=>s.jsx("div",{ref:n,role:"alert",className:f(Zn({variant:t}),e),...a}));ae.displayName="Alert";const Qe=c.forwardRef(({className:e,...t},a)=>s.jsx("h5",{ref:a,className:f("mb-1 font-medium leading-none tracking-tight",e),...t}));Qe.displayName="AlertTitle";const Q=c.forwardRef(({className:e,...t},a)=>s.jsx("div",{ref:a,className:f("text-sm [&_p]:leading-relaxed",e),...t}));Q.displayName="AlertDescription";const q=e=>{const{working:t,children:a}=e,n=e.disabled||t,o={...e,disabled:n};return delete o.children,delete o.working,s.jsxs(E,{...o,children:[t?s.jsx(Fa,{className:"mr-2 h-4 w-4 animate-spin"}):void 0,a]})},Qn=e=>{const t=[],a=[];return e.forEach(n=>{n.id!=null&&(n.present?t.push(n.id):a.push(n.id))}),{presentPlayers:t,absentPlayers:a}},eo=(e,t,a,n)=>{const o=[],r=[],l=[],i=[];return e.forEach(d=>{const m=d.p1id==null||a.indexOf(d.p1id)>=0,p=d.p2id==null||a.indexOf(d.p2id)>=0,u=m&&p;!fe(d)&&Lt(d)?(d.p1id&&r.push(d.p1id),d.p2id&&r.push(d.p2id)):u?d.id!==void 0&&l.push(d.id):m?(o.push(d.p2id),d.id!==void 0&&(l.push(d.id),i.push(d.id))):p?(o.push(d.p1id),d.id!==void 0&&(l.push(d.id),i.push(d.id))):n?(o.push(d.p1id),o.push(d.p2id),d.id!==void 0&&l.push(d.id)):(r.push(d.p1id),r.push(d.p2id))}),t.forEach(d=>{const m=r.indexOf(d)>=0,p=o.indexOf(d)>=0;!m&&!p&&o.push(d)}),{unmatchedPlayers:o,gamesToDelete:l,byeGames:i}};function ie(e,t,a=!1){const{presentPlayers:n,absentPlayers:o}=Qn(e),{unmatchedPlayers:r,gamesToDelete:l,byeGames:i}=eo(t,n,o,a);return{unmatchedPlayers:r,gamesToDelete:l,byeGames:i}}const vs=(e,t)=>a=>a.p1id==e&&a.p2id==t||a.p1id==t&&a.p2id==e;function so(e,t){const a=n=>typeof n=="number"?n:n==null?void 0:n.id;for(let n=0;n<e.length;n+=2){let o=t.find(vs(a(e[n]),a(e[n+1]))),r=n+2;for(;o!=null&&r<e.length;)[e[n+1],e[r]]=[e[r],e[n+1]],o=t.find(vs(a(e[n]),a(e[n+1]))),r+=1}}function zt(e,t,a=4,n=!0,o=!1){let r,l,i,d;const m=[];if(e==null||t==null){r=4,l=4;for(let p=0;p<a;p++)m.push({p1points:1,p2points:1})}else if(n){const p=e>t?.55:.45;r=l=0,i=d=0;for(let u=0;u<a;u++)if(Math.random()<.02){r+=1,l+=1,m.push({p1points:1,p2points:1});const h=Math.floor(Math.random()*5);i+=h,d+=h}else if(Math.random()<p){r+=2,m.push({p1points:2,p2points:0});const h=Math.floor(Math.random()*5);i=h,d=Math.floor(Math.random()*h)}else{l+=2,m.push({p1points:0,p2points:2});const h=Math.floor(Math.random()*5);d=h,i=Math.floor(Math.random()*h)}if(o&&r==l&&i==d){const u=Math.floor(Math.random()*5);Math.random()<.5?(r+=2,i+=u,d+=Math.floor(Math.random()*u)):(l+=2,d+=u,i+=Math.floor(Math.random()*u))}}return{p1points:r,p2points:l,p1twenties:i,p2twenties:d,gameRounds:m}}function es(e,t){const a=o=>typeof o=="number"?o:(o==null?void 0:o.id)==null?Number.NEGATIVE_INFINITY:o.id;if(t.length==0)return ue(e);const n={};return t.forEach(o=>{if(o.p1id!=null){const r=n[o.p1id]=n[o.p1id]||{points:0,twenties:0,wins:0,draws:0};r.points+=o.p1points||0,r.twenties+=o.p1twenties||0;const l=Z(o);o.p1id==l?r.wins+=1:o.p2id==null&&(r.draws+=1)}if(o.p2id!=null){const r=n[o.p2id]=n[o.p2id]||{points:0,twenties:0,wins:0,draws:0};r.points+=o.p2points||0,r.twenties+=o.p2twenties||0;const l=Z(o);o.p2id==l?r.wins+=1:o.p2id==null&&(r.draws+=1)}}),e.sort((o,r)=>{const l=a(o),i=a(r),d=n[l]||{points:0,twenties:0,wins:0,draws:0},m=n[i]||{points:0,twenties:0,wins:0,draws:0};return d.points>m.points?-1:d.points<m.points?1:d.twenties>m.twenties?-1:d.twenties<m.twenties?1:d.wins>m.wins?-1:d.wins<m.wins?1:d.draws>m.draws?-1:d.draws<m.draws?1:0}),e}const to=(e,t,a=[],n=4,o=!1)=>{const r=[];if(t.length%2!=0&&t.push(void 0),e===0)ue(t);else{const l=a.filter(i=>i.stage=="seed"&&i.round<e);es(t,l),so(t,l)}for(let l=0;l<t.length;l+=2){let i=t[l],d=t[l+1];i==null&&([i,d]=[d,i]);const{p1points:m,p2points:p,p1twenties:u,p2twenties:h,gameRounds:j}=zt(i,d,n,o);r.push({stage:"seed",round:e,n:l/2,p1id:i,p2id:d,p1points:m,p2points:p,p1twenties:u,p2twenties:h,gameRounds:j})}return r},ss=(e,t,a=[],n=4,o=!1,r=!0)=>{const l=a.filter(p=>p.stage=="seed"&&p.round==e),{unmatchedPlayers:i,gamesToDelete:d}=ie(t,l,!r);return{gamesToAdd:to(e,i,a,n,o),gamesToDelete:d}},ao=(e,t=4)=>{const a=[],{unmatchedPlayers:n}=ie(e,[]),o=Ne(n.length);for(let r=0;r<o;r++){const{gamesToAdd:i}=ss(r,e,a,t,!0);i.forEach(d=>a.push(d))}return{gamesToAdd:a,nRounds:o}},no=Ba,oo=Oa,Gt=c.forwardRef(({className:e,align:t="center",sideOffset:a=4,...n},o)=>s.jsx(Va,{children:s.jsx(et,{ref:o,align:t,sideOffset:a,className:f("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));Gt.displayName=et.displayName;function ws({game:e,rn:t,pn:a,onClick:n,disabled:o,small:r}){var h;const l=(h=e.gameRounds)==null?void 0:h[t];let i=isNaN((l==null?void 0:l.p1points)||NaN)&&isNaN((l==null?void 0:l.p2points)||NaN)?"?":((l==null?void 0:l.p1points)||0)>((l==null?void 0:l.p2points)||0)?"win":((l==null?void 0:l.p1points)||0)<((l==null?void 0:l.p2points)||0)?"loss":"draw";a==2&&(i=i=="win"?"loss":i=="loss"?"win":i);const d="",m="",p="w-9 justify-center uppercase text-white",u={win:"bg-emerald-700 hover:bg-emerald-600",loss:"bg-rose-800 hover:bg-rose-700",draw:"bg-slate-500 hover:bg-slate-400","?":"bg-slate-300 hover:bg-slate-200"};return s.jsx(E,{onClick:n,disabled:o,className:f(p,u[i],r?m:d),children:i.substring(0,1)})}const ne="1.25em",pe=e=>`calc(${ne}*${e})`,ro=()=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:pe(.85),height:pe(.85),viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("circle",{cx:"12",cy:"12",r:"10"})}),io=()=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:ne,height:ne,viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"})}),lo=()=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:ne,height:ne,viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41l-7.59-7.59a2.41 2.41 0 0 0-3.41 0Z"})}),co=()=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:pe(.9),height:pe(.9),viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"})});function mo({i:e=0}){const t=[ro,io,lo,co],a=t[Math.abs(e)%t.length];return s.jsx(a,{})}const js=["text-red-500","text-orange-500","text-amber-500","text-yellow-500","text-lime-500","text-green-500","text-teal-500","text-cyan-500","text-sky-500","text-blue-500","text-indigo-500","text-violet-500","text-purple-500","text-fuchsia-500","text-pink-500","text-rose-500"];function ts({player:e,className:t,empty:a="bye",noshape:n=!0,winner:o}){const r="text-slate-300",l=e==null?void 0:e.id,i=l?js[l%js.length]:r,d=(e==null?void 0:e.present)===!1;return s.jsxs("div",{className:f(t,"flex text-left gap-1 items-center",!n&&"w-48",o&&""),children:[s.jsx("span",{className:f("h-2 w-2 shrink-0 rounded-full",!e||d?"border border-slate-400":"bg-sky-400")}),s.jsx("span",{className:f("truncate",n?"w-40 sm:w-48":"w-36 sm:w-44",!(e!=null&&e.alias||e!=null&&e.name||d||o===!1)&&"text-muted-foreground"),children:(e==null?void 0:e.alias)||(e==null?void 0:e.name)||a}),n?void 0:s.jsx("span",{className:f("w-4 shrink-0",i,!e&&"invisible"),children:s.jsx(mo,{i:l})})]})}function uo({game:e,noshape:t}){const{findPlayer:a}=c.useContext(re),n=a(e.p1id),o=a(e.p2id);return s.jsx(E,{className:"py-0 px-0 block w-fit h-fit",variant:"outline",children:[n,o].map((r,l)=>s.jsx("span",{children:s.jsx(ts,{className:f("py-2 px-2",!l&&"border-b"),player:r,noshape:t})},r!==void 0?r.id:`bye-${l}`))},e.id)}function Ft({trigger:e,game:t,readonly:a,numRounds:n=4}){const{findPlayer:o}=c.useContext(re),r=o(t.p1id),l=o(t.p2id),i=a||!r||!l,[d,m]=c.useState(t.p1points),[p,u]=c.useState(t.p2points),[h,j]=c.useState(t.p1twenties),[g,b]=c.useState(t.p2twenties);c.useEffect(()=>{m(t.p1points),u(t.p2points),j(t.p1twenties),b(t.p2twenties)},[t]),c.useEffect(()=>{a||(!r||!l)&&(t.gameRounds=new Array(n).fill({p1points:1,p2points:1}),y(t))},[r,l,a]);const N=()=>(t.gameRounds||[]).reduce(([v,C],T)=>[v+((T==null?void 0:T.p1points)||0),C+(T==null?void 0:T.p2points)],[0,0]),y=async x=>{[x.p1points,x.p2points]=N(),x.p1points==0&&x.p2points==0&&(x.p1points=x.p2points=void 0),x.id==null?await w.games.add(x):await w.games.update(x.id,x)},k=(x,v)=>{v=isNaN(v||NaN)?void 0:v,x==1?(m(v),t.p1points=v):(u(v),t.p2points=v),y(t)},R=(x,v)=>{v=isNaN(v||NaN)?void 0:v,x==1?(j(v),t.p1twenties=v):(b(v),t.p2twenties=v),y(t)},$=(x,v,C)=>{t.gameRounds||(t.gameRounds=Array(v)),t.gameRounds[v]||(t.gameRounds[v]={p1points:0,p2points:0});const T=[{p1points:0,p2points:0},{p1points:2,p2points:0},{p1points:0,p2points:2},{p1points:1,p2points:1}],S=t.gameRounds[v].p1points*10+t.gameRounds[v].p2points;let M=0;switch(`p${x}-${S}`){case"p1-0":M=1;break;case"p1-20":M=2;break;case"p1-2":M=3;break;case"p1-11":M=0;break;case"p2-0":M=2;break;case"p2-2":M=1;break;case"p2-20":M=3;break;case"p2-11":M=0;break}t.gameRounds[v]=T[M],t.gameRounds=t.gameRounds.slice(0,C),y(t)};e=e||s.jsx(uo,{game:t});const P=[{player:r,points:d,twenties:h},{player:l,points:p,twenties:g}],G=Xn(t,n);return s.jsxs(no,{children:[s.jsx(oo,{asChild:!0,children:e}),s.jsx(Gt,{className:"w-60 sm:w-fit p-0 divide-y text-sm",children:P.map(({player:x,points:v,twenties:C},T)=>{const S=T+1,M=!x;return s.jsx("div",{className:"p-2 sm:px-3 sm:py-1",children:s.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[s.jsx("div",{className:f("w-56 sm:w-40 font-bold truncate",M&&"text-muted-foreground"),children:(x==null?void 0:x.alias)||(x==null?void 0:x.name)||"bye"}),s.jsxs("div",{className:f("flex gap-1 items-center",M&&"invisible"),children:[Je(n).map(D=>s.jsx("div",{className:"game",children:s.jsx(ws,{small:a,disabled:i,game:t,rn:D,pn:S,onClick:()=>$(S,D,n)})},D)),t.stage=="elim"?s.jsx("div",{className:f("game",!G&&"invisible"),children:s.jsx(ws,{small:a,disabled:i,game:t,rn:n,pn:S,onClick:()=>$(S,n,n+1)})}):void 0]}),s.jsxs("div",{className:f("flex gap-1 items-center",M&&"invisible"),children:[s.jsx(B,{readOnly:!0,disabled:i,id:"points",className:"w-10 pl-1 text-right",onChange:D=>k(S,parseInt(D.target.value)),value:isNaN(v||NaN)?"":v})," ",s.jsx("span",{className:"text-muted-foreground",children:"pts"}),s.jsx(B,{disabled:i,id:"twenties",className:"w-10 pl-1 text-right",onChange:D=>R(S,parseInt(D.target.value)),value:isNaN(C||NaN)?"":C})," ",s.jsx("span",{className:"text-muted-foreground",children:"20s"})]})]},T)},S)})})]})}const fo=({game:e,hasNextRound:t})=>{const{players:a}=Y(),n=e?a.find(h=>h.id==(e==null?void 0:e.p1id)):void 0,o=e?a.find(h=>h.id==(e==null?void 0:e.p2id)):void 0,r=Z(e),l=Yn(e),i=te(e),d=h=>!i&&r!=null&&r==(h==null?void 0:h.id)||l,m=h=>!i&&r!=null&&r!=(h==null?void 0:h.id),p="bg-slate-300 bg-opacity-50",u="text-muted-foreground";return s.jsx(Ft,{readonly:t,game:e,trigger:s.jsx(E,{className:"py-0 px-0 block w-fit h-fit",variant:"outline",children:[n,o].map((h,j)=>s.jsx("span",{children:s.jsx(ts,{className:f("py-2 px-2",!j&&"border-b",d(h)&&p,m(h)&&u),player:h})},h!==void 0?h.id:`bye-${j}`))},e.id)},e.id)};function po({stage:e,round:t,nRounds:a}){const{games:n}=Ze(),{players:o}=Y(),[r,l]=c.useState(!1),{thisRound:i,hasNextRound:d}=c.useMemo(()=>{const g=n.filter(y=>y.stage==e&&y.round==t),b=e=="seed"&&t==a-1;let N;return b?N=!!n.find(y=>y.stage=="elim"&&y.round==0):N=!!n.find(y=>y.stage==e&&y.round==t+1),{thisRound:g,hasNextRound:N}},[n,a,t,e]),{canResetMatches:m,canAddMatches:p,canDeleteMatches:u}=c.useMemo(()=>{const g=i.find(P=>fe(P)?!1:Lt(P)),b=!d&&!g,{unmatchedPlayers:N,gamesToDelete:y,byeGames:k}=ie(o,i),R=e=="seed"&&!d&&N.length>1,$=e=="seed"&&!d&&y.length-k.length>0;return{canResetMatches:b,canAddMatches:R,canDeleteMatches:$}},[i,d,o,e]),h=()=>{m&&(l(!0),w.games.bulkDelete(i.map(g=>g.id)).finally(()=>{setTimeout(()=>l(!1),750)}))},j=()=>{if(!p&&!u)return;l(!0);const{gamesToDelete:g,gamesToAdd:b}=ss(t,o,n,a);w.games.bulkDelete(g).then(()=>w.games.bulkAdd(b)).finally(()=>{setTimeout(()=>l(!1),750)})};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-2 w-full text-sm text-center text-muted-foreground",children:["Round ",t+1]}),s.jsx("div",{className:"p-1 flex flex-wrap gap-2 justify-center",children:i.map(g=>s.jsx(fo,{game:g,hasNextRound:d},g.id))}),p||u?s.jsx("div",{className:"p-1 flex justify-center",children:s.jsxs(ae,{className:"max-w-80 sm:max-w-md sm:w-md flex gap-2 items-center justify-between",children:[s.jsx("div",{children:s.jsx(Q,{children:p?"There are unmatched players.":"Some matches have abset players."})}),s.jsxs(q,{variant:"secondary",working:r,onClick:j,children:[p?"Add":"Delete"," Matches"]})]})}):void 0,m?s.jsx("div",{className:"p-1 flex justify-center",children:s.jsxs(ae,{className:"max-w-80 sm:max-w-md sm:w-md flex gap-2 items-center justify-between",children:[s.jsx("div",{children:s.jsx(Q,{children:"No games have been scored this round."})}),s.jsx(q,{variant:"secondary",working:r,onClick:h,children:"Reset Matches"})]})}):void 0]})}const ho=(e,t,a,n=[],o=4,r=!1)=>{const l=[];if(e===0){const i=n.filter(p=>p.stage=="seed"),d=Math.pow(2,t-e);es(a,i);const m=a.slice(0,d);a=[];for(let p=0;p<m.length/2;p++){const u=m[p],h=m[d-1-p];a.push(u),a.push(h)}}else a=n.filter(m=>m.stage=="elim"&&m.round==e-1).reduce((m,p)=>{const u=Z(p);return u!=null&&m.push(u),m},[]);a.length%2!=0&&a.push(void 0);for(let i=0;i<a.length;i+=2){let d=a[i],m=a[i+1];d==null&&([d,m]=[m,d]);const{p1points:p,p2points:u,p1twenties:h,p2twenties:j,gameRounds:g}=zt(d,m,o,r);l.push({stage:"elim",round:e,n:i/2,p1id:d,p2id:m,p1points:p,p2points:u,p1twenties:h,p2twenties:j,gameRounds:g})}return l},Vt=(e,t,a,n=[],o=4,r=!1)=>{const l=n.filter(u=>u.stage=="elim"&&u.round>=e),i=!1,{unmatchedPlayers:d,gamesToDelete:m}=ie(a,l,i);return{gamesToAdd:ho(e,t,d,n,o,r),gamesToDelete:m}},xo=(e,t,a=4)=>{const n=[...t],o=[],{unmatchedPlayers:r}=ie(e,[]),l=ke(r.length);for(let i=0;i<l;i++){const d=i<l-1,{gamesToAdd:m}=Vt(i,l,e,n,a,d);m.forEach(p=>{n.push(p),o.push(p)})}return{gamesToAdd:o,nRounds:l}},ys=({isStartElim:e})=>s.jsxs(ae,{className:"text-left max-w-80 sm:max-w-md sm:w-md mb-4",children:[s.jsx(Qe,{children:"Heads up!"}),s.jsxs(Q,{children:["There are unscored games in the last ",e?"seed":void 0," round."]})]}),Bt=c.forwardRef(({className:e,...t},a)=>s.jsx(st,{className:f("grid gap-2",e),...t,ref:a}));Bt.displayName=st.displayName;const Ot=c.forwardRef(({className:e,...t},a)=>s.jsx(tt,{ref:a,className:f("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:s.jsx(Wa,{className:"flex items-center justify-center",children:s.jsx(_e,{className:"h-3.5 w-3.5 fill-primary"})})}));Ot.displayName=tt.displayName;const bo=({nPresent:e,value:t,onValueChange:a,className:n})=>{const o=ke(e),r=Math.floor(Math.log2(e));return s.jsx(Bt,{className:n,value:t.toString(),onValueChange:l=>a(parseInt(l)),children:Je(r).reverse().map(l=>{const i=l+1,d=Math.pow(2,i);return s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Ot,{value:`${i}`,id:`r${i}`}),s.jsxs(W,{htmlFor:`r${i}`,children:["Top ",d," Players â¢ ",i," Round",i>1?"s":void 0,o==i?s.jsx("span",{className:"text-muted-foreground italic",children:" Recommended"}):void 0]})]},i)})})},go=({nPresent:e})=>{const t=Ne(e);return s.jsxs(ae,{className:"text-left max-w-80 sm:max-w-md sm:w-md mb-4",children:[s.jsx(Qe,{children:"Heads up!"}),s.jsxs(Q,{children:["There are not enough seed rounds to rank ",e," players completely.",s.jsxs(Q,{className:"mt-1",children:[t," seed rounds are recommended."]})]})]})};function vo(){const[e,t]=c.useState(),[a,n]=c.useState(0),{games:o}=Ze(),{players:r,nPresent:l}=Y(),[i,d]=c.useState(!1),[m,p]=c.useState(0),[u,h]=c.useState("seed"),j=m==0;c.useEffect(()=>{e&&(n(e.selectedScrollSnap()),e.on("select",()=>n(e.selectedScrollSnap())))},[e]),c.useEffect(()=>{if(!j)return;const C=Math.max(ke(l),0);p(C)},[l,j]);const{nSeedRounds:g,nElimRounds:b,isLastSeedUnscored:N,isLastElimUnscored:y,atEnd:k}=c.useMemo(()=>{let C=0,T=0;o.forEach(A=>{A.stage=="seed"?C=Math.max(C,A.round+1):T=Math.max(T,A.round+1)});const S=!!o.find(A=>A.stage=="seed"&&A.round==C-1&&te(A)),M=!!o.find(A=>A.stage=="elim"&&A.round==T-1&&te(A)),D=o.filter(A=>A.stage=="elim"&&A.round==T-1).length==1;return{nSeedRounds:C,nElimRounds:T,isLastSeedUnscored:S,isLastElimUnscored:M,atEnd:D}},[o]),R=u=="seed"?g:b,$=u=="seed"?N:y,P=u=="seed"?b==0:!k,G=Ne(l),x=C=>{h(C);const T=C=="seed"?g-(N?1:0):b-(y?1:0);e==null||e.scrollTo(0,!0),setTimeout(()=>e==null?void 0:e.scrollTo(T),100)},v=C=>{if(d(!0),u=="seed"){const{gamesToAdd:S}=ss(C,r,o,4);w.games.bulkAdd(S).finally(()=>setTimeout(()=>d(!1),750))}else{const{gamesToAdd:S}=Vt(C,m,r,o,4);w.games.bulkAdd(S).finally(()=>setTimeout(()=>d(!1),750))}};return s.jsxs(oe,{children:[s.jsxs(je,{id:"matches-title",title:"Matches",children:[s.jsx("p",{children:"The first stage is made up of seed rounds where players are matched randomly in the first round, then against players they haven't yet been matched against, with similar scores if possible."}),s.jsx("p",{children:"The second stage is a set of elimination rounds where top players are matched based on their ranking from the seed rounds."})]}),s.jsx(Jn,{value:u,onValueChange:x,className:"w-full flex justify-center",children:s.jsxs(Dt,{className:"grid w-80 grid-cols-2 mx-1",children:[s.jsx(Ve,{value:"seed",children:"Seed"}),s.jsx(Ve,{value:"elim",children:"Elimination"})]})}),s.jsx("div",{className:"flex  justify-center",children:s.jsxs(At,{className:"w-full",setApi:t,children:[R?s.jsxs(Fe,{children:[Je(R).map(C=>s.jsx(me,{className:"min-h-80",children:s.jsx(po,{stage:u,round:C,nRounds:R})},C)),P?s.jsx(me,{className:"p-1 pt-4 flex flex-wrap gap-2 justify-center items-start sm:items-center min-h-80",children:s.jsxs("div",{className:"text-center",children:[$?s.jsx(ys,{}):void 0,l==1?s.jsx("p",{children:"There is only 1 player present."}):u=="seed"?s.jsxs("p",{children:["There are ",l," players present."]}):void 0,l<2?s.jsxs("p",{children:["Use the ",s.jsx(V,{className:"font-bold hover:underline",to:"/players",children:"Players"})," page to add players."]}):u=="seed"||!$?s.jsxs(q,{working:i,onClick:()=>v(R),children:["Start ",u=="seed"?"Seed":"Elimination"," Round ",R+1]}):void 0]})}):void 0]}):s.jsx(Fe,{children:s.jsx(me,{className:"p-1 pt-4 flex flex-wrap gap-2 justify-center items-start sm:items-center min-h-80",children:s.jsxs("div",{className:"text-center",children:[u=="elim"&&b==0&&g<G?s.jsx(go,{nPresent:l}):void 0,u=="elim"&&a==0&&N?s.jsx(ys,{isStartElim:!0}):void 0,l==0?s.jsx("p",{children:"There are no players present."}):void 0,l==1?s.jsx("p",{children:"There is only 1 player present."}):void 0,l<2?s.jsxs("p",{children:["Use the ",s.jsx(V,{className:"font-bold hover:underline",to:"/players",children:"Players"})," page to add players."]}):s.jsxs(s.Fragment,{children:[s.jsxs(q,{disabled:u=="elim"&&!m,working:i,onClick:()=>v(0),children:["Start ",u=="seed"?"Tournament":"Elimination"]}),u=="seed"&&l>1?s.jsx("div",{children:s.jsxs(W,{children:[l," players â¢ ",Math.ceil(l/2)," match",l!=2?"es":void 0]})}):void 0,u=="elim"?s.jsx("div",{className:"max-w-80 m-auto",children:s.jsx(bo,{className:"mt-4",nPresent:l,value:m,onValueChange:p})}):void 0]})]})})}),s.jsx(Mt,{className:"hidden md:inline-flex"}),s.jsx(Et,{className:"hidden md:inline-flex"})]})})]})}const Wt=c.forwardRef(({className:e,...t},a)=>s.jsx("div",{className:"relative w-full overflow-auto",children:s.jsx("table",{ref:a,className:f("w-full caption-bottom text-sm",e),...t})}));Wt.displayName="Table";const Ut=c.forwardRef(({className:e,...t},a)=>s.jsx("thead",{ref:a,className:f("[&_tr]:border-b",e),...t}));Ut.displayName="TableHeader";const _t=c.forwardRef(({className:e,...t},a)=>s.jsx("tbody",{ref:a,className:f("[&_tr:last-child]:border-0",e),...t}));_t.displayName="TableBody";const wo=c.forwardRef(({className:e,...t},a)=>s.jsx("tfoot",{ref:a,className:f("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));wo.displayName="TableFooter";const Be=c.forwardRef(({className:e,...t},a)=>s.jsx("tr",{ref:a,className:f("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));Be.displayName="TableRow";const _=c.forwardRef(({className:e,...t},a)=>s.jsx("th",{ref:a,className:f("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t}));_.displayName="TableHead";const H=c.forwardRef(({className:e,...t},a)=>s.jsx("td",{ref:a,className:f("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t}));H.displayName="TableCell";const jo=c.forwardRef(({className:e,...t},a)=>s.jsx("caption",{ref:a,className:f("mt-4 text-sm text-muted-foreground",e),...t}));jo.displayName="TableCaption";function yo(e,t,a){let n=0,o=0,r=0;return{wld:a.reduce((i,d)=>{if(d.stage!=t)return i;if(d.p1id==e.id){n+=d.p1points||0,o+=d.p1twenties||0;const m=fe(d),p=Z(d);m?i.push({wld:"bye",game:d}):p==e.id?(i.push({wld:"win",game:d}),r+=1):p!=null?i.push({wld:"loss",game:d}):i.push({wld:"draw",game:d})}else if(d.p2id==e.id){n+=d.p2points||0,o+=d.p2twenties||0;const m=fe(d),p=Z(d);m?i.push({wld:"bye",game:d}):p==e.id?(i.push({wld:"win",game:d}),r+=1):p!=null?i.push({wld:"loss",game:d}):i.push({wld:"draw",game:d})}return i},[]),points:n,twenties:o,wins:r}}function Ns({wld:e}){const t="w-6 h-5 px-0 justify-center uppercase text-white",a={win:"bg-emerald-700 hover:bg-emerald-600",loss:"bg-rose-800 hover:bg-rose-700",draw:"bg-slate-500 hover:bg-slate-400",bye:"bg-slate-400 hover:bg-slate-300"};return s.jsx("div",{className:"flex flex-wrap gap-1 -ml-1 sm:w-60",children:e.map((n,o)=>s.jsx(Ft,{readonly:!0,game:n.game,trigger:s.jsx(E,{className:f(t,a[n.wld]),children:n.wld.substring(0,1)},o)},o))})}function No(){const{players:e,games:t}=K(async()=>{const a=await w.players.filter(o=>!!o.present).toArray(),n=await w.games.where("stage").equals("seed").toArray();return es(a,n),{players:a,games:n}})||{players:[],games:[]};return s.jsx(xt,{players:e,children:s.jsxs(oe,{children:[s.jsxs(je,{id:"rankings-page",title:"Rankings",children:[s.jsx("p",{children:"Players are ranked based on their win-loss-draw record. Players get 2 points for a win, 1 point for a draw, and no points for a loss."}),s.jsx("p",{children:"Ties are broken by the total number of twenties scored."})]}),s.jsxs(Xe,{children:[s.jsxs(Wt,{className:"w-full",children:[s.jsx(Ut,{children:s.jsxs(Be,{className:"hidden sm:table-row",children:[s.jsx(_,{className:"text-right w-2",children:s.jsx("span",{className:"hidden sm:inline",children:"Rank"})}),s.jsx(_,{children:"Name"}),s.jsx(_,{className:"sm:w-3 hidden sm:table-cell",children:"Record"}),s.jsx(_,{className:"hidden sm:table-cell text-right",children:"Points"}),s.jsx(_,{className:"hidden sm:table-cell text-right",children:"20s"}),s.jsx(_,{className:"sm:hidden table-cell text-right"})]})}),s.jsx(_t,{children:e.map((a,n)=>{const{wld:o,points:r,twenties:l}=yo(a,"seed",t);return s.jsxs(Be,{children:[s.jsxs(H,{className:"text-right w-2",children:[n+1,"."]}),s.jsx(H,{className:"sm:max-w-none",children:s.jsxs("div",{className:"flex flex-wrap space-x-2 space-y-2",children:[s.jsx(ts,{player:a}),s.jsx("div",{className:"sm:hidden",children:s.jsx(Ns,{wld:o})})]})}),s.jsx(H,{className:"hidden sm:table-cell",children:s.jsx("div",{className:"flex flex-wrap sm:w-fit flex-wrap sm:flex-nowrap gap-1",children:s.jsx(Ns,{wld:o})})}),s.jsx(H,{className:"hidden sm:table-cell text-right",children:r}),s.jsx(H,{className:"hidden sm:table-cell text-right",children:l}),s.jsx(H,{className:"sm:hidden table-cell text-right",children:s.jsxs("div",{className:"w-14",children:[r," ",s.jsx("span",{className:"text-muted-foreground font-semibold pr-1",children:"pts"}),s.jsx("br",{}),l," ",s.jsx("span",{className:"text-muted-foreground font-semibold",children:"20s"}),s.jsx("br",{})]})})]},a.id)})})]}),e.length==0?s.jsxs("div",{className:"w-full text-center mt-32",children:[s.jsx("p",{children:"There are no players present."}),s.jsxs("p",{children:["Use the ",s.jsx(V,{className:"font-bold hover:underline",to:"/players",children:"Players"})," page to add players."]})]}):void 0]})]})})}const Ht=_a,ko=Ha,So=Ua,Jt=c.forwardRef(({className:e,...t},a)=>s.jsx(at,{className:f("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:a}));Jt.displayName=at.displayName;const as=c.forwardRef(({className:e,...t},a)=>s.jsxs(So,{children:[s.jsx(Jt,{}),s.jsx(nt,{ref:a,className:f("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));as.displayName=nt.displayName;const Kt=({className:e,...t})=>s.jsx("div",{className:f("flex flex-col space-y-2 text-center sm:text-left",e),...t});Kt.displayName="AlertDialogHeader";const Se=({className:e,...t})=>s.jsx("div",{className:f("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Se.displayName="AlertDialogFooter";const ns=c.forwardRef(({className:e,...t},a)=>s.jsx(ot,{ref:a,className:f("text-lg font-semibold",e),...t}));ns.displayName=ot.displayName;const os=c.forwardRef(({className:e,...t},a)=>s.jsx(rt,{ref:a,className:f("text-sm text-muted-foreground",e),...t}));os.displayName=rt.displayName;const Re=c.forwardRef(({className:e,...t},a)=>s.jsx(it,{ref:a,className:f(Ke(),e),...t}));Re.displayName=it.displayName;const rs=c.forwardRef(({className:e,...t},a)=>s.jsx(lt,{ref:a,className:f(Ke({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));rs.displayName=lt.displayName;function Ro({show:e,onHide:t,onConfirm:a}){return s.jsx(Ht,{open:e,onOpenChange:t,children:s.jsxs(as,{children:[s.jsx(ns,{children:"Are you absolutely sure?"}),s.jsx(os,{children:"Restoring a previously saved tournament will replace the current one. All current player names, games, scores, and rankings will be lost."}),s.jsxs(Se,{className:"gap-1 sm:gap-0",children:[s.jsx(Re,{className:"transition-colors bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:a,children:"Yes, Replace It"}),s.jsx(rs,{onClick:t,children:"No, Keep It"})]})]})})}const Co=({show:e,onHide:t,details:a})=>s.jsx(Ja,{open:e,onOpenChange:t,children:s.jsxs(Ka,{children:[s.jsx(qa,{children:"The chosen file could not be restored."}),a?s.jsxs(s.Fragment,{children:[s.jsx(Ya,{children:"See details below."}),s.jsx("pre",{className:"text-wrap",children:a})]}):void 0,s.jsx(Se,{children:s.jsx(Re,{onClick:t,children:"Ok, I'll try another file"})})]})}),$o={$id:"/Game",type:"object",anyOf:[{required:["id","stage","round","n","p1id"]},{required:["id","stage","round","n","p2id"]}],properties:{id:{type:"number"},stage:{type:"string",enum:["seed","elim"]},round:{type:"number"},n:{type:"number"},p1id:{type:"number"},p2id:{type:"number"},p1points:{type:"number"},p2points:{type:"number"},p1twenties:{type:"number"},p2twenties:{type:"number"},gameRounds:{type:"array",items:{type:"object",properties:{p1points:{type:"number"},p2points:{type:"number"}}}}}},To={$id:"/Player",type:"object",required:["id","name"],properties:{id:{type:"number"},name:{type:"string"},present:{type:"boolean"}}},Po={type:"object",required:["players"],properties:{players:{type:"array",items:{$ref:"/Player"},minItems:1},games:{type:"array",items:{$ref:"/Game"}}}},Ce=new ga;Ce.addSchema(To,"/Player");Ce.addSchema($o,"/Game");const Ao=Ce.compile(Po),Mo=e=>{const t=e;if(!Ao(t))throw new Error(Ce.errorsText());const{players:a,games:n}=t;if(!n)return;const o=new Set,r=d=>{if(o.has(d))return!0;const m=a==null?void 0:a.find(p=>p.id===d);return m&&o.add(m.id),!!m},l=[],i=new Set;if(n.forEach((d,m)=>{d.p1id&&!i.has(d.p1id)&&!r(d.p1id)&&(i.has(d.p1id)||l.push(`instance.games[${m}].p1id is not found in instance.players`),i.add(d.p1id)),d.p2id&&!i.has(d.p2id)&&!r(d.p2id)&&(i.has(d.p2id)||l.push(`instance.games[${m}].p2id is not found in instance.players`),i.add(d.p2id))}),i.size>0)throw new Error(l.map((d,m)=>`${m}: ${d}`).join(`
`))},Eo=({anyData:e})=>{const[t,a]=c.useState(!1),[n,o]=c.useState("crokinole-tourney.json"),[r,l]=c.useState(!1),[i,d]=c.useState(),[m,p]=c.useState(!1),[u,h]=c.useState(),{nPlayers:j}=c.useContext(re),g=async k=>{if(k.preventDefault(),!e)return;a(!0),setTimeout(()=>a(!1),1e3);const R=document.createElement("a"),$=await w.allData();R.href=window.URL.createObjectURL(new Blob([JSON.stringify($,null,2)])),R.setAttribute("download",n),document.body.appendChild(R),R.click()},b=()=>{if(!i)return;p(!1),l(!0),setTimeout(()=>l(!1),1e3);const k=new FileReader;k.onload=R=>{var $;try{const P=JSON.parse(($=R.target)==null?void 0:$.result);Mo(P),w.replace(P)}catch(P){h(P==null?void 0:P.toString())}},k.readAsText(i)},N=async k=>{k.preventDefault(),i!=null&&(e?p(!0):b())},y=k=>{const R=k.target;R.files&&d(R.files[0])};return s.jsxs(J,{children:[s.jsxs(ve,{children:[s.jsx(we,{children:"Save and Restore"}),s.jsx(X,{children:"All data is stored locally and is never uploaded to a server."})]}),s.jsxs("form",{onSubmit:g,children:[s.jsxs(O,{className:"d-flex flex-column flex-lg-row gap-3 flex-wrap justify-content-lg-stretch",children:[s.jsxs("div",{className:"grid w-full items-center gap-2 sm:flex sm:items-end",children:[s.jsxs("div",{className:"flex flex-col space-y-1.5",children:[s.jsx(W,{htmlFor:"save-as",children:"Save As"}),s.jsx(B,{id:"save-as",className:"sm:w-96",disabled:!j,value:n,onChange:k=>o(k.target.value)})]}),s.jsx(q,{variant:"secondary",disabled:!j,working:t,type:"submit",children:"Save"})]}),j?void 0:s.jsx(X,{className:"italic",children:"There is no tournament data to save."})]}),s.jsx(O,{className:"flex justify-end"})]}),s.jsx("form",{onSubmit:N,children:s.jsx(O,{className:"d-flex flex-column flex-lg-row gap-3 flex-wrap justify-content-lg-stretch",children:s.jsxs("div",{className:"grid w-full items-center gap-2 sm:flex sm:items-end",children:[s.jsxs("div",{className:"flex flex-col space-y-1.5",children:[s.jsx(W,{htmlFor:"restore-from",children:"Restore From"}),s.jsx(B,{id:"restore-from",className:"sm:w-96",type:"file",onChange:y})]}),s.jsx(q,{variant:"secondary",disabled:!i,working:r,type:"submit",children:"Restore"})]})})}),s.jsx(Ro,{show:m,onHide:()=>p(!1),onConfirm:b}),s.jsx(Co,{show:!!u,onHide:()=>h(void 0),details:u})]})},qt=c.forwardRef(({className:e,...t},a)=>s.jsx(dt,{ref:a,className:f("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:s.jsx(Xa,{className:f("flex items-center justify-center text-current"),children:s.jsx(_e,{className:"h-4 w-4"})})}));qt.displayName=dt.displayName;const Do=({anyData:e})=>{const[t,a]=c.useState(!0),n=async()=>await w.reset(t==!0),o="transition-colors bg-destructive text-destructive-foreground hover:bg-destructive/90";return e=!0,s.jsxs(J,{className:"text-sm border-destructive/50 dark:border-destructive [&>svg]:text-destructive",children:[s.jsxs(ve,{children:[s.jsx(we,{children:"Danger Zone"}),s.jsxs(X,{children:[s.jsx("i",{children:"Warning!"})," Resetting the tournament will remove all player names, game match-ups, scores, and ranking."]})]}),s.jsx(O,{children:s.jsxs(Ht,{children:[s.jsx(ko,{asChild:!0,children:s.jsx(E,{className:"text-nowrap",disabled:!e,variant:"destructive",children:e?"Reset Tournament":"No Tournament Data"})}),s.jsxs(as,{children:[s.jsxs(Kt,{children:[s.jsx(ns,{children:"Are you absolutely sure?"}),s.jsxs(os,{children:["Resetting the tournament will remove all ",t?"":"player names,"," games, scores, and rakings."]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(qt,{id:"keep-players",checked:t,onCheckedChange:r=>a(r)}),s.jsx("label",{htmlFor:"keep-players",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Keep player names"})]}),s.jsxs(Se,{className:"gap-2 sm:gap-0",children:[s.jsx(Re,{className:o,onClick:n,children:"Yes, Reset It"}),s.jsx(rs,{children:"No, Keep It"})]})]})]})})]})},Io=["Joey Tribbiani","Rachel Green","Monica Geller","Phoebe Buffay","Chandler Bing","Ross Geller","Fraiser Crane","Niles Crane","Daphne Moon","Roz Doyle","Martin Crane","Jerry Seinfeld","George Costanza","Elain Benes","Cosmo Kramer","Fran Fine","Max Sheffield","C.C. Babcock","Niles","Maggie Sheffield","Brighton Sheffield","Gracie Sheffield","Will Truman","Grace Adler","Karen Walker","Jack McFarland","Carrie Bradshaw","Charlotte York","Miranda Hobbes","Samantha Jones","Homer Simpson","Marge Simpson","Bart Simpson","Lisa Simpson","Maggie Simpson","Ned Flanders","Moe Szyslak","Seymour Skinner","Apu Nahasapeemapetilon","Barney Gumble","Clancy Wiggum","Kent Brockman","Jim Kirk","Spock","Montgomery Scott","Leonard McCoy","Nyota Uhura","Hikaru Sulu","Pavel Chekov","Janice Rand","Jean-Luc Picard","William Riker","Geordi La Forge","Tasha Yar","Worf","Beverly Crusher","Diana Troi","Data","Wesley Crusher","Christopher Pike","Christine Chapel","La'an Noonien-Singh","Erica Ortegas","Joseph M'Benga","Una Chin-Riley","Clark Kent","Louis Lane","Jimmy Olsen","Perry White","Lex Luthor","Lana Lang","Vicki Vale","Luke Charles","Heracles Panhellenios","Dane Whitman","Victor Shade","Clint Barton","Peter Parker","Bruce Banner","Steve Rogers","Pietro Maximoff","Thor Odinson","Janet Van Dyne","Hank Pym","Tony Stark","Wanda Maximoff","Carol Danvers","Bucky Barnes","Natasha Romanoff","Sam Wilson","Steven Strange","Jessica Jones","Trish Walker","Maria Hill","Ben Grimm","Matt Murdock","Susan Storm","Reed Richards","Amadeus Cho","Jimmy Howlett","Nick Fury","Phil Coulson","Hubert Wolfeschlegelsteinhausenbergerdorff"];function Lo(e,t=0){const a=ue(Io).slice(0,e).map((n,o)=>({name:n,present:o>=t}));return ue(a)}const zo=(e,t,a,n)=>{n=Math.max(t-n,0);const o=Math.max(Math.max(e-a,n),0),r=Math.min(Math.max(o-n,0),o);return Lo(o,r)};async function Go(){if(await w.games.count()>0)throw new Error("games already exist in the tournament");const e=await w.players.toArray(),t=e.filter(d=>d.present).length,a=zo(20,15,e.length,t);await w.players.bulkAdd(a);const n=await w.players.toArray(),{gamesToAdd:o,nRounds:r}=ao(n);await w.games.bulkAdd(o);const{gamesToAdd:l,nRounds:i}=xo(n,o);return await w.games.bulkAdd(l),{nSeedRounds:r,nElimRounds:i}}const Fo=({anyGames:e})=>{const[t,a]=c.useState(!1),{nPresent:n}=Y(),{setNSeedRounds:o,setNElimRounds:r}=Ze(),l=async()=>{a(!0);const{nSeedRounds:i,nElimRounds:d}=await Go().finally(()=>setTimeout(()=>a(!1),750));o(i),r(d)};return s.jsxs(J,{children:[s.jsxs(ve,{children:[s.jsx(we,{children:"Demo Tournament"}),s.jsx(X,{children:"If you have no tournament data, you can generate a random tournament with scores for all the rounds except the final."})]}),s.jsxs(O,{children:[s.jsx(q,{variant:"secondary",working:t,onClick:l,className:"text-nowrap",disabled:e||n==1,children:"Create Demo Tournament"}),s.jsx(X,{children:e?s.jsx("span",{className:"text-md italic",children:"Reset the current tournament to create a demo tournament."}):n>1?s.jsxs("span",{className:"text-md italic",children:["Tournament will use ",n," present players."]}):n==1?s.jsxs("span",{className:"text-md italic",children:["There is only ",n," player present."]}):void 0})]})]})};function Vo(){const e=K(async()=>await w.anyData()),t=K(async()=>await w.games.count()>0);return s.jsxs(oe,{children:[s.jsx(je,{id:"settings-page",title:"Settings",children:s.jsx("p",{children:"Your tournament data will only be stored on your local device. You can export and restore your tournament data to a json file."})}),s.jsxs(Xe,{className:"grid gap-2",children:[s.jsx(Eo,{anyData:e}),s.jsx(Fo,{anyGames:t}),s.jsx(Do,{anyData:e})]})]})}function Bo(){const{pathname:e}=va();return c.useEffect(()=>{window.scrollTo(0,0)},[e]),null}function Oo(){const e=[{label:"Players",path:"players",element:s.jsx(Hn,{}),icon:s.jsx(We,{strokeWidth:1})},{label:"Matches",path:"matches",element:s.jsx(vo,{}),icon:s.jsx(Ie,{strokeWidth:1,className:"rotate-90"})},{label:"Rankings",path:"rankings",element:s.jsx(No,{}),icon:s.jsx(Ss,{strokeWidth:1})},{label:"Settings",path:"settings",element:s.jsx(Vo,{}),icon:s.jsx(ya,{strokeWidth:1})}];return s.jsx(fn,{defaultTheme:"light",children:s.jsx(qn,{children:s.jsxs(wa,{basename:"/crokinole-tourney/",children:[s.jsx(Bo,{}),s.jsx(pn,{pages:e}),s.jsxs(ja,{children:[e.map(t=>s.jsx(xs,{path:t.path,element:t.element},t.label)),s.jsx(xs,{path:"/",element:s.jsx(xn,{})})]})]})})})}Na.createRoot(document.getElementById("root")).render(s.jsx(se.StrictMode,{children:s.jsx(Oo,{})}));
