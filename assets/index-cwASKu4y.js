var lt=Object.defineProperty;var dt=(s,t,a)=>t in s?lt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var te=(s,t,a)=>(dt(s,typeof t!="symbol"?t+"":t,a),a);import{t as ct,j as mt,r as c,k as e,m as q,L as ke,N as We,C as Re,n as be,p as Xe,q as ut,X as ft,v as Ce,w as V,x as pt,F as Ze,A as ht,y as xt,z as bt,B as gt,D as jt,E as wt,G as vt,H as Ue,S as yt,I as Nt,R as kt}from"./vendor-VajUllzI.js";import{$ as Qe,a as es,b as ss,C as ts,c as as,d as ns,e as os,f as Rt,g as Ct,h as rs,i as St,j as is,k as $t,l as ls,m as ds,n as cs,o as ms,p as Se,q as us,D as Tt,r as fs,s as ps,t as At,u as Mt,v as hs,w as xs,x as Pt,y as bs,z as gs,A as Et,B as js,E as Dt,M as It,F as Lt,R as Gt,G as zt,H as Ft,I as ws,J as vs,K as ys,L as Bt,N as Vt,O as Wt,P as Ns,Q as Ut,S as Ot,T as ks,U as Rs,V as Ht,W as Cs,X as Ss,Y as $s,Z as Ts,_ as As,a0 as Ms,a1 as Jt,a2 as _t,a3 as qt,a4 as Kt,a5 as Yt,a6 as Xt,a7 as Zt,a8 as Ps,a9 as Qt}from"./@radix-ui-nJY29eVK.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const r of d.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function a(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerPolicy&&(d.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?d.credentials="include":o.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function n(o){if(o.ep)return;o.ep=!0;const d=a(o);fetch(o.href,d)}})();function f(...s){return ct(mt(s))}const $e=s=>s>0?Array.from(Array(Math.floor(s)).keys()):[],ne=s=>{let t=s.length;for(;t>0;){const a=Math.floor(Math.random()*t--);[s[t],s[a]]=[s[a],s[t]]}return s},ge=c.forwardRef(({className:s,children:t,...a},n)=>e.jsxs(Qe,{ref:n,className:f("relative z-10 flex max-w-max flex-1 items-center justify-center",s),...a,children:[t,e.jsx(Es,{})]}));ge.displayName=Qe.displayName;const je=c.forwardRef(({className:s,...t},a)=>e.jsx(es,{ref:a,className:f("group flex flex-1 list-none items-center justify-center space-x-1",s),...t}));je.displayName=es.displayName;const xe=Rt,ea=q("group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50"),sa=c.forwardRef(({className:s,children:t,...a},n)=>e.jsxs(ss,{ref:n,className:f(ea(),"group",s),...a,children:[t," ",e.jsx(ts,{className:"relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180","aria-hidden":"true"})]}));sa.displayName=ss.displayName;const ta=c.forwardRef(({className:s,...t},a)=>e.jsx(as,{ref:a,className:f("left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",s),...t}));ta.displayName=as.displayName;const Es=c.forwardRef(({className:s,...t},a)=>e.jsx("div",{className:f("absolute left-0 top-full flex justify-center"),children:e.jsx(ns,{className:f("origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",s),ref:a,...t})}));Es.displayName=ns.displayName;const aa=c.forwardRef(({className:s,...t},a)=>e.jsx(os,{ref:a,className:f("top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",s),...t,children:e.jsx("div",{className:"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md"})}));aa.displayName=os.displayName;const Te=q("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),M=c.forwardRef(({className:s,variant:t,size:a,asChild:n=!1,...o},d)=>{const r=n?Ct:"button";return e.jsx(r,{className:f(Te({variant:t,size:a,className:s})),ref:d,...o})});M.displayName="Button";const na=c.forwardRef(({className:s,inset:t,children:a,...n},o)=>e.jsxs(rs,{ref:o,className:f("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",s),...n,children:[a,e.jsx(St,{className:"ml-auto h-4 w-4"})]}));na.displayName=rs.displayName;const oa=c.forwardRef(({className:s,...t},a)=>e.jsx(is,{ref:a,className:f("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t}));oa.displayName=is.displayName;const ra=c.forwardRef(({className:s,sideOffset:t=4,...a},n)=>e.jsx($t,{children:e.jsx(ls,{ref:n,sideOffset:t,className:f("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a})}));ra.displayName=ls.displayName;const ia=c.forwardRef(({className:s,inset:t,...a},n)=>e.jsx(ds,{ref:n,className:f("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",s),...a}));ia.displayName=ds.displayName;const la=c.forwardRef(({className:s,children:t,checked:a,...n},o)=>e.jsxs(cs,{ref:o,className:f("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:a,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ms,{children:e.jsx(Se,{className:"h-4 w-4"})})}),t]}));la.displayName=cs.displayName;const da=c.forwardRef(({className:s,children:t,...a},n)=>e.jsxs(us,{ref:n,className:f("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ms,{children:e.jsx(Tt,{className:"h-4 w-4 fill-current"})})}),t]}));da.displayName=us.displayName;const ca=c.forwardRef(({className:s,inset:t,...a},n)=>e.jsx(fs,{ref:n,className:f("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",s),...a}));ca.displayName=fs.displayName;const ma=c.forwardRef(({className:s,...t},a)=>e.jsx(ps,{ref:a,className:f("-mx-1 my-1 h-px bg-muted",s),...t}));ma.displayName=ps.displayName;const ua={theme:"system",setTheme:()=>null},fa=c.createContext(ua);function pa({children:s,defaultTheme:t="system",storageKey:a="vite-ui-theme",...n}){const[o,d]=c.useState(()=>localStorage.getItem(a)||t);c.useEffect(()=>{const i=window.document.documentElement;if(i.classList.remove("light","dark"),o==="system"){const l=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";i.classList.add(l);return}i.classList.add(o)},[o]);const r={theme:o,setTheme:i=>{localStorage.setItem(a,i),d(i)}};return e.jsx(fa.Provider,{...n,value:r,children:s})}function ha({pages:s}){const t="sticky top-0 z-50 flex justify-center w-full shadow-sm backgrop-blur p-1 border-b border-border/40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/40",a="group inline-flex h-9 w-max items-center justify-center font-light rounded-md px-4 py-2 text-sm transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50",n=o=>{if(o.icon)return o.icon;if(o.label=="Players")return e.jsx(Re,{strokeWidth:1})};return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:t,children:e.jsxs(ge,{className:"flex w-full justify-center sm:justify-between max-w-2xl",children:[e.jsx(ke,{to:"/",children:e.jsxs(xe,{className:f(a,"mx-1 px-1 pr-4 font-bold"),children:[e.jsx("img",{alt:"hand-flick-logo",className:"max-h-6 pr-2",src:"/crokinole-tourney//hand-flick-sticker.svg"}),e.jsx("span",{children:"Crokinole Tourney"})]})}),e.jsx(je,{className:"bg-none hidden sm:inline",children:s.map(o=>e.jsx(We,{to:o.path,children:({isActive:d})=>e.jsx(xe,{className:f(a,{"font-semibold":d}),children:o.label})},o.label))}),void 0]})}),e.jsx("footer",{className:"sm:hidden w-full z-50 flex justify-around text-white bg-sky-800 fixed bottom-0 p-1 font-light",children:e.jsx(ge,{children:e.jsx(je,{className:"bg-none",children:s.map(o=>e.jsx(We,{to:o.path,children:({isActive:d})=>e.jsx(xe,{className:f(a,{"font-semibold":d}),children:n(o)})},o.label))})})})]})}const I=({className:s,...t})=>e.jsx(ke,{className:f("font-bold rounded hover:underline cursor-pointer border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background",s),...t});function Z({children:s}){return e.jsx("div",{className:"flex w-full justify-center mb-20",children:e.jsx("div",{className:"w-full max-w-2xl",children:s})})}const B=c.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:f("rounded-xl border bg-card text-card-foreground shadow",s),...t}));B.displayName="Card";const ie=c.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:f("flex flex-col space-y-1.5 p-6",s),...t}));ie.displayName="CardHeader";const le=c.forwardRef(({className:s,...t},a)=>e.jsx("h3",{ref:a,className:f("font-semibold leading-none tracking-tight",s),...t}));le.displayName="CardTitle";const O=c.forwardRef(({className:s,...t},a)=>e.jsx("p",{ref:a,className:f("text-sm text-muted-foreground",s),...t}));O.displayName="CardDescription";const L=c.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:f("p-6 pt-0",s),...t}));L.displayName="CardContent";const xa=c.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:f("flex items-center p-6 pt-0",s),...t}));xa.displayName="CardFooter";const ba=()=>e.jsxs(Z,{children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-xl font-extrabold my-5",children:"Welcome to Crokinole Tourney!"}),e.jsx("p",{children:"A super-simple way to score Crokinole tournaments."}),e.jsx("img",{className:"inline h-24 my-4",alt:"hand-flick-logo",src:"/crokinole-tourney//hand-flick-sticker.svg"}),e.jsx("p",{children:"Just 3 easy steps."})]}),e.jsxs("div",{className:"flex flex-wrap justify-center",children:[e.jsxs(B,{className:"my-6 w-60 mx-3",children:[e.jsx("div",{className:"relative -top-4 w-full",children:e.jsx("span",{className:"m-auto bg-sky-700 rounded-full text-center text-white font-black block pt-0.5 w-8 h-8 text-xl",children:"1"})}),e.jsxs(L,{className:"text-center text-xl",children:["Start by adding ",e.jsx(I,{to:"/players",children:"Players"})," to the tournament.",e.jsx("div",{className:"w-full flex justify-center mt-4",children:e.jsx(ke,{to:"/players",children:e.jsx(M,{variant:"ghost",className:"p-0 w-16 h-16",children:e.jsx(Re,{size:"3em"})})})})]})]}),e.jsxs(B,{className:"my-6 w-60 mx-3",children:[e.jsx("div",{className:"relative -top-4 w-full",children:e.jsx("span",{className:"m-auto bg-teal-700 rounded-full text-center text-white font-black block pt-0.5 w-8 h-8 text-xl",children:"2"})}),e.jsxs(L,{className:"text-center text-xl",children:["Score the Seed ",e.jsx(I,{to:"/players",children:"Matches"})," to ",e.jsx(I,{to:"/rankings",children:"Rank"})," players.",e.jsxs("div",{className:"w-full flex justify-center items-center mt-4",children:[e.jsx(I,{to:"/matches",children:e.jsx(M,{variant:"ghost",className:"p-0 w-16 h-16",children:e.jsx(be,{size:"3em",className:"rotate-90"})})}),e.jsx("span",{className:"-mx-2 z-10 text-black text-2xl",children:"+"}),e.jsx(I,{to:"/rankings",children:e.jsx(M,{variant:"ghost",className:"p-0 w-16 h-16",children:e.jsx(Xe,{size:"3em"})})})]})]})]}),e.jsxs(B,{className:"my-6 w-60 mx-3",children:[e.jsx("div",{className:"relative -top-4 w-full",children:e.jsx("span",{className:"m-auto bg-green-700 rounded-full text-center text-white font-black block pt-0.5 w-8 h-8 text-xl",children:"3"})}),e.jsxs(L,{className:"text-center text-xl",children:["Score the Elimination ",e.jsx(I,{to:"/players",children:"Matches"})," to decide the champion!",e.jsx("div",{className:"w-full flex justify-center items-center mt-4",children:e.jsx(I,{to:"/matches",children:e.jsx(M,{variant:"ghost",className:"p-0 w-16 h-16",children:e.jsx(be,{size:"3em",className:"rotate-90"})})})})]})]})]})]}),ga=Pt,Ds=c.forwardRef(({className:s,...t},a)=>e.jsx(At,{ref:a,className:f("border-b",s),...t}));Ds.displayName="AccordionItem";const Is=c.forwardRef(({className:s,children:t,...a},n)=>e.jsx(Mt,{className:"flex",children:e.jsxs(hs,{ref:n,className:f("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",s),...a,children:[t,e.jsx(ts,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}));Is.displayName=hs.displayName;const Ls=c.forwardRef(({className:s,children:t,...a},n)=>e.jsx(xs,{ref:n,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...a,children:e.jsx("div",{className:f("pb-4 pt-0",s),children:t})}));Ls.displayName=xs.displayName;function de({id:s,title:t,children:a}){const[n,o]=ut(s,!1),d=()=>o(!n);return e.jsx(ga,{className:"pb-2 w-full",type:"single",defaultValue:n?void 0:"item-1",collapsible:!0,onValueChange:d,children:e.jsxs(Ds,{value:"item-1",className:"px-2",children:[e.jsx(Is,{children:t}),e.jsx(Ls,{className:"grid gap-2",children:a})]})})}const ja=q("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),H=c.forwardRef(({className:s,...t},a)=>e.jsx(bs,{ref:a,className:f(ja(),s),...t}));H.displayName=bs.displayName;const we=c.forwardRef(({className:s,...t},a)=>e.jsx(gs,{className:f("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...t,ref:a,children:e.jsx(Et,{className:f("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));we.displayName=gs.displayName;function Ae(s){if(!s.children)return e.jsx(we,{...s});const t=s.id||Math.random().toString(36).slice(2);return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{...s,id:t}),e.jsx(H,{htmlFor:t,...s.labelProps,children:s.children})]})}const wa=q("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-3",sm:"h-8 px-2",lg:"h-10 px-3"}},defaultVariants:{variant:"default",size:"default"}}),Gs=c.forwardRef(({className:s,variant:t,size:a,...n},o)=>e.jsx(js,{ref:o,className:f(wa({variant:t,size:a,className:s})),...n}));Gs.displayName=js.displayName;class va extends ft{constructor(){super("crokinole-tourney");te(this,"tournament");te(this,"players");te(this,"games");this.version(1).stores({tournament:"++id, name",players:"++id, name",games:"++id, stage, p1id, p2id"})}async anyData(){return!!(await this.players.count()||await this.games.count())}async allData(){const a=await this.players.toArray(),n=await this.games.toArray();return{players:a,games:n}}async reset(a){a||await b.players.clear(),await b.games.clear()}async replace(a){const{players:n,games:o=[]}=a;await b.games.clear(),await b.players.bulkPut(n),await b.games.bulkPut(o)}}const b=new va,W=c.forwardRef(({className:s,type:t,...a},n)=>e.jsx("input",{type:t,className:f("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:n,...a}));W.displayName="Input";const ya=q("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Me({className:s,variant:t,...a}){return e.jsx("div",{className:f(ya({variant:t}),s),...a})}function zs({empty:s,duplicate:t}){const a=t===!0,n=t===void 0,o=s?"empty":t===!0?"duplicate":"possible duplicate";return e.jsx(e.Fragment,{children:a||n?e.jsx(Me,{className:f("text-center",{"bg-amber-500 hover:bg-amber-400":n}),variant:a?"destructive":void 0,children:o}):void 0})}function Na({player:s,isDuplicate:t}){const[a,n]=c.useState(s.name||""),[o,d]=Ce(s.name||"",250),r=k=>{n(k),d(k),s&&b.players.update(s.id,{name:k.trim()})},i=!!s.present,l=k=>{s&&b.players.update(s.id,{present:k})},m=()=>l(!i),p=c.useMemo(()=>t(o,s),[t,o,s]),u=!a.trim(),v=(V(async()=>{const k=await b.games.where("p1id").equals((s==null?void 0:s.id)||-1).count(),G=await b.games.where("p2id").equals((s==null?void 0:s.id)||-1).count();return k+G},[s==null?void 0:s.id])||0)>0,[g,w]=c.useState(!1),C=async()=>{(s==null?void 0:s.id)!=null&&(g?await b.players.delete(s.id):w(!0))},N=c.useRef(null);pt(N,()=>w(!1));const y=g?"destructive":"ghost",$=g?"":"text-slate-500",P=g?e.jsx(e.Fragment,{children:"Remove Player"}):e.jsx(Dt,{});return e.jsxs("form",{className:"flex items-center space-x-2 mb-1",onSubmit:k=>k.preventDefault(),children:[e.jsx(Ae,{checked:i,onCheckedChange:m}),e.jsx(W,{className:"max-w-sm",type:"text",placeholder:"Player name",value:a,onChange:k=>r(k.target.value)}),v?e.jsx(Me,{variant:"secondary",className:"text-slate-500 px-1",children:"locked"}):e.jsx(M,{ref:N,variant:y,size:g?void 0:"icon",className:$,onClick:C,onBlur:()=>w(!1),children:P}),e.jsx(zs,{empty:u,duplicate:p})]})}const ka=({isDuplicate:s})=>{const[t,a]=c.useState(""),[n,o]=Ce("",250),d=h=>{a(h),o(h)},[r,i]=c.useState(!0),l=()=>i(!r),m=h=>{h.preventDefault(),t.trim()&&b.players.add({name:t.trim(),present:r}).then(()=>d(""))},p=c.useMemo(()=>s(n),[s,n]),u=p===!0;return e.jsxs("form",{onSubmit:m,className:"flex items-center space-x-2",children:[e.jsx(Ae,{checked:r,onCheckedChange:l}),e.jsx(W,{className:"max-w-sm",type:"text",placeholder:"Player name",value:t,onChange:h=>d(h.target.value)}),e.jsx(M,{type:"submit",disabled:u,children:"Add"}),e.jsx(zs,{duplicate:p})]})};function Ra(s=250){const[t,a]=c.useState(""),[n,o]=Ce("",s),d=i=>{a(i),o(i)},r=c.useCallback((i,l,m)=>{var h;if(!n.trim())return[i,Number.MAX_SAFE_INTEGER];const p=new Ze(i,{...l,includeScore:!0},m).search(n);let u=(h=p[0])==null?void 0:h.score;return u=u??Number.MAX_SAFE_INTEGER,[p.map(v=>v.item),u]},[n]);return[t,d,r]}var Ye;const Ca=(Ye=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value"))==null?void 0:Ye.set;function Oe(s){const t={...s};delete t.divClassName,delete t.onValueChange;const[a,n]=c.useState(""),o=s.value||"";c.useEffect(()=>n(o),[o]);const d=m=>{n(m),s.onValueChange&&s.onValueChange(m)};return e.jsxs("div",{className:f("relative text-sm",s.divClassName),children:[e.jsx("input",{placeholder:"Search...",type:"text",...t,className:f("flex h-7 w-full rounded-full bg-slate-200 hover:bg-slate-100 focus-visible:bg-slate-100 px-7 py-0 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",s.className),value:a,onChange:m=>d(m.target.value)}),e.jsx(It,{className:"absolute text-muted-foreground left-[0.5rem] top-[0.5rem] pointer-events-none text-sm"}),a&&Ca?e.jsx(M,{onClick:()=>d(""),variant:"ghost",size:"icon",className:"absolute h-5 w-5 rounded-full absolute top-1 right-[0.25rem] text-muted-foreground mx-0 hover:bg-slate-300",children:e.jsx(Lt,{})}):void 0]})}const Q=c.createContext({players:[],nPlayers:0,nPresent:0,findPlayer:()=>{},hasPresentUndo:!1,storePresentUndo:()=>{},retrievePresentUndo:()=>[]}),Fs=({players:s=[],children:t})=>{const a=s.length,n=s.filter(u=>u.present).length,o=u=>u?s==null?void 0:s.find(h=>h.id==u):void 0,d=c.useRef([]),[r,i]=c.useState(!1),p={players:s,nPlayers:a,nPresent:n,findPlayer:o,hasPresentUndo:r,storePresentUndo:u=>{d.current=[...u.map(h=>({...h}))],i(!!u.length)},retrievePresentUndo:()=>{const u=d.current;return d.current=[],i(!1),u}};return e.jsx(Q.Provider,{value:p,children:t})},ee=()=>c.useContext(Q);function Pe({children:s,className:t,...a}){return e.jsx("div",{className:f("w-full sm:x-xl2 grid gap-2 px-2",t),...a,children:s})}function Sa(){const[s,t]=c.useState(0),a=s!=0,n=()=>t((s+2)%3-1),[o,d,r]=Ra(250),i=!!o.trim(),{hasPresentUndo:l,storePresentUndo:m,retrievePresentUndo:p}=ee(),u=V(async()=>{let x;return s&&!i?(x=await b.players.orderBy("name").toArray(),s==-1&&x.reverse()):x=await b.players.toArray(),x},[s]),[h,v]=c.useMemo(()=>r(u||[],{keys:["name"]}),[u,r]),g=.3,w=u!=null&&u.length?u.reduce((x,j)=>(j.present&&x++,x),0):0,C=u!=null&&u.length?w==u.length:!1,N=w==0,y=h.length==(u==null?void 0:u.length),$=async()=>{!C&&!N&&m(h),h.forEach(x=>b.players.update(x.id,{present:!C}))},P=async()=>{p().forEach(x=>b.players.update(x.id,{present:x.present}))},k=(C||N)&&l,G=c.useCallback((x,j)=>{const R=(new Ze(u||[],{keys:["name"],includeScore:!0}).search(x)||[]).filter(it=>it.item.id!=(j==null?void 0:j.id)),S=R.slice(0,1)[0],T=(S==null?void 0:S.score)||Number.MAX_SAFE_INTEGER,A=1e-10,D=.3,E=.35,rt=R.length==1;if(T<A)return!0;if(x.trim().length<3)return!1;if(!(T<D)&&!(T<E&&rt))return!1},[u]);return e.jsxs(Z,{children:[e.jsxs(de,{id:"players-title",title:"Players",children:[e.jsx("p",{children:"Add player names to the tournament roster. They can be marked absent between seed or elimination matches."}),e.jsx("p",{children:"Players will be locked and cannot be removed if have been matched in a game. Locked players can be marked absent for future rounds."})]}),e.jsxs(Pe,{children:[e.jsx("div",{className:"flex justify-center mb-1",children:e.jsx(Oe,{divClassName:"sm:hidden",value:o,onValueChange:d})}),e.jsxs("div",{className:"w-full flex justify-between mb-2 space-x-2 items-center",children:[e.jsxs("div",{className:"flex space-x-2 items-center",children:[e.jsxs(Ae,{disabled:!y,checked:C,onCheckedChange:$,children:[e.jsx("span",{className:"hidden sm:inline",children:"All Players Present"}),e.jsx("span",{className:"sm:hidden",children:"All Present"})]}),u!=null&&u.length?e.jsxs(Me,{className:"ml-1 text-muted-foreground",variant:"outline",children:[w!=(u==null?void 0:u.length)?`${w} of`:void 0," ",u==null?void 0:u.length]}):void 0,k?e.jsx(M,{size:"icon",variant:"ghost",onClick:P,children:e.jsx(Gt,{})}):void 0]}),e.jsxs("div",{className:"flex align-end items-center space-x-2",children:[e.jsx(Oe,{divClassName:"hidden sm:block",value:o,onValueChange:d}),e.jsx(Gs,{className:f("px-2 py-2 h-9 w-9",{"text-slate-500":!a}),pressed:a&&!i,onClick:n,disabled:i,children:s!=-1?e.jsx(ht,{strokeWidth:1}):e.jsx(xt,{strokeWidth:1})})]})]}),i?e.jsxs("div",{className:"text-xs my-2 text-muted-foreground w-full text-center",children:[h.length==0?e.jsx(e.Fragment,{children:"No matches found."}):void 0,v>g?e.jsx(e.Fragment,{children:"No close matches found."}):e.jsxs(e.Fragment,{children:["Showing top ",h.length," matches."]})]}):void 0,h.map(x=>e.jsx(Na,{player:x,isDuplicate:G},x.id)),e.jsx(ka,{isDuplicate:G})]})]})}const Bs=c.createContext(null);function ce(){const s=c.useContext(Bs);if(!s)throw new Error("useCarousel must be used within a <Carousel />");return s}const Vs=c.forwardRef(({orientation:s="horizontal",opts:t,setApi:a,plugins:n,className:o,children:d,...r},i)=>{const[l,m]=bt({...t,axis:s==="horizontal"?"x":"y"},n),[p,u]=c.useState(!1),[h,v]=c.useState(!1),g=c.useCallback(y=>{y&&(u(y.canScrollPrev()),v(y.canScrollNext()))},[]),w=c.useCallback(()=>{m==null||m.scrollPrev()},[m]),C=c.useCallback(()=>{m==null||m.scrollNext()},[m]),N=c.useCallback(y=>{y.key==="ArrowLeft"?(y.preventDefault(),w()):y.key==="ArrowRight"&&(y.preventDefault(),C())},[w,C]);return c.useEffect(()=>{!m||!a||a(m)},[m,a]),c.useEffect(()=>{if(m)return g(m),m.on("reInit",g),m.on("select",g),()=>{m==null||m.off("select",g)}},[m,g]),e.jsx(Bs.Provider,{value:{carouselRef:l,api:m,opts:t,orientation:s||((t==null?void 0:t.axis)==="y"?"vertical":"horizontal"),scrollPrev:w,scrollNext:C,canScrollPrev:p,canScrollNext:h},children:e.jsx("div",{ref:i,onKeyDownCapture:N,className:f("relative",o),role:"region","aria-roledescription":"carousel",...r,children:d})})});Vs.displayName="Carousel";const ve=c.forwardRef(({className:s,...t},a)=>{const{carouselRef:n,orientation:o}=ce();return e.jsx("div",{ref:n,className:"overflow-hidden",children:e.jsx("div",{ref:a,className:f("flex",o==="horizontal"?"-ml-4":"-mt-4 flex-col",s),...t})})});ve.displayName="CarouselContent";const ae=c.forwardRef(({className:s,...t},a)=>{const{orientation:n}=ce();return e.jsx("div",{ref:a,role:"group","aria-roledescription":"slide",className:f("min-w-0 shrink-0 grow-0 basis-full",n==="horizontal"?"pl-4":"pt-4",s),...t})});ae.displayName="CarouselItem";const Ws=c.forwardRef(({className:s,variant:t="outline",size:a="icon",...n},o)=>{const{orientation:d,scrollPrev:r,canScrollPrev:i}=ce();return e.jsxs(M,{ref:o,variant:t,size:a,className:f("absolute  h-8 w-8 rounded-full",d==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",s),disabled:!i,onClick:r,...n,children:[e.jsx(zt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Previous slide"})]})});Ws.displayName="CarouselPrevious";const Us=c.forwardRef(({className:s,variant:t="outline",size:a="icon",...n},o)=>{const{orientation:d,scrollNext:r,canScrollNext:i}=ce();return e.jsxs(M,{ref:o,variant:t,size:a,className:f("absolute h-8 w-8 rounded-full",d==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",s),disabled:!i,onClick:r,...n,children:[e.jsx(Ft,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Next slide"})]})});Us.displayName="CarouselNext";const $a=Bt,Os=c.forwardRef(({className:s,...t},a)=>e.jsx(ws,{ref:a,className:f("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",s),...t}));Os.displayName=ws.displayName;const ye=c.forwardRef(({className:s,...t},a)=>e.jsx(vs,{ref:a,className:f("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",s),...t}));ye.displayName=vs.displayName;const Ta=c.forwardRef(({className:s,...t},a)=>e.jsx(ys,{ref:a,className:f("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));Ta.displayName=ys.displayName;const me=s=>Math.ceil(Math.log2(s)),ue=s=>Math.round(-.25+Math.log2(s/2)),Hs=c.createContext({nGameRounds:4,setNGameRounds:()=>{},defaultNGameRounds:4,nSeedRounds:4,setNSeedRounds:()=>{},defaultNSeedRounds:4,nElimRounds:4,setNElimRounds:()=>{},defaultNElimRounds:4,players:[],games:[]}),Aa=({children:s})=>{const t=V(()=>b.players.toArray())||[],a=V(()=>b.games.toArray())||[],n=t.reduce((g,w)=>g+(w!=null&&w.present?1:0),0),o=me(n),d=ue(n),r=4,[i,l]=c.useState(r),[m,p]=c.useState(o),[u,h]=c.useState(d),v={nGameRounds:i,setNGameRounds:l,defaultNGameRounds:r,nSeedRounds:m,setNSeedRounds:p,defaultNSeedRounds:o,nElimRounds:u,setNElimRounds:h,defaultNElimRounds:d,players:t,games:a};return e.jsx(Hs.Provider,{value:v,children:e.jsx(Fs,{players:t,children:s})})},Ee=()=>c.useContext(Hs),J=s=>{if(s.p1id==null)return s.p2id;if(s.p2id==null||(s.p1points||0)>(s.p2points||0))return s.p1id;if((s.p1points||0)<(s.p2points||0))return s.p2id;if((s.p1twenties||0)>(s.p2twenties||0))return s.p1id;if((s.p1twenties||0)<(s.p2twenties||0))return s.p2id},Ma=(s,t=4)=>{if(s.p1twenties!=s.p2twenties||K(s,t))return!1;const a=s.gameRounds||[],[n,o]=a.reduce(([d,r],i)=>[d+((i==null?void 0:i.p1points)||0),r+(i==null?void 0:i.p2points)],[0,0]);return n==o},Pa=(s,t=4)=>{if(s.stage!="elim")return!1;let a=s.gameRounds||[];if(a.length<t||K(s,t,t))return!1;a=a.slice(0,t);const[n,o]=a.reduce(([d,r],i)=>[d+((i==null?void 0:i.p1points)||0),r+(i==null?void 0:i.p2points)],[0,0]);return n==o},K=(s,t=4,a=0)=>{if((s.p1twenties||0)>0||(s.p2twenties||0)>0||(s.p1points||0)>0||(s.p2points||0)>0)return!1;let n=s.gameRounds||[];if(n.length<t)return!0;a>0&&(n=n.slice(0,a));const o=n.findIndex(r=>r==null)>=0,d=n.find(r=>r==null?!0:r.p1points==0&&r.p2points==0);return o||!!d},Js=s=>(s.p1twenties||0)>0||(s.p2twenties||0)>0||(s.p1points||0)>0||(s.p2points||0)>0?!0:!!(s.gameRounds||[]).find(n=>n==null?!1:n.p1points>0||n.p2points>0),oe=s=>s.p1id==null||s.p2id==null,Ea=q("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Y=c.forwardRef(({className:s,variant:t,...a},n)=>e.jsx("div",{ref:n,role:"alert",className:f(Ea({variant:t}),s),...a}));Y.displayName="Alert";const De=c.forwardRef(({className:s,...t},a)=>e.jsx("h5",{ref:a,className:f("mb-1 font-medium leading-none tracking-tight",s),...t}));De.displayName="AlertTitle";const _=c.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:f("text-sm [&_p]:leading-relaxed",s),...t}));_.displayName="AlertDescription";const U=s=>{const{working:t,children:a}=s,n=s.disabled||t,o={...s,disabled:n};return delete o.children,delete o.working,e.jsxs(M,{...o,children:[t?e.jsx(Vt,{className:"mr-2 h-4 w-4 animate-spin"}):void 0,a]})},Da=s=>{const t=[],a=[];return s.forEach(n=>{n.id!=null&&(n.present?t.push(n.id):a.push(n.id))}),{presentPlayers:t,absentPlayers:a}},Ia=(s,t,a,n)=>{const o=[],d=[],r=[],i=[];return s.forEach(l=>{const m=l.p1id==null||a.indexOf(l.p1id)>=0,p=l.p2id==null||a.indexOf(l.p2id)>=0,u=m&&p;!oe(l)&&Js(l)?(l.p1id&&d.push(l.p1id),l.p2id&&d.push(l.p2id)):u?l.id!==void 0&&r.push(l.id):m?(o.push(l.p2id),l.id!==void 0&&(r.push(l.id),i.push(l.id))):p?(o.push(l.p1id),l.id!==void 0&&(r.push(l.id),i.push(l.id))):n?(o.push(l.p1id),o.push(l.p2id),l.id!==void 0&&r.push(l.id)):(d.push(l.p1id),d.push(l.p2id))}),t.forEach(l=>{const m=d.indexOf(l)>=0,p=o.indexOf(l)>=0;!m&&!p&&o.push(l)}),{unmatchedPlayers:o,gamesToDelete:r,byeGames:i}};function se(s,t,a=!1){const{presentPlayers:n,absentPlayers:o}=Da(s),{unmatchedPlayers:d,gamesToDelete:r,byeGames:i}=Ia(t,n,o,a);return{unmatchedPlayers:d,gamesToDelete:r,byeGames:i}}const He=(s,t)=>a=>a.p1id==s&&a.p2id==t||a.p1id==t&&a.p2id==s;function La(s,t){const a=n=>typeof n=="number"?n:n==null?void 0:n.id;for(let n=0;n<s.length;n+=2){let o=t.find(He(a(s[n]),a(s[n+1]))),d=n+2;for(;o!=null&&d<s.length;)[s[n+1],s[d]]=[s[d],s[n+1]],o=t.find(He(a(s[n]),a(s[n+1]))),d+=1}}function _s(s,t,a=4,n=!0,o=!1){let d,r,i,l;const m=[];if(s==null||t==null){d=4,r=4;for(let p=0;p<a;p++)m.push({p1points:1,p2points:1})}else if(n){const p=s>t?.55:.45;d=r=0,i=l=0;for(let u=0;u<a;u++)if(Math.random()<.02){d+=1,r+=1,m.push({p1points:1,p2points:1});const h=Math.floor(Math.random()*5);i+=h,l+=h}else if(Math.random()<p){d+=2,m.push({p1points:2,p2points:0});const h=Math.floor(Math.random()*5);i=h,l=Math.floor(Math.random()*h)}else{r+=2,m.push({p1points:0,p2points:2});const h=Math.floor(Math.random()*5);l=h,i=Math.floor(Math.random()*h)}if(o&&d==r&&i==l){const u=Math.floor(Math.random()*5);Math.random()<.5?(d+=2,i+=u,l+=Math.floor(Math.random()*u)):(r+=2,l+=u,i+=Math.floor(Math.random()*u))}}return{p1points:d,p2points:r,p1twenties:i,p2twenties:l,gameRounds:m}}function Ie(s,t){const a=o=>typeof o=="number"?o:(o==null?void 0:o.id)==null?Number.NEGATIVE_INFINITY:o.id;if(t.length==0)return ne(s);const n={};return t.forEach(o=>{if(o.p1id!=null){const d=n[o.p1id]=n[o.p1id]||{points:0,twenties:0,wins:0,draws:0};d.points+=o.p1points||0,d.twenties+=o.p1twenties||0;const r=J(o);o.p1id==r?d.wins+=1:o.p2id==null&&(d.draws+=1)}if(o.p2id!=null){const d=n[o.p2id]=n[o.p2id]||{points:0,twenties:0,wins:0,draws:0};d.points+=o.p2points||0,d.twenties+=o.p2twenties||0;const r=J(o);o.p2id==r?d.wins+=1:o.p2id==null&&(d.draws+=1)}}),s.sort((o,d)=>{const r=a(o),i=a(d),l=n[r]||{points:0,twenties:0,wins:0,draws:0},m=n[i]||{points:0,twenties:0,wins:0,draws:0};return l.points>m.points?-1:l.points<m.points?1:l.twenties>m.twenties?-1:l.twenties<m.twenties?1:l.wins>m.wins?-1:l.wins<m.wins?1:l.draws>m.draws?-1:l.draws<m.draws?1:0}),s}const Ga=(s,t,a=[],n=4,o=!1)=>{const d=[];if(t.length%2!=0&&t.push(void 0),s===0)ne(t);else{const r=a.filter(i=>i.stage=="seed"&&i.round<s);Ie(t,r),La(t,r)}for(let r=0;r<t.length;r+=2){let i=t[r],l=t[r+1];i==null&&([i,l]=[l,i]);const{p1points:m,p2points:p,p1twenties:u,p2twenties:h,gameRounds:v}=_s(i,l,n,o);d.push({stage:"seed",round:s,n:r/2,p1id:i,p2id:l,p1points:m,p2points:p,p1twenties:u,p2twenties:h,gameRounds:v})}return d},Le=(s,t,a=[],n=4,o=!1,d=!0)=>{const r=a.filter(p=>p.stage=="seed"&&p.round==s),{unmatchedPlayers:i,gamesToDelete:l}=se(t,r,!d);return{gamesToAdd:Ga(s,i,a,n,o),gamesToDelete:l}},za=(s,t=4)=>{const a=[],{unmatchedPlayers:n}=se(s,[]),o=me(n.length);for(let d=0;d<o;d++){const{gamesToAdd:i}=Le(d,s,a,t,!0);i.forEach(l=>a.push(l))}return{gamesToAdd:a,nRounds:o}},Fa=Ut,Ba=Ot,qs=c.forwardRef(({className:s,align:t="center",sideOffset:a=4,...n},o)=>e.jsx(Wt,{children:e.jsx(Ns,{ref:o,align:t,sideOffset:a,className:f("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})}));qs.displayName=Ns.displayName;function Je({game:s,rn:t,pn:a,onClick:n,disabled:o,small:d}){var h;const r=(h=s.gameRounds)==null?void 0:h[t];let i=isNaN((r==null?void 0:r.p1points)||NaN)&&isNaN((r==null?void 0:r.p2points)||NaN)?"?":((r==null?void 0:r.p1points)||0)>((r==null?void 0:r.p2points)||0)?"win":((r==null?void 0:r.p1points)||0)<((r==null?void 0:r.p2points)||0)?"loss":"draw";a==2&&(i=i=="win"?"loss":i=="loss"?"win":i);const l="",m="",p="w-9 justify-center uppercase text-white",u={win:"bg-emerald-700 hover:bg-emerald-600",loss:"bg-rose-800 hover:bg-rose-700",draw:"bg-slate-500 hover:bg-slate-400","?":"bg-slate-300 hover:bg-slate-200"};return e.jsx(M,{onClick:n,disabled:o,className:f(p,u[i],d?m:l),children:i.substring(0,1)})}const X="1.25em",re=s=>`calc(${X}*${s})`,Va=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:re(.85),height:re(.85),viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("circle",{cx:"12",cy:"12",r:"10"})}),Wa=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:X,height:X,viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"})}),Ua=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:X,height:X,viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41l-7.59-7.59a2.41 2.41 0 0 0-3.41 0Z"})}),Oa=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:re(.9),height:re(.9),viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"})});function Ha({i:s=0}){const t=[Va,Wa,Ua,Oa],a=t[Math.abs(s)%t.length];return e.jsx(a,{})}const _e=["text-red-500","text-orange-500","text-amber-500","text-yellow-500","text-lime-500","text-green-500","text-teal-500","text-cyan-500","text-sky-500","text-blue-500","text-indigo-500","text-violet-500","text-purple-500","text-fuchsia-500","text-pink-500","text-rose-500"];function Ge({player:s,className:t,empty:a="bye",noshape:n=!0,winner:o}){const d="text-slate-300",r=s==null?void 0:s.id,i=r?_e[r%_e.length]:d,l=(s==null?void 0:s.present)===!1;return e.jsxs("div",{className:f(t,"flex text-left gap-1 items-center",!n&&"w-48",o&&""),children:[e.jsx("span",{className:f("h-2 w-2 shrink-0 rounded-full",!s||l?"border border-slate-400":"bg-sky-400")}),e.jsx("span",{className:f("truncate",n?"w-40 sm:w-48":"w-36 sm:w-44",!(s!=null&&s.name||l||o===!1)&&"text-muted-foreground"),children:(s==null?void 0:s.name)||a}),n?void 0:e.jsx("span",{className:f("w-4 shrink-0",i,!s&&"invisible"),children:e.jsx(Ha,{i:r})})]})}function Ja({game:s,noshape:t}){const{findPlayer:a}=c.useContext(Q),n=a(s.p1id),o=a(s.p2id);return e.jsx(M,{className:"py-0 px-0 block w-fit h-fit",variant:"outline",children:[n,o].map((d,r)=>e.jsx("span",{children:e.jsx(Ge,{className:f("py-2 px-2",!r&&"border-b"),player:d,noshape:t})},d!==void 0?d.id:`bye-${r}`))},s.id)}function Ks({trigger:s,game:t,readonly:a,numRounds:n=4}){const{findPlayer:o}=c.useContext(Q),d=o(t.p1id),r=o(t.p2id),i=a||!d||!r,[l,m]=c.useState(t.p1points),[p,u]=c.useState(t.p2points),[h,v]=c.useState(t.p1twenties),[g,w]=c.useState(t.p2twenties);c.useEffect(()=>{m(t.p1points),u(t.p2points),v(t.p1twenties),w(t.p2twenties)},[t]),c.useEffect(()=>{a||(!d||!r)&&(t.gameRounds=new Array(n).fill({p1points:1,p2points:1}),N(t))},[d,r,a]);const C=()=>(t.gameRounds||[]).reduce(([j,R],S)=>[j+((S==null?void 0:S.p1points)||0),R+(S==null?void 0:S.p2points)],[0,0]),N=async x=>{[x.p1points,x.p2points]=C(),x.p1points==0&&x.p2points==0&&(x.p1points=x.p2points=void 0),x.id==null?await b.games.add(x):await b.games.update(x.id,x)},y=(x,j)=>{j=isNaN(j||NaN)?void 0:j,x==1?(m(j),t.p1points=j):(u(j),t.p2points=j),N(t)},$=(x,j)=>{j=isNaN(j||NaN)?void 0:j,x==1?(v(j),t.p1twenties=j):(w(j),t.p2twenties=j),N(t)},P=(x,j,R)=>{t.gameRounds||(t.gameRounds=Array(j)),t.gameRounds[j]||(t.gameRounds[j]={p1points:0,p2points:0});const S=[{p1points:0,p2points:0},{p1points:2,p2points:0},{p1points:0,p2points:2},{p1points:1,p2points:1}],T=t.gameRounds[j].p1points*10+t.gameRounds[j].p2points;let A=0;switch(`p${x}-${T}`){case"p1-0":A=1;break;case"p1-20":A=2;break;case"p1-2":A=3;break;case"p1-11":A=0;break;case"p2-0":A=2;break;case"p2-2":A=1;break;case"p2-20":A=3;break;case"p2-11":A=0;break}t.gameRounds[j]=S[A],t.gameRounds=t.gameRounds.slice(0,R),N(t)};s=s||e.jsx(Ja,{game:t});const k=[{player:d,points:l,twenties:h},{player:r,points:p,twenties:g}],G=Pa(t,n);return e.jsxs(Fa,{children:[e.jsx(Ba,{asChild:!0,children:s}),e.jsx(qs,{className:"w-60 sm:w-fit p-0 divide-y text-sm",children:k.map(({player:x,points:j,twenties:R},S)=>{const T=S+1,A=!x;return e.jsx("div",{className:"p-2 sm:px-3 sm:py-1",children:e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("div",{className:f("w-56 sm:w-40 font-bold truncate",A&&"text-muted-foreground"),children:(x==null?void 0:x.name)||"bye"}),e.jsxs("div",{className:f("flex gap-1 items-center",A&&"invisible"),children:[$e(n).map(D=>e.jsx("div",{className:"game",children:e.jsx(Je,{small:a,disabled:i,game:t,rn:D,pn:T,onClick:()=>P(T,D,n)})},D)),t.stage=="elim"?e.jsx("div",{className:f("game",!G&&"invisible"),children:e.jsx(Je,{small:a,disabled:i,game:t,rn:n,pn:T,onClick:()=>P(T,n,n+1)})}):void 0]}),e.jsxs("div",{className:f("flex gap-1 items-center",A&&"invisible"),children:[e.jsx(W,{readOnly:!0,disabled:i,id:"points",className:"w-10 pl-1 text-right",onChange:D=>y(T,parseInt(D.target.value)),value:isNaN(j||NaN)?"":j})," ",e.jsx("span",{className:"text-muted-foreground",children:"pts"}),e.jsx(W,{disabled:i,id:"twenties",className:"w-10 pl-1 text-right",onChange:D=>$(T,parseInt(D.target.value)),value:isNaN(R||NaN)?"":R})," ",e.jsx("span",{className:"text-muted-foreground",children:"20s"})]})]},S)},T)})})]})}const _a=({game:s,hasNextRound:t})=>{const{players:a}=ee(),n=s?a.find(h=>h.id==(s==null?void 0:s.p1id)):void 0,o=s?a.find(h=>h.id==(s==null?void 0:s.p2id)):void 0,d=J(s),r=Ma(s),i=K(s),l=h=>!i&&d!=null&&d==(h==null?void 0:h.id)||r,m=h=>!i&&d!=null&&d!=(h==null?void 0:h.id),p="bg-slate-300 bg-opacity-50",u="text-muted-foreground";return e.jsx(Ks,{readonly:t,game:s,trigger:e.jsx(M,{className:"py-0 px-0 block w-fit h-fit",variant:"outline",children:[n,o].map((h,v)=>e.jsx("span",{children:e.jsx(Ge,{className:f("py-2 px-2",!v&&"border-b",l(h)&&p,m(h)&&u),player:h})},h!==void 0?h.id:`bye-${v}`))},s.id)},s.id)};function qa({stage:s,round:t,nRounds:a}){const{games:n}=Ee(),{players:o}=ee(),[d,r]=c.useState(!1),{thisRound:i,hasNextRound:l}=c.useMemo(()=>{const g=n.filter(N=>N.stage==s&&N.round==t),w=s=="seed"&&t==a-1;let C;return w?C=!!n.find(N=>N.stage=="elim"&&N.round==0):C=!!n.find(N=>N.stage==s&&N.round==t+1),{thisRound:g,hasNextRound:C}},[n,a,t,s]),{canResetMatches:m,canAddMatches:p,canDeleteMatches:u}=c.useMemo(()=>{const g=i.find(k=>oe(k)?!1:Js(k)),w=!l&&!g,{unmatchedPlayers:C,gamesToDelete:N,byeGames:y}=se(o,i),$=s=="seed"&&!l&&C.length>1,P=s=="seed"&&!l&&N.length-y.length>0;return{canResetMatches:w,canAddMatches:$,canDeleteMatches:P}},[i,l,o,s]),h=()=>{m&&(r(!0),b.games.bulkDelete(i.map(g=>g.id)).finally(()=>{setTimeout(()=>r(!1),750)}))},v=()=>{if(!p&&!u)return;r(!0);const{gamesToDelete:g,gamesToAdd:w}=Le(t,o,n,a);b.games.bulkDelete(g).then(()=>b.games.bulkAdd(w)).finally(()=>{setTimeout(()=>r(!1),750)})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-2 w-full text-sm text-center text-muted-foreground",children:["Round ",t+1]}),e.jsx("div",{className:"p-1 flex flex-wrap gap-2 justify-center",children:i.map(g=>e.jsx(_a,{game:g,hasNextRound:l},g.id))}),p||u?e.jsx("div",{className:"p-1 flex justify-center",children:e.jsxs(Y,{className:"max-w-80 sm:max-w-md sm:w-md flex gap-2 items-center justify-between",children:[e.jsx("div",{children:e.jsx(_,{children:p?"There are unmatched players.":"Some matches have abset players."})}),e.jsxs(U,{variant:"secondary",working:d,onClick:v,children:[p?"Add":"Delete"," Matches"]})]})}):void 0,m?e.jsx("div",{className:"p-1 flex justify-center",children:e.jsxs(Y,{className:"max-w-80 sm:max-w-md sm:w-md flex gap-2 items-center justify-between",children:[e.jsx("div",{children:e.jsx(_,{children:"No games have been scored this round."})}),e.jsx(U,{variant:"secondary",working:d,onClick:h,children:"Reset Matches"})]})}):void 0]})}const Ka=(s,t,a,n=[],o=4,d=!1)=>{const r=[];if(s===0){const i=n.filter(p=>p.stage=="seed"),l=Math.pow(2,t-s);Ie(a,i);const m=a.slice(0,l);a=[];for(let p=0;p<m.length/2;p++){const u=m[p],h=m[l-1-p];a.push(u),a.push(h)}}else a=n.filter(m=>m.stage=="elim"&&m.round==s-1).reduce((m,p)=>{const u=J(p);return u!=null&&m.push(u),m},[]);a.length%2!=0&&a.push(void 0);for(let i=0;i<a.length;i+=2){let l=a[i],m=a[i+1];l==null&&([l,m]=[m,l]);const{p1points:p,p2points:u,p1twenties:h,p2twenties:v,gameRounds:g}=_s(l,m,o,d);r.push({stage:"elim",round:s,n:i/2,p1id:l,p2id:m,p1points:p,p2points:u,p1twenties:h,p2twenties:v,gameRounds:g})}return r},Ys=(s,t,a,n=[],o=4,d=!1)=>{const r=n.filter(u=>u.stage=="elim"&&u.round>=s),i=!1,{unmatchedPlayers:l,gamesToDelete:m}=se(a,r,i);return{gamesToAdd:Ka(s,t,l,n,o,d),gamesToDelete:m}},Ya=(s,t,a=4)=>{const n=[...t],o=[],{unmatchedPlayers:d}=se(s,[]),r=ue(d.length);for(let i=0;i<r;i++){const l=i<r-1,{gamesToAdd:m}=Ys(i,r,s,n,a,l);m.forEach(p=>{n.push(p),o.push(p)})}return{gamesToAdd:o,nRounds:r}},qe=({isStartElim:s})=>e.jsxs(Y,{className:"text-left max-w-80 sm:max-w-md sm:w-md mb-4",children:[e.jsx(De,{children:"Heads up!"}),e.jsxs(_,{children:["There are unscored games in the last ",s?"seed":void 0," round."]})]}),Xs=c.forwardRef(({className:s,...t},a)=>e.jsx(ks,{className:f("grid gap-2",s),...t,ref:a}));Xs.displayName=ks.displayName;const Zs=c.forwardRef(({className:s,...t},a)=>e.jsx(Rs,{ref:a,className:f("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Ht,{className:"flex items-center justify-center",children:e.jsx(Se,{className:"h-3.5 w-3.5 fill-primary"})})}));Zs.displayName=Rs.displayName;const Xa=({nPresent:s,value:t,onValueChange:a,className:n})=>{const o=ue(s),d=Math.floor(Math.log2(s));return e.jsx(Xs,{className:n,value:t.toString(),onValueChange:r=>a(parseInt(r)),children:$e(d).reverse().map(r=>{const i=r+1,l=Math.pow(2,i);return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Zs,{value:`${i}`,id:`r${i}`}),e.jsxs(H,{htmlFor:`r${i}`,children:["Top ",l," Players • ",i," Round",i>1?"s":void 0,o==i?e.jsx("span",{className:"text-muted-foreground italic",children:" Recommended"}):void 0]})]},i)})})},Za=({nPresent:s})=>{const t=me(s);return e.jsxs(Y,{className:"text-left max-w-80 sm:max-w-md sm:w-md mb-4",children:[e.jsx(De,{children:"Heads up!"}),e.jsxs(_,{children:["There are not enough seed rounds to rank ",s," players completely.",e.jsxs(_,{className:"mt-1",children:[t," seed rounds are recommended."]})]})]})};function Qa(){const[s,t]=c.useState(),[a,n]=c.useState(0),{games:o}=Ee(),{players:d,nPresent:r}=ee(),[i,l]=c.useState(!1),[m,p]=c.useState(0),[u,h]=c.useState("seed"),v=m==0;c.useEffect(()=>{s&&(n(s.selectedScrollSnap()),s.on("select",()=>n(s.selectedScrollSnap())))},[s]),c.useEffect(()=>{if(!v)return;const R=Math.max(ue(r),0);p(R)},[r,v]);const{nSeedRounds:g,nElimRounds:w,isLastSeedUnscored:C,isLastElimUnscored:N,atEnd:y}=c.useMemo(()=>{let R=0,S=0;o.forEach(E=>{E.stage=="seed"?R=Math.max(R,E.round+1):S=Math.max(S,E.round+1)});const T=!!o.find(E=>E.stage=="seed"&&E.round==R-1&&K(E)),A=!!o.find(E=>E.stage=="elim"&&E.round==S-1&&K(E)),D=o.filter(E=>E.stage=="elim"&&E.round==S-1).length==1;return{nSeedRounds:R,nElimRounds:S,isLastSeedUnscored:T,isLastElimUnscored:A,atEnd:D}},[o]),$=u=="seed"?g:w,P=u=="seed"?C:N,k=u=="seed"?w==0:!y,G=me(r),x=R=>{h(R);const S=R=="seed"?g-(C?1:0):w-(N?1:0);s==null||s.scrollTo(0,!0),setTimeout(()=>s==null?void 0:s.scrollTo(S),100)},j=R=>{if(l(!0),u=="seed"){const{gamesToAdd:T}=Le(R,d,o,4);b.games.bulkAdd(T).finally(()=>setTimeout(()=>l(!1),750))}else{const{gamesToAdd:T}=Ys(R,m,d,o,4);b.games.bulkAdd(T).finally(()=>setTimeout(()=>l(!1),750))}};return e.jsxs(Z,{children:[e.jsxs(de,{id:"matches-title",title:"Matches",children:[e.jsx("p",{children:"The first stage is made up of seed rounds where players are matched randomly in the first round, then against players they haven't yet been matched against, with similar scores if possible."}),e.jsx("p",{children:"The second stage is a set of elimination rounds where top players are matched based on their ranking from the seed rounds."})]}),e.jsx($a,{value:u,onValueChange:x,className:"w-full flex justify-center",children:e.jsxs(Os,{className:"grid w-80 grid-cols-2 mx-1",children:[e.jsx(ye,{value:"seed",children:"Seed"}),e.jsx(ye,{value:"elim",children:"Elimination"})]})}),e.jsx("div",{className:"flex  justify-center",children:e.jsxs(Vs,{className:"w-full",setApi:t,children:[$?e.jsxs(ve,{children:[$e($).map(R=>e.jsx(ae,{className:"min-h-80",children:e.jsx(qa,{stage:u,round:R,nRounds:$})},R)),k?e.jsx(ae,{className:"p-1 pt-4 flex flex-wrap gap-2 justify-center items-start sm:items-center min-h-80",children:e.jsxs("div",{className:"text-center",children:[P?e.jsx(qe,{}):void 0,r==1?e.jsx("p",{children:"There is only 1 player present."}):u=="seed"?e.jsxs("p",{children:["There are ",r," players present."]}):void 0,r<2?e.jsxs("p",{children:["Use the ",e.jsx(I,{className:"font-bold hover:underline",to:"/players",children:"Players"})," page to add players."]}):u=="seed"||!P?e.jsxs(U,{working:i,onClick:()=>j($),children:["Start ",u=="seed"?"Seed":"Elimination"," Round ",$+1]}):void 0]})}):void 0]}):e.jsx(ve,{children:e.jsx(ae,{className:"p-1 pt-4 flex flex-wrap gap-2 justify-center items-start sm:items-center min-h-80",children:e.jsxs("div",{className:"text-center",children:[u=="elim"&&w==0&&g<G?e.jsx(Za,{nPresent:r}):void 0,u=="elim"&&a==0&&C?e.jsx(qe,{isStartElim:!0}):void 0,r==0?e.jsx("p",{children:"There are no players present."}):void 0,r==1?e.jsx("p",{children:"There is only 1 player present."}):void 0,r<2?e.jsxs("p",{children:["Use the ",e.jsx(I,{className:"font-bold hover:underline",to:"/players",children:"Players"})," page to add players."]}):e.jsxs(e.Fragment,{children:[e.jsxs(U,{disabled:u=="elim"&&!m,working:i,onClick:()=>j(0),children:["Start ",u=="seed"?"Tournament":"Elimination"]}),u=="seed"&&r>1?e.jsx("div",{children:e.jsxs(H,{children:[r," players • ",Math.ceil(r/2)," match",r!=2?"es":void 0]})}):void 0,u=="elim"?e.jsx("div",{className:"max-w-80 m-auto",children:e.jsx(Xa,{className:"mt-4",nPresent:r,value:m,onValueChange:p})}):void 0]})]})})}),e.jsx(Ws,{className:"hidden md:inline-flex"}),e.jsx(Us,{className:"hidden md:inline-flex"})]})})]})}const Qs=c.forwardRef(({className:s,...t},a)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:a,className:f("w-full caption-bottom text-sm",s),...t})}));Qs.displayName="Table";const et=c.forwardRef(({className:s,...t},a)=>e.jsx("thead",{ref:a,className:f("[&_tr]:border-b",s),...t}));et.displayName="TableHeader";const st=c.forwardRef(({className:s,...t},a)=>e.jsx("tbody",{ref:a,className:f("[&_tr:last-child]:border-0",s),...t}));st.displayName="TableBody";const en=c.forwardRef(({className:s,...t},a)=>e.jsx("tfoot",{ref:a,className:f("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...t}));en.displayName="TableFooter";const Ne=c.forwardRef(({className:s,...t},a)=>e.jsx("tr",{ref:a,className:f("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...t}));Ne.displayName="TableRow";const z=c.forwardRef(({className:s,...t},a)=>e.jsx("th",{ref:a,className:f("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t}));z.displayName="TableHead";const F=c.forwardRef(({className:s,...t},a)=>e.jsx("td",{ref:a,className:f("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t}));F.displayName="TableCell";const sn=c.forwardRef(({className:s,...t},a)=>e.jsx("caption",{ref:a,className:f("mt-4 text-sm text-muted-foreground",s),...t}));sn.displayName="TableCaption";function tn(s,t,a){let n=0,o=0,d=0;return{wld:a.reduce((i,l)=>{if(l.stage!=t)return i;if(l.p1id==s.id){n+=l.p1points||0,o+=l.p1twenties||0;const m=oe(l),p=J(l);m?i.push({wld:"bye",game:l}):p==s.id?(i.push({wld:"win",game:l}),d+=1):p!=null?i.push({wld:"loss",game:l}):i.push({wld:"draw",game:l})}else if(l.p2id==s.id){n+=l.p2points||0,o+=l.p2twenties||0;const m=oe(l),p=J(l);m?i.push({wld:"bye",game:l}):p==s.id?(i.push({wld:"win",game:l}),d+=1):p!=null?i.push({wld:"loss",game:l}):i.push({wld:"draw",game:l})}return i},[]),points:n,twenties:o,wins:d}}function Ke({wld:s}){const t="w-6 h-5 px-0 justify-center uppercase text-white",a={win:"bg-emerald-700 hover:bg-emerald-600",loss:"bg-rose-800 hover:bg-rose-700",draw:"bg-slate-500 hover:bg-slate-400",bye:"bg-slate-400 hover:bg-slate-300"};return e.jsx("div",{className:"flex flex-wrap gap-1 -ml-1 sm:w-60",children:s.map((n,o)=>e.jsx(Ks,{readonly:!0,game:n.game,trigger:e.jsx(M,{className:f(t,a[n.wld]),children:n.wld.substring(0,1)},o)},o))})}function an(){const{players:s,games:t}=V(async()=>{const a=await b.players.filter(o=>!!o.present).toArray(),n=await b.games.where("stage").equals("seed").toArray();return Ie(a,n),{players:a,games:n}})||{players:[],games:[]};return e.jsx(Fs,{players:s,children:e.jsxs(Z,{children:[e.jsxs(de,{id:"rankings-page",title:"Rankings",children:[e.jsx("p",{children:"Players are ranked based on their win-loss-draw record. Players get 2 points for a win, 1 point for a draw, and no points for a loss."}),e.jsx("p",{children:"Ties are broken by the total number of twenties scored."})]}),e.jsxs(Pe,{children:[e.jsxs(Qs,{className:"w-full",children:[e.jsx(et,{children:e.jsxs(Ne,{className:"hidden sm:table-row",children:[e.jsx(z,{className:"text-right w-2",children:e.jsx("span",{className:"hidden sm:inline",children:"Rank"})}),e.jsx(z,{children:"Name"}),e.jsx(z,{className:"sm:w-3 hidden sm:table-cell",children:"Record"}),e.jsx(z,{className:"hidden sm:table-cell text-right",children:"Points"}),e.jsx(z,{className:"hidden sm:table-cell text-right",children:"20s"}),e.jsx(z,{className:"sm:hidden table-cell text-right"})]})}),e.jsx(st,{children:s.map((a,n)=>{const{wld:o,points:d,twenties:r}=tn(a,"seed",t);return e.jsxs(Ne,{children:[e.jsxs(F,{className:"text-right w-2",children:[n+1,"."]}),e.jsx(F,{className:"sm:max-w-none",children:e.jsxs("div",{className:"flex flex-wrap space-x-2 space-y-2",children:[e.jsx(Ge,{player:a}),e.jsx("div",{className:"sm:hidden",children:e.jsx(Ke,{wld:o})})]})}),e.jsx(F,{className:"hidden sm:table-cell",children:e.jsx("div",{className:"flex flex-wrap sm:w-fit flex-wrap sm:flex-nowrap gap-1",children:e.jsx(Ke,{wld:o})})}),e.jsx(F,{className:"hidden sm:table-cell text-right",children:d}),e.jsx(F,{className:"hidden sm:table-cell text-right",children:r}),e.jsx(F,{className:"sm:hidden table-cell text-right",children:e.jsxs("div",{className:"w-14",children:[d," ",e.jsx("span",{className:"text-muted-foreground font-semibold pr-1",children:"pts"}),e.jsx("br",{}),r," ",e.jsx("span",{className:"text-muted-foreground font-semibold",children:"20s"}),e.jsx("br",{})]})})]},a.id)})})]}),s.length==0?e.jsxs("div",{className:"w-full text-center mt-32",children:[e.jsx("p",{children:"There are no players present."}),e.jsxs("p",{children:["Use the ",e.jsx(I,{className:"font-bold hover:underline",to:"/players",children:"Players"})," page to add players."]})]}):void 0]})]})})}const tt=_t,nn=qt,on=Jt,at=c.forwardRef(({className:s,...t},a)=>e.jsx(Cs,{className:f("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:a}));at.displayName=Cs.displayName;const ze=c.forwardRef(({className:s,...t},a)=>e.jsxs(on,{children:[e.jsx(at,{}),e.jsx(Ss,{ref:a,className:f("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));ze.displayName=Ss.displayName;const nt=({className:s,...t})=>e.jsx("div",{className:f("flex flex-col space-y-2 text-center sm:text-left",s),...t});nt.displayName="AlertDialogHeader";const fe=({className:s,...t})=>e.jsx("div",{className:f("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});fe.displayName="AlertDialogFooter";const Fe=c.forwardRef(({className:s,...t},a)=>e.jsx($s,{ref:a,className:f("text-lg font-semibold",s),...t}));Fe.displayName=$s.displayName;const Be=c.forwardRef(({className:s,...t},a)=>e.jsx(Ts,{ref:a,className:f("text-sm text-muted-foreground",s),...t}));Be.displayName=Ts.displayName;const pe=c.forwardRef(({className:s,...t},a)=>e.jsx(As,{ref:a,className:f(Te(),s),...t}));pe.displayName=As.displayName;const Ve=c.forwardRef(({className:s,...t},a)=>e.jsx(Ms,{ref:a,className:f(Te({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));Ve.displayName=Ms.displayName;function rn({show:s,onHide:t,onConfirm:a}){return e.jsx(tt,{open:s,onOpenChange:t,children:e.jsxs(ze,{children:[e.jsx(Fe,{children:"Are you absolutely sure?"}),e.jsx(Be,{children:"Restoring a previously saved tournament will replace the current one. All current player names, games, scores, and rankings will be lost."}),e.jsxs(fe,{className:"gap-1 sm:gap-0",children:[e.jsx(pe,{className:"transition-colors bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:a,children:"Yes, Replace It"}),e.jsx(Ve,{onClick:t,children:"No, Keep It"})]})]})})}const ln=({show:s,onHide:t,details:a})=>e.jsx(Kt,{open:s,onOpenChange:t,children:e.jsxs(Yt,{children:[e.jsx(Xt,{children:"The chosen file could not be restored."}),a?e.jsxs(e.Fragment,{children:[e.jsx(Zt,{children:"See details below."}),e.jsx("pre",{className:"text-wrap",children:a})]}):void 0,e.jsx(fe,{children:e.jsx(pe,{onClick:t,children:"Ok, I'll try another file"})})]})}),dn={$id:"/Game",type:"object",anyOf:[{required:["id","stage","round","n","p1id"]},{required:["id","stage","round","n","p2id"]}],properties:{id:{type:"number"},stage:{type:"string",enum:["seed","elim"]},round:{type:"number"},n:{type:"number"},p1id:{type:"number"},p2id:{type:"number"},p1points:{type:"number"},p2points:{type:"number"},p1twenties:{type:"number"},p2twenties:{type:"number"},gameRounds:{type:"array",items:{type:"object",properties:{p1points:{type:"number"},p2points:{type:"number"}}}}}},cn={$id:"/Player",type:"object",required:["id","name"],properties:{id:{type:"number"},name:{type:"string"},present:{type:"boolean"}}},mn={type:"object",required:["players"],properties:{players:{type:"array",items:{$ref:"/Player"},minItems:1},games:{type:"array",items:{$ref:"/Game"}}}},he=new gt;he.addSchema(cn,"/Player");he.addSchema(dn,"/Game");const un=he.compile(mn),fn=s=>{const t=s;if(!un(t))throw new Error(he.errorsText());const{players:a,games:n}=t;if(!n)return;const o=new Set,d=l=>{if(o.has(l))return!0;const m=a==null?void 0:a.find(p=>p.id===l);return m&&o.add(m.id),!!m},r=[],i=new Set;if(n.forEach((l,m)=>{l.p1id&&!i.has(l.p1id)&&!d(l.p1id)&&(i.has(l.p1id)||r.push(`instance.games[${m}].p1id is not found in instance.players`),i.add(l.p1id)),l.p2id&&!i.has(l.p2id)&&!d(l.p2id)&&(i.has(l.p2id)||r.push(`instance.games[${m}].p2id is not found in instance.players`),i.add(l.p2id))}),i.size>0)throw new Error(r.map((l,m)=>`${m}: ${l}`).join(`
`))},pn=({anyData:s})=>{const[t,a]=c.useState(!1),[n,o]=c.useState("crokinole-tourney.json"),[d,r]=c.useState(!1),[i,l]=c.useState(),[m,p]=c.useState(!1),[u,h]=c.useState(),{nPlayers:v}=c.useContext(Q),g=async y=>{if(y.preventDefault(),!s)return;a(!0),setTimeout(()=>a(!1),1e3);const $=document.createElement("a"),P=await b.allData();$.href=window.URL.createObjectURL(new Blob([JSON.stringify(P,null,2)])),$.setAttribute("download",n),document.body.appendChild($),$.click()},w=()=>{if(!i)return;p(!1),r(!0),setTimeout(()=>r(!1),1e3);const y=new FileReader;y.onload=$=>{var P;try{const k=JSON.parse((P=$.target)==null?void 0:P.result);fn(k),b.replace(k)}catch(k){h(k==null?void 0:k.toString())}},y.readAsText(i)},C=async y=>{y.preventDefault(),i!=null&&(s?p(!0):w())},N=y=>{const $=y.target;$.files&&l($.files[0])};return e.jsxs(B,{children:[e.jsxs(ie,{children:[e.jsx(le,{children:"Save and Restore"}),e.jsx(O,{children:"All data is stored locally and is never uploaded to a server."})]}),e.jsxs("form",{onSubmit:g,children:[e.jsxs(L,{className:"d-flex flex-column flex-lg-row gap-3 flex-wrap justify-content-lg-stretch",children:[e.jsxs("div",{className:"grid w-full items-center gap-2 sm:flex sm:items-end",children:[e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx(H,{htmlFor:"save-as",children:"Save As"}),e.jsx(W,{id:"save-as",className:"sm:w-96",disabled:!v,value:n,onChange:y=>o(y.target.value)})]}),e.jsx(U,{variant:"secondary",disabled:!v,working:t,type:"submit",children:"Save"})]}),v?void 0:e.jsx(O,{className:"italic",children:"There is no tournament data to save."})]}),e.jsx(L,{className:"flex justify-end"})]}),e.jsx("form",{onSubmit:C,children:e.jsx(L,{className:"d-flex flex-column flex-lg-row gap-3 flex-wrap justify-content-lg-stretch",children:e.jsxs("div",{className:"grid w-full items-center gap-2 sm:flex sm:items-end",children:[e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx(H,{htmlFor:"restore-from",children:"Restore From"}),e.jsx(W,{id:"restore-from",className:"sm:w-96",type:"file",onChange:N})]}),e.jsx(U,{variant:"secondary",disabled:!i,working:d,type:"submit",children:"Restore"})]})})}),e.jsx(rn,{show:m,onHide:()=>p(!1),onConfirm:w}),e.jsx(ln,{show:!!u,onHide:()=>h(void 0),details:u})]})},ot=c.forwardRef(({className:s,...t},a)=>e.jsx(Ps,{ref:a,className:f("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...t,children:e.jsx(Qt,{className:f("flex items-center justify-center text-current"),children:e.jsx(Se,{className:"h-4 w-4"})})}));ot.displayName=Ps.displayName;const hn=({anyData:s})=>{const[t,a]=c.useState(!0),n=async()=>await b.reset(t==!0),o="transition-colors bg-destructive text-destructive-foreground hover:bg-destructive/90";return s=!0,e.jsxs(B,{className:"text-sm border-destructive/50 dark:border-destructive [&>svg]:text-destructive",children:[e.jsxs(ie,{children:[e.jsx(le,{children:"Danger Zone"}),e.jsxs(O,{children:[e.jsx("i",{children:"Warning!"})," Resetting the tournament will remove all player names, game match-ups, scores, and ranking."]})]}),e.jsx(L,{children:e.jsxs(tt,{children:[e.jsx(nn,{asChild:!0,children:e.jsx(M,{className:"text-nowrap",disabled:!s,variant:"destructive",children:s?"Reset Tournament":"No Tournament Data"})}),e.jsxs(ze,{children:[e.jsxs(nt,{children:[e.jsx(Fe,{children:"Are you absolutely sure?"}),e.jsxs(Be,{children:["Resetting the tournament will remove all ",t?"":"player names,"," games, scores, and rakings."]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ot,{id:"keep-players",checked:t,onCheckedChange:d=>a(d)}),e.jsx("label",{htmlFor:"keep-players",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Keep player names"})]}),e.jsxs(fe,{className:"gap-2 sm:gap-0",children:[e.jsx(pe,{className:o,onClick:n,children:"Yes, Reset It"}),e.jsx(Ve,{children:"No, Keep It"})]})]})]})})]})},xn=["Joey Tribbiani","Rachel Green","Monica Geller","Phoebe Buffay","Chandler Bing","Ross Geller","Fraiser Crane","Niles Crane","Daphne Moon","Roz Doyle","Martin Crane","Jerry Seinfeld","George Costanza","Elain Benes","Cosmo Kramer","Fran Fine","Max Sheffield","C.C. Babcock","Niles","Maggie Sheffield","Brighton Sheffield","Gracie Sheffield","Will Truman","Grace Adler","Karen Walker","Jack McFarland","Carrie Bradshaw","Charlotte York","Miranda Hobbes","Samantha Jones","Homer Simpson","Marge Simpson","Bart Simpson","Lisa Simpson","Maggie Simpson","Ned Flanders","Moe Szyslak","Seymour Skinner","Apu Nahasapeemapetilon","Barney Gumble","Clancy Wiggum","Kent Brockman","Jim Kirk","Spock","Montgomery Scott","Leonard McCoy","Nyota Uhura","Hikaru Sulu","Pavel Chekov","Janice Rand","Jean-Luc Picard","William Riker","Geordi La Forge","Tasha Yar","Worf","Beverly Crusher","Diana Troi","Data","Wesley Crusher","Christopher Pike","Christine Chapel","La'an Noonien-Singh","Erica Ortegas","Joseph M'Benga","Una Chin-Riley","Clark Kent","Louis Lane","Jimmy Olsen","Perry White","Lex Luthor","Lana Lang","Vicki Vale","Luke Charles","Heracles Panhellenios","Dane Whitman","Victor Shade","Clint Barton","Peter Parker","Bruce Banner","Steve Rogers","Pietro Maximoff","Thor Odinson","Janet Van Dyne","Hank Pym","Tony Stark","Wanda Maximoff","Carol Danvers","Bucky Barnes","Natasha Romanoff","Sam Wilson","Steven Strange","Jessica Jones","Trish Walker","Maria Hill","Ben Grimm","Matt Murdock","Susan Storm","Reed Richards","Amadeus Cho","Jimmy Howlett","Nick Fury","Phil Coulson","Hubert Wolfeschlegelsteinhausenbergerdorff"];function bn(s,t=0){const a=ne(xn).slice(0,s).map((n,o)=>({name:n,present:o>=t}));return ne(a)}const gn=(s,t,a,n)=>{n=Math.max(t-n,0);const o=Math.max(Math.max(s-a,n),0),d=Math.min(Math.max(o-n,0),o);return bn(o,d)};async function jn(){if(await b.games.count()>0)throw new Error("games already exist in the tournament");const s=await b.players.toArray(),t=s.filter(l=>l.present).length,a=gn(20,15,s.length,t);await b.players.bulkAdd(a);const n=await b.players.toArray(),{gamesToAdd:o,nRounds:d}=za(n);await b.games.bulkAdd(o);const{gamesToAdd:r,nRounds:i}=Ya(n,o);return await b.games.bulkAdd(r),{nSeedRounds:d,nElimRounds:i}}const wn=({anyGames:s})=>{const[t,a]=c.useState(!1),{nPresent:n}=ee(),{setNSeedRounds:o,setNElimRounds:d}=Ee(),r=async()=>{a(!0);const{nSeedRounds:i,nElimRounds:l}=await jn().finally(()=>setTimeout(()=>a(!1),750));o(i),d(l)};return e.jsxs(B,{children:[e.jsxs(ie,{children:[e.jsx(le,{children:"Demo Tournament"}),e.jsx(O,{children:"If you have no tournament data, you can generate a random tournament with scores for all the rounds except the final."})]}),e.jsxs(L,{children:[e.jsx(U,{variant:"secondary",working:t,onClick:r,className:"text-nowrap",disabled:s||n==1,children:"Create Demo Tournament"}),e.jsx(O,{children:s?e.jsx("span",{className:"text-md italic",children:"Reset the current tournament to create a demo tournament."}):n>1?e.jsxs("span",{className:"text-md italic",children:["Tournament will use ",n," present players."]}):n==1?e.jsxs("span",{className:"text-md italic",children:["There is only ",n," player present."]}):void 0})]})]})};function vn(){const s=V(async()=>await b.anyData()),t=V(async()=>await b.games.count()>0);return e.jsxs(Z,{children:[e.jsx(de,{id:"settings-page",title:"Settings",children:e.jsx("p",{children:"Your tournament data will only be stored on your local device. You can export and restore your tournament data to a json file."})}),e.jsxs(Pe,{className:"grid gap-2",children:[e.jsx(pn,{anyData:s}),e.jsx(wn,{anyGames:t}),e.jsx(hn,{anyData:s})]})]})}function yn(){const{pathname:s}=jt();return c.useEffect(()=>{window.scrollTo(0,0)},[s]),null}function Nn(){const s=[{label:"Players",path:"players",element:e.jsx(Sa,{}),icon:e.jsx(Re,{strokeWidth:1})},{label:"Matches",path:"matches",element:e.jsx(Qa,{}),icon:e.jsx(be,{strokeWidth:1,className:"rotate-90"})},{label:"Rankings",path:"rankings",element:e.jsx(an,{}),icon:e.jsx(Xe,{strokeWidth:1})},{label:"Settings",path:"settings",element:e.jsx(vn,{}),icon:e.jsx(yt,{strokeWidth:1})}];return e.jsx(pa,{defaultTheme:"light",children:e.jsx(Aa,{children:e.jsxs(wt,{basename:"/crokinole-tourney/",children:[e.jsx(yn,{}),e.jsx(ha,{pages:s}),e.jsxs(vt,{children:[s.map(t=>e.jsx(Ue,{path:t.path,element:t.element},t.label)),e.jsx(Ue,{path:"/",element:e.jsx(ba,{})})]})]})})})}Nt.createRoot(document.getElementById("root")).render(e.jsx(kt.StrictMode,{children:e.jsx(Nn,{})}));
