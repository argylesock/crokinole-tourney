var fa=Object.defineProperty;var pa=(e,t,a)=>t in e?fa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var fe=(e,t,a)=>(pa(e,typeof t!="symbol"?t+"":t,a),a);import{r as c,j as s,R as ae}from"./react-jP6qC_On.js";import{c as ha}from"./react-dom-w3P5gmpS.js";import{t as xa,g as ba,i as U,L as Ke,N as ks,C as Ye,j as Oe,k as Es,m as ga,X as va,F as Is,n as Xe,p as K,q as wa,r as ja,w as G,v as Na,A as ya,x as ka,y as Ca,z as Sa,B as Ra,D as $a,R as Ta,E as Cs,S as Aa}from"./vendor-3h8e1jPC.js";import{$ as Ls,a as zs,b as Gs,C as Fs,c as Vs,d as Bs,e as Os,f as Pa,g as Ma,h as Ws,i as Da,j as Us,k as Ea,l as _s,m as Hs,n as Js,o as qs,p as Ze,q as Ks,D as Ia,r as Ys,s as Xs,t as La,u as za,v as Zs,w as Qs,x as Ga,y as et,z as st,A as Fa,B as tt,E as Va,M as at,F as Qe,G as je,H as Ne,I as es,J as ye,K as ke,L as nt,N as Ba,O as ot,P as rt,Q as it,R as lt,S as dt,T as ct,U as Oa,V as Wa,W as Ua,X as _a,Y as Ha,Z as Ja,_ as mt,a0 as ut,a1 as ft,a2 as qa,a3 as Ka,a4 as Ya,a5 as pt,a6 as Xa,a7 as Za,a8 as ht,a9 as xt,aa as Qa,ab as en,ac as sn,ad as tn,ae as an,af as bt,ag as nn}from"./radix-ui-Xsv3IY3L.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function a(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=a(o);fetch(o.href,i)}})();function f(...e){return xa(ba(e))}const ss=e=>e>0?Array.from(Array(Math.floor(e)).keys()):[],be=e=>{let t=e.length;for(;t>0;){const a=Math.floor(Math.random()*t--);[e[t],e[a]]=[e[a],e[t]]}return e},We=c.forwardRef(({className:e,children:t,...a},n)=>s.jsxs(Ls,{ref:n,className:f("relative z-10 flex max-w-max flex-1 items-center justify-center",e),...a,children:[t,s.jsx(gt,{})]}));We.displayName=Ls.displayName;const Ue=c.forwardRef(({className:e,...t},a)=>s.jsx(zs,{ref:a,className:f("group flex flex-1 list-none items-center justify-center space-x-1",e),...t}));Ue.displayName=zs.displayName;const Ge=Pa,on=U("group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50"),rn=c.forwardRef(({className:e,children:t,...a},n)=>s.jsxs(Gs,{ref:n,className:f(on(),"group",e),...a,children:[t," ",s.jsx(Fs,{className:"relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180","aria-hidden":"true"})]}));rn.displayName=Gs.displayName;const ln=c.forwardRef(({className:e,...t},a)=>s.jsx(Vs,{ref:a,className:f("left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",e),...t}));ln.displayName=Vs.displayName;const gt=c.forwardRef(({className:e,...t},a)=>s.jsx("div",{className:f("absolute left-0 top-full flex justify-center"),children:s.jsx(Bs,{className:f("origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",e),ref:a,...t})}));gt.displayName=Bs.displayName;const dn=c.forwardRef(({className:e,...t},a)=>s.jsx(Os,{ref:a,className:f("top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",e),...t,children:s.jsx("div",{className:"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md"})}));dn.displayName=Os.displayName;const ts=U("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),E=c.forwardRef(({className:e,variant:t,size:a,asChild:n=!1,...o},i)=>{const l=n?Ma:"button";return s.jsx(l,{className:f(ts({variant:t,size:a,className:e})),ref:i,...o})});E.displayName="Button";const cn=c.forwardRef(({className:e,inset:t,children:a,...n},o)=>s.jsxs(Ws,{ref:o,className:f("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",e),...n,children:[a,s.jsx(Da,{className:"ml-auto h-4 w-4"})]}));cn.displayName=Ws.displayName;const mn=c.forwardRef(({className:e,...t},a)=>s.jsx(Us,{ref:a,className:f("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));mn.displayName=Us.displayName;const un=c.forwardRef(({className:e,sideOffset:t=4,...a},n)=>s.jsx(Ea,{children:s.jsx(_s,{ref:n,sideOffset:t,className:f("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a})}));un.displayName=_s.displayName;const fn=c.forwardRef(({className:e,inset:t,...a},n)=>s.jsx(Hs,{ref:n,className:f("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...a}));fn.displayName=Hs.displayName;const pn=c.forwardRef(({className:e,children:t,checked:a,...n},o)=>s.jsxs(Js,{ref:o,className:f("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:a,...n,children:[s.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:s.jsx(qs,{children:s.jsx(Ze,{className:"h-4 w-4"})})}),t]}));pn.displayName=Js.displayName;const hn=c.forwardRef(({className:e,children:t,...a},n)=>s.jsxs(Ks,{ref:n,className:f("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[s.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:s.jsx(qs,{children:s.jsx(Ia,{className:"h-4 w-4 fill-current"})})}),t]}));hn.displayName=Ks.displayName;const xn=c.forwardRef(({className:e,inset:t,...a},n)=>s.jsx(Ys,{ref:n,className:f("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...a}));xn.displayName=Ys.displayName;const bn=c.forwardRef(({className:e,...t},a)=>s.jsx(Xs,{ref:a,className:f("-mx-1 my-1 h-px bg-muted",e),...t}));bn.displayName=Xs.displayName;const gn={theme:"system",setTheme:()=>null},vn=c.createContext(gn);function wn({children:e,defaultTheme:t="system",storageKey:a="vite-ui-theme",...n}){const[o,i]=c.useState(()=>localStorage.getItem(a)||t);c.useEffect(()=>{const r=window.document.documentElement;if(r.classList.remove("light","dark"),o==="system"){const d=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";r.classList.add(d);return}r.classList.add(o)},[o]);const l={theme:o,setTheme:r=>{localStorage.setItem(a,r),i(r)}};return s.jsx(vn.Provider,{...n,value:l,children:e})}function jn({pages:e}){const t="sticky top-0 z-50 flex justify-center w-full shadow-sm backgrop-blur p-1 border-b border-border/40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/40",a="group inline-flex h-9 w-max items-center justify-center font-light rounded-md px-4 py-2 text-sm transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50",n=o=>{if(o.icon)return o.icon;if(o.label=="Players")return s.jsx(Ye,{strokeWidth:1})};return s.jsxs(s.Fragment,{children:[s.jsx("header",{className:t,children:s.jsxs(We,{className:"flex w-full justify-center sm:justify-between max-w-2xl",children:[s.jsx(Ke,{to:"/",children:s.jsxs(Ge,{className:f(a,"mx-1 px-1 pr-4 font-bold"),children:[s.jsx("img",{alt:"hand-flick-logo",className:"max-h-6 pr-2",src:"/crokinole-tourney//hand-flick-sticker.svg"}),s.jsx("span",{children:"Crokinole Tourney"})]})}),s.jsx(Ue,{className:"bg-none hidden sm:inline",children:e.map(o=>s.jsx(ks,{to:o.path,children:({isActive:i})=>s.jsx(Ge,{className:f(a,{"font-semibold":i}),children:o.label})},o.label))}),void 0]})}),s.jsx("footer",{className:"sm:hidden w-full z-50 flex justify-around text-white bg-sky-800 fixed bottom-0 p-1 font-light",children:s.jsx(We,{children:s.jsx(Ue,{className:"bg-none",children:e.map(o=>s.jsx(ks,{to:o.path,children:({isActive:i})=>s.jsx(Ge,{className:f(a,{"font-semibold":i}),children:n(o)})},o.label))})})})]})}const V=({className:e,...t})=>s.jsx(Ke,{className:f("font-bold rounded hover:underline cursor-pointer border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background",e),...t});function ie({children:e}){return s.jsx("div",{className:"flex w-full justify-center mb-20",children:s.jsx("div",{className:"w-full max-w-2xl",children:e})})}const q=c.forwardRef(({className:e,...t},a)=>s.jsx("div",{ref:a,className:f("rounded-xl border bg-card text-card-foreground shadow",e),...t}));q.displayName="Card";const Ce=c.forwardRef(({className:e,...t},a)=>s.jsx("div",{ref:a,className:f("flex flex-col space-y-1.5 p-6",e),...t}));Ce.displayName="CardHeader";const Se=c.forwardRef(({className:e,...t},a)=>s.jsx("h3",{ref:a,className:f("font-semibold leading-none tracking-tight",e),...t}));Se.displayName="CardTitle";const Z=c.forwardRef(({className:e,...t},a)=>s.jsx("p",{ref:a,className:f("text-sm text-muted-foreground",e),...t}));Z.displayName="CardDescription";const O=c.forwardRef(({className:e,...t},a)=>s.jsx("div",{ref:a,className:f("p-6 pt-0",e),...t}));O.displayName="CardContent";const Nn=c.forwardRef(({className:e,...t},a)=>s.jsx("div",{ref:a,className:f("flex items-center p-6 pt-0",e),...t}));Nn.displayName="CardFooter";const yn=()=>s.jsxs(ie,{children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("h1",{className:"text-xl font-extrabold my-5",children:"Welcome to Crokinole Tourney!"}),s.jsx("p",{children:"A super-simple way to score Crokinole tournaments."}),s.jsx("img",{className:"inline h-24 my-4",alt:"hand-flick-logo",src:"/crokinole-tourney//hand-flick-sticker.svg"}),s.jsx("p",{children:"Just 3 easy steps."})]}),s.jsxs("div",{className:"flex flex-wrap justify-center",children:[s.jsxs(q,{className:"my-6 w-60 mx-3",children:[s.jsx("div",{className:"relative -top-4 w-full",children:s.jsx("span",{className:"m-auto bg-sky-700 rounded-full text-center text-white font-black block pt-0.5 w-8 h-8 text-xl",children:"1"})}),s.jsxs(O,{className:"text-center text-xl",children:["Start by adding ",s.jsx(V,{to:"/players",children:"Players"})," to the tournament.",s.jsx("div",{className:"w-full flex justify-center mt-4",children:s.jsx(Ke,{to:"/players",children:s.jsx(E,{variant:"ghost",className:"p-0 w-16 h-16",children:s.jsx(Ye,{size:"3em"})})})})]})]}),s.jsxs(q,{className:"my-6 w-60 mx-3",children:[s.jsx("div",{className:"relative -top-4 w-full",children:s.jsx("span",{className:"m-auto bg-teal-700 rounded-full text-center text-white font-black block pt-0.5 w-8 h-8 text-xl",children:"2"})}),s.jsxs(O,{className:"text-center text-xl",children:["Score the Seed ",s.jsx(V,{to:"/players",children:"Matches"})," to ",s.jsx(V,{to:"/rankings",children:"Rank"})," players.",s.jsxs("div",{className:"w-full flex justify-center items-center mt-4",children:[s.jsx(V,{to:"/matches",children:s.jsx(E,{variant:"ghost",className:"p-0 w-16 h-16",children:s.jsx(Oe,{size:"3em",className:"rotate-90"})})}),s.jsx("span",{className:"-mx-2 z-10 text-black text-2xl",children:"+"}),s.jsx(V,{to:"/rankings",children:s.jsx(E,{variant:"ghost",className:"p-0 w-16 h-16",children:s.jsx(Es,{size:"3em"})})})]})]})]}),s.jsxs(q,{className:"my-6 w-60 mx-3",children:[s.jsx("div",{className:"relative -top-4 w-full",children:s.jsx("span",{className:"m-auto bg-green-700 rounded-full text-center text-white font-black block pt-0.5 w-8 h-8 text-xl",children:"3"})}),s.jsxs(O,{className:"text-center text-xl",children:["Score the Elimination ",s.jsx(V,{to:"/players",children:"Matches"})," to decide the champion!",s.jsx("div",{className:"w-full flex justify-center items-center mt-4",children:s.jsx(V,{to:"/matches",children:s.jsx(E,{variant:"ghost",className:"p-0 w-16 h-16",children:s.jsx(Oe,{size:"3em",className:"rotate-90"})})})})]})]})]})]}),kn=Ga,vt=c.forwardRef(({className:e,...t},a)=>s.jsx(La,{ref:a,className:f("border-b",e),...t}));vt.displayName="AccordionItem";const wt=c.forwardRef(({className:e,children:t,...a},n)=>s.jsx(za,{className:"flex",children:s.jsxs(Zs,{ref:n,className:f("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",e),...a,children:[t,s.jsx(Fs,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}));wt.displayName=Zs.displayName;const jt=c.forwardRef(({className:e,children:t,...a},n)=>s.jsx(Qs,{ref:n,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...a,children:s.jsx("div",{className:f("pb-4 pt-0",e),children:t})}));jt.displayName=Qs.displayName;function Re({id:e,title:t,children:a}){const[n,o]=ga(e,!1),i=()=>o(!n);return s.jsx(kn,{className:"pb-2 w-full",type:"single",defaultValue:n?void 0:"item-1",collapsible:!0,onValueChange:i,children:s.jsxs(vt,{value:"item-1",className:"px-2",children:[s.jsx(wt,{children:t}),s.jsx(jt,{className:"grid gap-2",children:a})]})})}const Cn=U("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),W=c.forwardRef(({className:e,...t},a)=>s.jsx(et,{ref:a,className:f(Cn(),e),...t}));W.displayName=et.displayName;const _e=c.forwardRef(({className:e,...t},a)=>s.jsx(st,{className:f("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...t,ref:a,children:s.jsx(Fa,{className:f("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));_e.displayName=st.displayName;function as(e){if(!e.children)return s.jsx(_e,{...e});const t=e.id||Math.random().toString(36).slice(2);return s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(_e,{...e,id:t}),s.jsx(W,{htmlFor:t,...e.labelProps,children:e.children})]})}const Sn=U("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-3",sm:"h-8 px-2",lg:"h-10 px-3"}},defaultVariants:{variant:"default",size:"default"}}),Nt=c.forwardRef(({className:e,variant:t,size:a,...n},o)=>s.jsx(tt,{ref:o,className:f(Sn({variant:t,size:a,className:e})),...n}));Nt.displayName=tt.displayName;class Rn extends va{constructor(){super("crokinole-tourney");fe(this,"tournament");fe(this,"players");fe(this,"games");this.version(1).stores({tournament:"++id, name",players:"++id, name",games:"++id, stage, p1id, p2id"})}async anyData(){return!!(await this.players.count()||await this.games.count())}async allData(){const a=await this.players.toArray(),n=await this.games.toArray();return{players:a,games:n}}async reset(a){a||await R.players.clear(),await R.games.clear()}async replace(a){const{players:n,games:o=[]}=a;await R.games.clear(),await R.players.bulkPut(n),await R.games.bulkPut(o)}}const R=new Rn,B=c.forwardRef(({className:e,type:t,danger:a,warning:n,...o},i)=>s.jsx("input",{type:t,className:f(a?"border-red-600 focus-visible:ring-red-600/75":n?"border-amber-600 focus-visible:ring-amber-600/75":"border-input focus-visible:ring-ring","flex h-9 w-full rounded-md border bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...o}));B.displayName="Input";const $n=U("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function yt({className:e,variant:t,...a}){return s.jsx("div",{className:f($n({variant:t}),e),...a})}const le=c.createContext({players:[],nPlayers:0,nPresent:0,findPlayer:()=>{},hasPresentUndo:!1,storePresentUndo:()=>{},retrievePresentUndo:()=>[],shownPlayerProfile:void 0,showPlayerProfile:()=>{},hidePlayerProfile:()=>{},isDuplicateName:()=>!1,isDuplicateAlias:()=>!1,allTags:[]}),kt=({players:e=[],children:t})=>{const a=e.length,n=e.filter(b=>b.present).length,o=b=>b?e==null?void 0:e.find(v=>v.id==b):void 0,i=c.useRef([]),[l,r]=c.useState(!1),[d,m]=c.useState(),p=b=>{const v=b===void 0?void 0:o(b);m(v)},u=()=>p(void 0),h=b=>{i.current=[...b.map(v=>({...v}))],r(!!b.length)},k=()=>{const b=i.current;return i.current=[],r(!1),b},x=c.useCallback((b,v,w)=>{const $=(new Is(e||[],{keys:[v],includeScore:!0}).search(b)||[]).filter(L=>L.item.id!=(w==null?void 0:w.id)),j=$.slice(0,1)[0],C=(j==null?void 0:j.score)||Number.MAX_SAFE_INTEGER,A=1e-10,P=.3,D=.35,M=$.length==1;if(C<A)return!0;if(b.trim().length<3)return!1;if(!(C<P)&&!(C<D&&M))return!1},[e]),g=(b,v)=>x(b,"name",v),N=(b,v)=>x(b,"alias",v),y=c.useMemo(()=>{const b=["Adult","Competitve","Junior","Rec"],v=new Set(b);return e&&e.forEach(w=>{w.tags&&w.tags.forEach($=>v.add($))}),[...v].sort()},[e]),S={players:e,nPlayers:a,nPresent:n,findPlayer:o,hasPresentUndo:l,storePresentUndo:h,retrievePresentUndo:k,shownPlayerProfile:d,showPlayerProfile:p,hidePlayerProfile:u,isDuplicateName:g,isDuplicateAlias:N,allTags:y};return s.jsx(le.Provider,{value:S,children:t})},_=()=>c.useContext(le),Q=e=>{const a=/^([^ ]*) "([^"]+)" (.*)$/.exec(e);let n,o;return a!=null?(n=`${a[1]} ${a[3]}`,o=a[2]):(n=e,o=void 0),{name:n,alias:o}},ns=(e,t)=>{if(!t)return e;const a=e.split(" "),n=a.slice(1).join(" ");return t?`${a[0]} "${t}" ${n}`:e},ge=({className:e,danger:t,warning:a,children:n,...o})=>{if(n)return s.jsx("p",{className:f(t?"text-red-600":a?"text-amber-600":"text-muted-foreground","mt-1 text-[0.8rem]",e),...o,children:n})},os="This matches another player's name",rs="This matches another player's alias",is="This closely matches another player's name",ls="This closely matches another player's alias";function Tn({player:e}){const{showPlayerProfile:t,isDuplicateName:a,isDuplicateAlias:n}=_(),[o,i]=c.useState(e.name||""),[l,r]=c.useState(e.alias||void 0),d=ns(o,l),[m,p]=Xe(d,250);c.useEffect(()=>{i(e.name),r(e.alias)},[e]);const u=T=>{const{name:F,alias:X}=Q(T);i(F),r(X),p(T),e&&R.players.update(e.id,{name:F,alias:X})},h=!!e.present,k=T=>{e&&R.players.update(e.id,{present:T})},x=()=>k(!h),{duplicateName:g,duplicateAlias:N}=c.useMemo(()=>{const{name:T,alias:F}=Q(m),X=a(T,e),ue=n(F||"",e);return{duplicateName:X,duplicateAlias:ue}},[a,n,m,e]),y=!o.trim(),b=(K(async()=>{const T=await R.games.where("p1id").equals((e==null?void 0:e.id)||-1).count(),F=await R.games.where("p2id").equals((e==null?void 0:e.id)||-1).count();return T+F},[e==null?void 0:e.id])||0)>0,[v,w]=c.useState(!1),$=async()=>{(e==null?void 0:e.id)!=null&&(v?await R.players.delete(e.id):w(!0))},j=c.useRef(null);wa(j,()=>w(!1));const C=v?"destructive":"ghost",A=v?"":"text-slate-500",P=v?s.jsx(s.Fragment,{children:"Remove Player"}):s.jsx(Va,{}),D=y||g||N,M=g===void 0||N===void 0,L=y?"Should not be empty":g?os:N?rs:g===void 0?is:N===void 0?ls:"";return s.jsxs("form",{onSubmit:T=>T.preventDefault(),children:[s.jsxs("div",{className:"w-full flex items-center space-x-2",children:[s.jsx(as,{checked:h,onCheckedChange:x}),s.jsxs("div",{className:"w-full max-w-sm relative",children:[s.jsx(B,{danger:D,warning:M,className:"pr-9",type:"text",placeholder:"Player name",value:d,onChange:T=>u(T.target.value)}),s.jsx(E,{variant:"ghost",size:"icon",className:"w-8 h-8 rounded-full absolute right-0.5 z-50 inset-y-0.5 text-slate-500 shrink-0 p-2",onClick:()=>t(e.id),children:s.jsx(ja,{strokeWidth:1})})]}),s.jsx("span",{className:"shrink-0",children:b?s.jsx(yt,{variant:"secondary",className:"text-slate-500 px-1",children:"locked"}):s.jsx(E,{ref:j,variant:C,size:v?void 0:"icon",className:f(A,"mr-[13px] sm:mr-0"),onClick:$,onBlur:()=>w(!1),children:P})})]}),s.jsx(ge,{className:"ml-11",danger:D,warning:M,children:L})]})}const An=()=>{const{isDuplicateName:e,isDuplicateAlias:t}=_(),[a,n]=c.useState(""),[o,i]=c.useState(void 0),[l,r]=Xe("",250),d=v=>{const{name:w,alias:$}=Q(v);n(w),i($),r(v)},m=ns(a,o),[p,u]=c.useState(!0),h=()=>u(!p),k=v=>{v.preventDefault(),a.trim()&&R.players.add({name:a.trim(),present:p}).then(()=>d(""))},{duplicateName:x,duplicateAlias:g}=c.useMemo(()=>{const{name:v,alias:w}=Q(l),$=e(v,void 0),j=t(w||"",void 0);return{duplicateName:$,duplicateAlias:j}},[e,t,l]),N=x===!0||g===!0,y=x||g,S=x===void 0||g===void 0,b=x?os:g?rs:x===void 0?is:g===void 0?ls:"";return s.jsxs("form",{onSubmit:k,children:[s.jsxs("div",{className:"w-full flex items-center space-x-2",children:[s.jsx(as,{checked:p,onCheckedChange:h}),s.jsx(B,{danger:y,warning:S,className:"max-w-sm",type:"text",placeholder:"Player name",value:m,onChange:v=>d(v.target.value)}),s.jsx(E,{type:"submit",disabled:N,children:"Add"})]}),s.jsx(ge,{className:"ml-11",danger:y,warning:S,children:b})]})};function Pn(e=250){const[t,a]=c.useState(""),[n,o]=Xe("",e),i=r=>{a(r),o(r)},l=c.useCallback((r,d,m)=>{var h;if(!n.trim())return[r,Number.MAX_SAFE_INTEGER];const p=new Is(r,{...d,includeScore:!0},m).search(n);let u=(h=p[0])==null?void 0:h.score;return u=u??Number.MAX_SAFE_INTEGER,[p.map(k=>k.item),u]},[n]);return[t,i,l]}var Ds;const Mn=(Ds=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value"))==null?void 0:Ds.set;function Ss(e){const t={...e};delete t.divClassName,delete t.onValueChange;const[a,n]=c.useState(""),o=e.value||"";c.useEffect(()=>n(o),[o]);const i=m=>{n(m),e.onValueChange&&e.onValueChange(m)};return s.jsxs("div",{className:f("relative text-sm",e.divClassName),children:[s.jsx("input",{placeholder:"Search...",type:"text",...t,className:f("flex h-7 w-full rounded-full bg-slate-200 hover:bg-slate-100 focus-visible:bg-slate-100 px-7 py-0 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e.className),value:a,onChange:m=>i(m.target.value)}),s.jsx(at,{className:"absolute text-muted-foreground left-[0.5rem] top-[0.5rem] pointer-events-none text-sm"}),a&&Mn?s.jsx(E,{onClick:()=>i(""),variant:"ghost",size:"icon",className:"absolute h-5 w-5 rounded-full absolute top-1 right-[0.25rem] text-muted-foreground mx-0 hover:bg-slate-300",children:s.jsx(Qe,{})}):void 0]})}function ds({children:e,className:t,...a}){return s.jsx("div",{className:f("w-full sm:x-xl2 grid gap-2 px-2",t),...a,children:e})}const Dn=Ba,En=es,In=nt,Ct=c.forwardRef(({className:e,...t},a)=>s.jsx(je,{className:f("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:a}));Ct.displayName=je.displayName;const Ln=U("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),St=c.forwardRef(({side:e="right",className:t,children:a,...n},o)=>s.jsxs(In,{children:[s.jsx(Ct,{}),s.jsxs(Ne,{ref:o,className:f(Ln({side:e}),t),...n,children:[a,s.jsxs(es,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[s.jsx(Qe,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));St.displayName=Ne.displayName;const Rt=({className:e,...t})=>s.jsx("div",{className:f("flex flex-col space-y-2 text-center sm:text-left",e),...t});Rt.displayName="SheetHeader";const $t=({className:e,...t})=>s.jsx("div",{className:f("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});$t.displayName="SheetFooter";const Tt=c.forwardRef(({className:e,...t},a)=>s.jsx(ye,{ref:a,className:f("text-lg font-semibold text-foreground",e),...t}));Tt.displayName=ye.displayName;const At=c.forwardRef(({className:e,...t},a)=>s.jsx(ke,{ref:a,className:f("text-sm text-muted-foreground",e),...t}));At.displayName=ke.displayName;const zn=nt,Pt=c.forwardRef(({className:e,...t},a)=>s.jsx(je,{ref:a,className:f("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));Pt.displayName=je.displayName;const Gn=c.forwardRef(({className:e,children:t,...a},n)=>s.jsxs(zn,{children:[s.jsx(Pt,{}),s.jsxs(Ne,{ref:n,className:f("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...a,children:[t,s.jsxs(es,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[s.jsx(Qe,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Gn.displayName=Ne.displayName;const Fn=c.forwardRef(({className:e,...t},a)=>s.jsx(ye,{ref:a,className:f("text-lg font-semibold leading-none tracking-tight",e),...t}));Fn.displayName=ye.displayName;const Vn=c.forwardRef(({className:e,...t},a)=>s.jsx(ke,{ref:a,className:f("text-sm text-muted-foreground",e),...t}));Vn.displayName=ke.displayName;const Mt=c.forwardRef(({className:e,...t},a)=>s.jsx(G,{ref:a,className:f("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...t}));Mt.displayName=G.displayName;const Dt=c.forwardRef(({className:e,...t},a)=>s.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[s.jsx(at,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),s.jsx(G.Input,{ref:a,className:f("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...t})]}));Dt.displayName=G.Input.displayName;const Et=c.forwardRef(({className:e,...t},a)=>s.jsx(G.List,{ref:a,className:f("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...t}));Et.displayName=G.List.displayName;const It=c.forwardRef((e,t)=>s.jsx(G.Empty,{ref:t,className:"py-6 text-center text-sm",...e}));It.displayName=G.Empty.displayName;const Lt=c.forwardRef(({className:e,...t},a)=>s.jsx(G.Group,{ref:a,className:f("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...t}));Lt.displayName=G.Group.displayName;const Bn=c.forwardRef(({className:e,...t},a)=>s.jsx(G.Separator,{ref:a,className:f("-mx-1 h-px bg-border",e),...t}));Bn.displayName=G.Separator.displayName;const zt=c.forwardRef(({className:e,...t},a)=>s.jsx(G.Item,{ref:a,className:f("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...t}));zt.displayName=G.Item.displayName;const On=1,Wn=1e6;let Fe=0;function Un(){return Fe=(Fe+1)%Number.MAX_SAFE_INTEGER,Fe.toString()}const Ve=new Map,Rs=e=>{if(Ve.has(e))return;const t=setTimeout(()=>{Ve.delete(e),he({type:"REMOVE_TOAST",toastId:e})},Wn);Ve.set(e,t)},_n=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,On)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(a=>a.id===t.toast.id?{...a,...t.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=t;return a?Rs(a):e.toasts.forEach(n=>{Rs(n.id)}),{...e,toasts:e.toasts.map(n=>n.id===a||a===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(a=>a.id!==t.toastId)}}},Hn=[];let Be={toasts:[]};function he(e){Be=_n(Be,e),Hn.forEach(t=>{t(Be)})}function pe({...e}){const t=Un(),a=o=>he({type:"UPDATE_TOAST",toast:{...o,id:t}}),n=()=>he({type:"DISMISS_TOAST",toastId:t});return he({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:o=>{o||n()}}}),{id:t,dismiss:n,update:a}}const Jn=U("transition-all border inline-flex items-center text-sm pl-2 rounded-md",{variants:{variant:{default:"bg-secondary text-secondary-foreground hover:bg-secondary/80",primary:"bg-primary border-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive border-destructive text-destructive-foreground hover:bg-destructive/90"},size:{sm:"text-xs h-7",md:"text-sm h-8",lg:"text-base h-9",xl:"text-lg h-10"},shape:{default:"rounded-sm",rounded:"rounded-lg",square:"rounded-none",pill:"rounded-full"},borderStyle:{default:"border-solid",none:"border-none"},textCase:{uppercase:"uppercase",lowercase:"lowercase",capitalize:"capitalize"},interaction:{clickable:"cursor-pointer hover:shadow-md",nonClickable:"cursor-default"},animation:{none:"",fadeIn:"animate-fadeIn",slideIn:"animate-slideIn",bounce:"animate-bounce"},textStyle:{normal:"font-normal",bold:"font-bold",italic:"italic",underline:"underline",lineThrough:"line-through"}},defaultVariants:{variant:"default",size:"md",shape:"default",borderStyle:"default",textCase:"capitalize",interaction:"nonClickable",animation:"fadeIn",textStyle:"normal"}}),qn=({tagObj:e,direction:t,onTagClick:a,onRemoveTag:n,variant:o,size:i,shape:l,borderStyle:r,textCase:d,interaction:m,animation:p,textStyle:u})=>s.jsxs("span",{className:f(Jn({variant:o,size:i,shape:l,borderStyle:r,textCase:d,interaction:m,animation:p,textStyle:u}),{"justify-between":t==="column"}),onClick:()=>a==null?void 0:a(e),children:[e,s.jsx(E,{type:"button",variant:"ghost",onClick:h=>{h.stopPropagation(),n(e)},className:f("py-1 px-3 h-full hover:bg-transparent"),children:s.jsx(Na,{size:14})})]},e),Kn=({tags:e,customTagRenderer:t,direction:a,...n})=>s.jsx("div",{className:f("rounded-md max-w-[450px]",{"flex flex-wrap gap-2":a==="row","flex flex-col gap-2":a==="column"}),children:e.map(o=>t?t(o):s.jsx(qn,{tagObj:o,...n},o))}),Yn=({tags:e,setTags:t,autocompleteOptions:a,maxTags:n,onTagAdd:o,allowDuplicates:i,children:l})=>s.jsxs(Mt,{className:"border",children:[l,s.jsxs(Et,{children:[s.jsx(It,{children:"No results found."}),s.jsx(Lt,{heading:"Suggestions",children:a.map(r=>s.jsx(zt,{children:s.jsx("div",{className:"w-full",onClick:()=>{n&&e.length>=n||!i&&e.some(d=>d.toLowerCase()===r.toLowerCase())||(t([...e,r]),o==null||o(r))},children:r})},r))})]})]}),Gt=ae.forwardRef(e=>{const{id:t,placeholder:a,tags:n,setTags:o,variant:i,size:l,shape:r,className:d,enableAutocomplete:m,autocompleteOptions:p,maxTags:u,delimiter:h=",",onTagAdd:k,onTagRemove:x,allowDuplicates:g,showCount:N,validateTag:y,placeholderWhenFull:S="Max tags reached",sortTags:b,delimiterList:v,truncate:w,autocompleteFilter:$,borderStyle:j,textCase:C,interaction:A,animation:P,textStyle:D,minLength:M,maxLength:L,direction:T="row",onInputChange:F,customTagRenderer:X,onFocus:ue,onBlur:bs,onTagClick:aa,inputFieldPostion:gs="bottom",clearAll:na=!1,onClearAll:Le,inputProps:oa={},restrictTagsToAutocompleteOptions:ra}=e,[ze,vs]=ae.useState(""),[ia,ws]=ae.useState(Math.max(0,n.length)),js=ae.useRef(null);if(u!==void 0&&u<0||e.minTags!==void 0&&e.minTags<0)return console.warn("maxTags and minTags cannot be less than 0"),pe({title:"maxTags and minTags cannot be less than 0",description:"Please set maxTags and minTags to a value greater than or equal to 0",variant:"destructive"}),null;const Ns=z=>{const I=z.target.value;vs(I),F==null||F(I)},ys=z=>{if(v?v.includes(z.key):z.key===h||z.key==="Enter"){z.preventDefault();const I=ze.trim();if(ra&&!(p!=null&&p.some(te=>te===I))){pe({title:"Invalid Tag",description:"Please select a tag from the autocomplete options.",variant:"destructive"});return}if(y&&!y(I))return;if(M&&I.length<M){console.warn("Tag is too short"),pe({title:"Tag is too short",description:"Please enter a tag with more characters",variant:"destructive"});return}if(L&&I.length>L){pe({title:"Tag is too long",description:"Please enter a tag with less characters",variant:"destructive"}),console.warn("Tag is too long");return}I&&(g||!n.some(te=>te===I))&&(u===void 0||n.length<u)&&(o([...n,I]),k==null||k(I),ws(te=>te+1)),vs("")}},la=z=>{o(n.filter(I=>I!==z)),x==null||x(n.find(I=>I===z)||""),ws(I=>I-1)},da=()=>{Le==null||Le()},ca=$?p==null?void 0:p.filter(z=>$(z)):p,ma=b?[...n].sort():n,ua=w?n.map(z=>z.length>w?`${z.substring(0,w)}...`:z):ma;return s.jsxs("div",{className:`w-full flex gap-3 ${gs==="bottom"?"flex-col":gs==="top"?"flex-col-reverse":"flex-row"}`,children:[s.jsx(Kn,{tags:ua,customTagRenderer:X,variant:i,size:l,shape:r,borderStyle:j,textCase:C,interaction:A,animation:P,textStyle:D,onTagClick:aa,onRemoveTag:la,direction:T}),m?s.jsx("div",{className:"w-full max-w-[450px]",children:s.jsx(Yn,{tags:n,setTags:o,autocompleteOptions:ca,maxTags:u,onTagAdd:k,allowDuplicates:g??!1,children:s.jsx(Dt,{placeholder:u!==void 0&&n.length>=u?S:a,ref:js,value:ze,disabled:u!==void 0&&n.length>=u,onChangeCapture:Ns,onKeyDown:ys,onFocus:ue,onBlur:bs,className:"w-full"})})}):s.jsx("div",{className:"w-full",children:s.jsx(B,{ref:js,id:t,type:"text",placeholder:u!==void 0&&n.length>=u?S:a,value:ze,onChange:Ns,onKeyDown:ys,onFocus:ue,onBlur:bs,...oa,className:d,autoComplete:m?"on":"off",list:m?"autocomplete-options":void 0,disabled:u!==void 0&&n.length>=u})}),N&&u&&s.jsx("div",{className:"flex",children:s.jsxs("span",{className:"text-muted-foreground text-sm mt-1 ml-auto",children:[`${ia}`,"/",`${u}`]})}),na&&s.jsx(E,{type:"button",onClick:da,className:"mt-2",children:"Clear All"})]})});Gt.displayName="TagInput";const cs=Wa,Xn=Ua,Zn=Oa,Ft=c.forwardRef(({className:e,...t},a)=>s.jsx(ot,{className:f("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:a}));Ft.displayName=ot.displayName;const $e=c.forwardRef(({className:e,...t},a)=>s.jsxs(Zn,{children:[s.jsx(Ft,{}),s.jsx(rt,{ref:a,className:f("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));$e.displayName=rt.displayName;const ms=({className:e,...t})=>s.jsx("div",{className:f("flex flex-col space-y-2 text-center sm:text-left",e),...t});ms.displayName="AlertDialogHeader";const de=({className:e,...t})=>s.jsx("div",{className:f("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});de.displayName="AlertDialogFooter";const Te=c.forwardRef(({className:e,...t},a)=>s.jsx(it,{ref:a,className:f("text-lg font-semibold",e),...t}));Te.displayName=it.displayName;const Ae=c.forwardRef(({className:e,...t},a)=>s.jsx(lt,{ref:a,className:f("text-sm text-muted-foreground",e),...t}));Ae.displayName=lt.displayName;const ce=c.forwardRef(({className:e,...t},a)=>s.jsx(dt,{ref:a,className:f(ts(),e),...t}));ce.displayName=dt.displayName;const Pe=c.forwardRef(({className:e,...t},a)=>s.jsx(ct,{ref:a,className:f(ts({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));Pe.displayName=ct.displayName;function Qn(){const{shownPlayerProfile:e,hidePlayerProfile:t,isDuplicateName:a,isDuplicateAlias:n,allTags:o}=_(),[i,l]=c.useState((e==null?void 0:e.name)||""),[r,d]=c.useState((e==null?void 0:e.name)||""),[m,p]=c.useState((e==null?void 0:e.tags)||[]),[u,h]=c.useState(!1);c.useEffect(()=>{l((e==null?void 0:e.name)||""),d((e==null?void 0:e.alias)||""),p((e==null?void 0:e.tags)||[])},[e]);const k=()=>{e&&R.players.update(e,{name:i,alias:r,tags:m})},x=c.useMemo(()=>a(i||"",e),[i,e,a]),g=c.useMemo(()=>{const{alias:w}=Q(i);return!!w},[i]),N=c.useMemo(()=>n(r||"",e),[r,e,n]),y=c.useMemo(()=>{const{alias:w}=Q(ns(i,r));return!!w&&w!=r},[i,r]),S=x||N||g||y,b=()=>{if(e!=null&&e.name&&(e==null?void 0:e.name)!=i||e!=null&&e.alias&&(e==null?void 0:e.alias)!=r)return!0;const w=(e==null?void 0:e.tags)||[],$=m;return!!(w.length!==$.length||w.find((j,C)=>j!==$[C]))},v=()=>{b()?h(!0):t()};return s.jsxs(Dn,{open:e!==void 0,onOpenChange:v,children:[s.jsxs(St,{className:"overflow-y-auto",children:[s.jsxs(Rt,{className:"text-left",children:[s.jsx(Tt,{children:"Edit Player Details"}),s.jsx(At,{children:"Make changes to player details here. Click save when you're done."})]}),s.jsxs("div",{className:"flex flex-col space-y-2 mt-4",children:[s.jsx(W,{htmlFor:"player-name",children:"Player Name"}),s.jsx(B,{id:"player-name",danger:g||x,warning:x===void 0,value:i,onChange:w=>l(w.target.value)}),s.jsx(ge,{danger:g||x,warning:x===void 0,children:g?"Cannot contain an alias":x===!0?os:x===void 0?is:void 0})]}),s.jsxs("div",{className:"flex flex-col space-y-2 mt-4",children:[s.jsx(W,{htmlFor:"alias",children:"Alias"}),s.jsx(B,{id:"alias",danger:y||N,warning:N===void 0,value:r,onChange:w=>d(w.target.value)}),s.jsx(ge,{danger:y||N,warning:N===void 0,children:y?"Cannot contain quotes":N===!0?rs:N===void 0?ls:"The alias is shown instead of the player name"})]}),s.jsxs("div",{className:"flex flex-col space-y-2 mt-4",children:[s.jsx(W,{htmlFor:"tags",children:"Tags"}),s.jsx(Gt,{id:"tags",placeholder:"Enter a tag name",enableAutocomplete:!0,autocompleteOptions:o,tags:m,setTags:w=>p(w)})]}),s.jsx($t,{className:"mt-4",children:s.jsx(En,{asChild:!0,children:s.jsx(E,{disabled:S,onClick:k,children:"Save Changes"})})})]}),s.jsx(cs,{open:u,onOpenChange:()=>h(!1),children:s.jsxs($e,{children:[s.jsxs(ms,{children:[s.jsx(Te,{children:"Are you sure?"}),s.jsx(Ae,{children:"You have unsaved changes. If you leave this panel your changes will be lost."})]}),s.jsxs(de,{children:[s.jsx(Pe,{children:"No, Leave it open"}),s.jsx(ce,{onClick:t,children:"Yes, Close it"})]})]})})]})}function eo(){const[e,t]=c.useState(0),a=e!=0,n=()=>t((e+2)%3-1),[o,i,l]=Pn(250),r=!!o.trim(),{hasPresentUndo:d,storePresentUndo:m,retrievePresentUndo:p}=_(),u=K(async()=>{let $;return e&&!r?($=await R.players.orderBy("name").toArray(),e==-1&&$.reverse()):$=await R.players.toArray(),$},[e]),[h,k]=c.useMemo(()=>l(u||[],{keys:["name","alias"]}),[u,l]),x=.3,g=u!=null&&u.length?u.reduce(($,j)=>(j.present&&$++,$),0):0,N=u!=null&&u.length?g==u.length:!1,y=g==0,S=h.length==(u==null?void 0:u.length),b=async()=>{!N&&!y&&m(h),h.forEach($=>R.players.update($.id,{present:!N}))},v=async()=>{p().forEach($=>R.players.update($.id,{present:$.present}))},w=(N||y)&&d;return s.jsxs(ie,{children:[s.jsxs(Re,{id:"players-title",title:"Players",children:[s.jsx("p",{children:"Add player names to the tournament roster. They can be marked absent between seed or elimination matches."}),s.jsx("p",{children:"Players will be locked and cannot be removed if they've been matched in a game. Locked players can be marked absent for future rounds."})]}),s.jsxs(ds,{children:[s.jsx("div",{className:"flex justify-center mb-1",children:s.jsx(Ss,{divClassName:"sm:hidden",value:o,onValueChange:i})}),s.jsxs("div",{className:"w-full flex justify-between mb-2 space-x-2 items-center",children:[s.jsxs("div",{className:"flex space-x-2 items-center",children:[s.jsxs(as,{disabled:!S,checked:N,onCheckedChange:b,children:[s.jsx("span",{className:"hidden sm:inline",children:"All Players Present"}),s.jsx("span",{className:"sm:hidden",children:"AllÂ Present"})]}),u!=null&&u.length?s.jsxs(yt,{className:"ml-1 text-muted-foreground",variant:"outline",children:[g!=(u==null?void 0:u.length)?`${g} of`:void 0," ",u==null?void 0:u.length]}):void 0,w?s.jsx(E,{size:"icon",variant:"ghost",onClick:v,children:s.jsx(_a,{})}):void 0]}),s.jsxs("div",{className:"flex align-end items-center space-x-2",children:[s.jsx(Ss,{divClassName:"hidden sm:block",value:o,onValueChange:i}),s.jsx(Nt,{className:f("px-2 py-2 h-9 w-9",{"text-slate-500":!a}),pressed:a&&!r,onClick:n,disabled:r,children:e!=-1?s.jsx(ya,{strokeWidth:1}):s.jsx(ka,{strokeWidth:1})})]})]}),r?s.jsxs("div",{className:"text-xs my-2 text-muted-foreground w-full text-center",children:[h.length==0?s.jsx(s.Fragment,{children:"No matches found."}):void 0,k>x?s.jsx(s.Fragment,{children:"No close matches found."}):s.jsxs(s.Fragment,{children:["Showing top ",h.length," matches."]})]}):void 0,h.map($=>s.jsx(Tn,{player:$},$.id)),s.jsx(An,{})]}),s.jsx(Qn,{})]})}const Vt=c.createContext(null);function Me(){const e=c.useContext(Vt);if(!e)throw new Error("useCarousel must be used within a <Carousel />");return e}const Bt=c.forwardRef(({orientation:e="horizontal",opts:t,setApi:a,plugins:n,className:o,children:i,...l},r)=>{const[d,m]=Ca({...t,axis:e==="horizontal"?"x":"y"},n),[p,u]=c.useState(!1),[h,k]=c.useState(!1),x=c.useCallback(S=>{S&&(u(S.canScrollPrev()),k(S.canScrollNext()))},[]),g=c.useCallback(()=>{m==null||m.scrollPrev()},[m]),N=c.useCallback(()=>{m==null||m.scrollNext()},[m]),y=c.useCallback(S=>{S.key==="ArrowLeft"?(S.preventDefault(),g()):S.key==="ArrowRight"&&(S.preventDefault(),N())},[g,N]);return c.useEffect(()=>{!m||!a||a(m)},[m,a]),c.useEffect(()=>{if(m)return x(m),m.on("reInit",x),m.on("select",x),()=>{m==null||m.off("select",x)}},[m,x]),s.jsx(Vt.Provider,{value:{carouselRef:d,api:m,opts:t,orientation:e||((t==null?void 0:t.axis)==="y"?"vertical":"horizontal"),scrollPrev:g,scrollNext:N,canScrollPrev:p,canScrollNext:h},children:s.jsx("div",{ref:r,onKeyDownCapture:y,className:f("relative",o),role:"region","aria-roledescription":"carousel",...l,children:i})})});Bt.displayName="Carousel";const He=c.forwardRef(({className:e,...t},a)=>{const{carouselRef:n,orientation:o}=Me();return s.jsx("div",{ref:n,className:"overflow-hidden",children:s.jsx("div",{ref:a,className:f("flex",o==="horizontal"?"-ml-4":"-mt-4 flex-col",e),...t})})});He.displayName="CarouselContent";const xe=c.forwardRef(({className:e,...t},a)=>{const{orientation:n}=Me();return s.jsx("div",{ref:a,role:"group","aria-roledescription":"slide",className:f("min-w-0 shrink-0 grow-0 basis-full",n==="horizontal"?"pl-4":"pt-4",e),...t})});xe.displayName="CarouselItem";const Ot=c.forwardRef(({className:e,variant:t="outline",size:a="icon",...n},o)=>{const{orientation:i,scrollPrev:l,canScrollPrev:r}=Me();return s.jsxs(E,{ref:o,variant:t,size:a,className:f("absolute  h-8 w-8 rounded-full",i==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",e),disabled:!r,onClick:l,...n,children:[s.jsx(Ha,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Previous slide"})]})});Ot.displayName="CarouselPrevious";const Wt=c.forwardRef(({className:e,variant:t="outline",size:a="icon",...n},o)=>{const{orientation:i,scrollNext:l,canScrollNext:r}=Me();return s.jsxs(E,{ref:o,variant:t,size:a,className:f("absolute h-8 w-8 rounded-full",i==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",e),disabled:!r,onClick:l,...n,children:[s.jsx(Ja,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Next slide"})]})});Wt.displayName="CarouselNext";const so=qa,Ut=c.forwardRef(({className:e,...t},a)=>s.jsx(mt,{ref:a,className:f("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",e),...t}));Ut.displayName=mt.displayName;const Je=c.forwardRef(({className:e,...t},a)=>s.jsx(ut,{ref:a,className:f("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",e),...t}));Je.displayName=ut.displayName;const to=c.forwardRef(({className:e,...t},a)=>s.jsx(ft,{ref:a,className:f("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));to.displayName=ft.displayName;const De=e=>Math.ceil(Math.log2(e)),Ee=e=>Math.round(-.25+Math.log2(e/2)),_t=c.createContext({nGameRounds:4,setNGameRounds:()=>{},defaultNGameRounds:4,nSeedRounds:4,setNSeedRounds:()=>{},defaultNSeedRounds:4,nElimRounds:4,setNElimRounds:()=>{},defaultNElimRounds:4,players:[],games:[]}),ao=({children:e})=>{const t=K(()=>R.players.toArray())||[],a=K(()=>R.games.toArray())||[],n=t.reduce((x,g)=>x+(g!=null&&g.present?1:0),0),o=De(n),i=Ee(n),l=4,[r,d]=c.useState(l),[m,p]=c.useState(o),[u,h]=c.useState(i),k={nGameRounds:r,setNGameRounds:d,defaultNGameRounds:l,nSeedRounds:m,setNSeedRounds:p,defaultNSeedRounds:o,nElimRounds:u,setNElimRounds:h,defaultNElimRounds:i,players:t,games:a};return s.jsx(_t.Provider,{value:k,children:s.jsx(kt,{players:t,children:e})})},us=()=>c.useContext(_t),ee=e=>{if(e.p1id==null)return e.p2id;if(e.p2id==null||(e.p1points||0)>(e.p2points||0))return e.p1id;if((e.p1points||0)<(e.p2points||0))return e.p2id;if((e.p1twenties||0)>(e.p2twenties||0))return e.p1id;if((e.p1twenties||0)<(e.p2twenties||0))return e.p2id},no=(e,t=4)=>{if(e.p1twenties!=e.p2twenties||ne(e,t))return!1;const a=e.gameRounds||[],[n,o]=a.reduce(([i,l],r)=>[i+((r==null?void 0:r.p1points)||0),l+(r==null?void 0:r.p2points)],[0,0]);return n==o},oo=(e,t=4)=>{if(e.stage!="elim")return!1;let a=e.gameRounds||[];if(a.length<t||ne(e,t,t))return!1;a=a.slice(0,t);const[n,o]=a.reduce(([i,l],r)=>[i+((r==null?void 0:r.p1points)||0),l+(r==null?void 0:r.p2points)],[0,0]);return n==o},ne=(e,t=4,a=0)=>{if((e.p1twenties||0)>0||(e.p2twenties||0)>0||(e.p1points||0)>0||(e.p2points||0)>0)return!1;let n=e.gameRounds||[];if(n.length<t)return!0;a>0&&(n=n.slice(0,a));const o=n.findIndex(l=>l==null)>=0,i=n.find(l=>l==null?!0:l.p1points==0&&l.p2points==0);return o||!!i},Ht=e=>(e.p1twenties||0)>0||(e.p2twenties||0)>0||(e.p1points||0)>0||(e.p2points||0)>0?!0:!!(e.gameRounds||[]).find(n=>n==null?!1:n.p1points>0||n.p2points>0),ve=e=>e.p1id==null||e.p2id==null,ro=U("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),oe=c.forwardRef(({className:e,variant:t,...a},n)=>s.jsx("div",{ref:n,role:"alert",className:f(ro({variant:t}),e),...a}));oe.displayName="Alert";const fs=c.forwardRef(({className:e,...t},a)=>s.jsx("h5",{ref:a,className:f("mb-1 font-medium leading-none tracking-tight",e),...t}));fs.displayName="AlertTitle";const se=c.forwardRef(({className:e,...t},a)=>s.jsx("div",{ref:a,className:f("text-sm [&_p]:leading-relaxed",e),...t}));se.displayName="AlertDescription";const Y=e=>{const{working:t,children:a}=e,n=e.disabled||t,o={...e,disabled:n};return delete o.children,delete o.working,s.jsxs(E,{...o,children:[t?s.jsx(Ka,{className:"mr-2 h-4 w-4 animate-spin"}):void 0,a]})},io=e=>{const t=[],a=[];return e.forEach(n=>{n.id!=null&&(n.present?t.push(n.id):a.push(n.id))}),{presentPlayers:t,absentPlayers:a}},lo=(e,t,a,n)=>{const o=[],i=[],l=[],r=[];return e.forEach(d=>{const m=d.p1id==null||a.indexOf(d.p1id)>=0,p=d.p2id==null||a.indexOf(d.p2id)>=0,u=m&&p;!ve(d)&&Ht(d)?(d.p1id&&i.push(d.p1id),d.p2id&&i.push(d.p2id)):u?d.id!==void 0&&l.push(d.id):m?(o.push(d.p2id),d.id!==void 0&&(l.push(d.id),r.push(d.id))):p?(o.push(d.p1id),d.id!==void 0&&(l.push(d.id),r.push(d.id))):n?(o.push(d.p1id),o.push(d.p2id),d.id!==void 0&&l.push(d.id)):(i.push(d.p1id),i.push(d.p2id))}),t.forEach(d=>{const m=i.indexOf(d)>=0,p=o.indexOf(d)>=0;!m&&!p&&o.push(d)}),{unmatchedPlayers:o,gamesToDelete:l,byeGames:r}};function me(e,t,a=!1){const{presentPlayers:n,absentPlayers:o}=io(e),{unmatchedPlayers:i,gamesToDelete:l,byeGames:r}=lo(t,n,o,a);return{unmatchedPlayers:i,gamesToDelete:l,byeGames:r}}const $s=(e,t)=>a=>a.p1id==e&&a.p2id==t||a.p1id==t&&a.p2id==e;function co(e,t){const a=n=>typeof n=="number"?n:n==null?void 0:n.id;for(let n=0;n<e.length;n+=2){let o=t.find($s(a(e[n]),a(e[n+1]))),i=n+2;for(;o!=null&&i<e.length;)[e[n+1],e[i]]=[e[i],e[n+1]],o=t.find($s(a(e[n]),a(e[n+1]))),i+=1}}function Jt(e,t,a=4,n=!0,o=!1){let i,l,r,d;const m=[];if(e==null||t==null){i=4,l=4;for(let p=0;p<a;p++)m.push({p1points:1,p2points:1})}else if(n){const p=e>t?.55:.45;i=l=0,r=d=0;for(let u=0;u<a;u++)if(Math.random()<.02){i+=1,l+=1,m.push({p1points:1,p2points:1});const h=Math.floor(Math.random()*5);r+=h,d+=h}else if(Math.random()<p){i+=2,m.push({p1points:2,p2points:0});const h=Math.floor(Math.random()*5);r=h,d=Math.floor(Math.random()*h)}else{l+=2,m.push({p1points:0,p2points:2});const h=Math.floor(Math.random()*5);d=h,r=Math.floor(Math.random()*h)}if(o&&i==l&&r==d){const u=Math.floor(Math.random()*5);Math.random()<.5?(i+=2,r+=u,d+=Math.floor(Math.random()*u)):(l+=2,d+=u,r+=Math.floor(Math.random()*u))}}return{p1points:i,p2points:l,p1twenties:r,p2twenties:d,gameRounds:m}}function ps(e,t){const a=o=>typeof o=="number"?o:(o==null?void 0:o.id)==null?Number.NEGATIVE_INFINITY:o.id;if(t.length==0)return be(e);const n={};return t.forEach(o=>{if(o.p1id!=null){const i=n[o.p1id]=n[o.p1id]||{points:0,twenties:0,wins:0,draws:0};i.points+=o.p1points||0,i.twenties+=o.p1twenties||0;const l=ee(o);o.p1id==l?i.wins+=1:o.p2id==null&&(i.draws+=1)}if(o.p2id!=null){const i=n[o.p2id]=n[o.p2id]||{points:0,twenties:0,wins:0,draws:0};i.points+=o.p2points||0,i.twenties+=o.p2twenties||0;const l=ee(o);o.p2id==l?i.wins+=1:o.p2id==null&&(i.draws+=1)}}),e.sort((o,i)=>{const l=a(o),r=a(i),d=n[l]||{points:0,twenties:0,wins:0,draws:0},m=n[r]||{points:0,twenties:0,wins:0,draws:0};return d.points>m.points?-1:d.points<m.points?1:d.twenties>m.twenties?-1:d.twenties<m.twenties?1:d.wins>m.wins?-1:d.wins<m.wins?1:d.draws>m.draws?-1:d.draws<m.draws?1:0}),e}const mo=(e,t,a=[],n=4,o=!1)=>{const i=[];if(t.length%2!=0&&t.push(void 0),e===0)be(t);else{const l=a.filter(r=>r.stage=="seed"&&r.round<e);ps(t,l),co(t,l)}for(let l=0;l<t.length;l+=2){let r=t[l],d=t[l+1];r==null&&([r,d]=[d,r]);const{p1points:m,p2points:p,p1twenties:u,p2twenties:h,gameRounds:k}=Jt(r,d,n,o);i.push({stage:"seed",round:e,n:l/2,p1id:r,p2id:d,p1points:m,p2points:p,p1twenties:u,p2twenties:h,gameRounds:k})}return i},hs=(e,t,a=[],n=4,o=!1,i=!0)=>{const l=a.filter(p=>p.stage=="seed"&&p.round==e),{unmatchedPlayers:r,gamesToDelete:d}=me(t,l,!i);return{gamesToAdd:mo(e,r,a,n,o),gamesToDelete:d}},uo=(e,t=4)=>{const a=[],{unmatchedPlayers:n}=me(e,[]),o=De(n.length);for(let i=0;i<o;i++){const{gamesToAdd:r}=hs(i,e,a,t,!0);r.forEach(d=>a.push(d))}return{gamesToAdd:a,nRounds:o}},fo=Xa,po=Za,qt=c.forwardRef(({className:e,align:t="center",sideOffset:a=4,...n},o)=>s.jsx(Ya,{children:s.jsx(pt,{ref:o,align:t,sideOffset:a,className:f("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));qt.displayName=pt.displayName;function Ts({game:e,rn:t,pn:a,onClick:n,disabled:o,small:i}){var h;const l=(h=e.gameRounds)==null?void 0:h[t];let r=isNaN((l==null?void 0:l.p1points)||NaN)&&isNaN((l==null?void 0:l.p2points)||NaN)?"?":((l==null?void 0:l.p1points)||0)>((l==null?void 0:l.p2points)||0)?"win":((l==null?void 0:l.p1points)||0)<((l==null?void 0:l.p2points)||0)?"loss":"draw";a==2&&(r=r=="win"?"loss":r=="loss"?"win":r);const d="",m="",p="w-9 justify-center uppercase text-white",u={win:"bg-emerald-700 hover:bg-emerald-600",loss:"bg-rose-800 hover:bg-rose-700",draw:"bg-slate-500 hover:bg-slate-400","?":"bg-slate-300 hover:bg-slate-200"};return s.jsx(E,{onClick:n,disabled:o,className:f(p,u[r],i?m:d),children:r.substring(0,1)})}const re="1.25em",we=e=>`calc(${re}*${e})`,ho=()=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:we(.85),height:we(.85),viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("circle",{cx:"12",cy:"12",r:"10"})}),xo=()=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:re,height:re,viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"})}),bo=()=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:re,height:re,viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41l-7.59-7.59a2.41 2.41 0 0 0-3.41 0Z"})}),go=()=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:we(.9),height:we(.9),viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"})});function vo({i:e=0}){const t=[ho,xo,bo,go],a=t[Math.abs(e)%t.length];return s.jsx(a,{})}const As=["text-red-500","text-orange-500","text-amber-500","text-yellow-500","text-lime-500","text-green-500","text-teal-500","text-cyan-500","text-sky-500","text-blue-500","text-indigo-500","text-violet-500","text-purple-500","text-fuchsia-500","text-pink-500","text-rose-500"];function xs({player:e,className:t,empty:a="bye",noshape:n=!0,winner:o}){const i="text-slate-300",l=e==null?void 0:e.id,r=l?As[l%As.length]:i,d=(e==null?void 0:e.present)===!1;return s.jsxs("div",{className:f(t,"flex text-left gap-1 items-center",!n&&"w-48",o&&""),children:[s.jsx("span",{className:f("h-2 w-2 shrink-0 rounded-full",!e||d?"border border-slate-400":"bg-sky-400")}),s.jsx("span",{className:f("truncate",n?"w-40 sm:w-48":"w-36 sm:w-44",!(e!=null&&e.alias||e!=null&&e.name||d||o===!1)&&"text-muted-foreground"),children:(e==null?void 0:e.alias)||(e==null?void 0:e.name)||a}),n?void 0:s.jsx("span",{className:f("w-4 shrink-0",r,!e&&"invisible"),children:s.jsx(vo,{i:l})})]})}function wo({game:e,noshape:t}){const{findPlayer:a}=c.useContext(le),n=a(e.p1id),o=a(e.p2id);return s.jsx(E,{className:"py-0 px-0 block w-fit h-fit",variant:"outline",children:[n,o].map((i,l)=>s.jsx("span",{children:s.jsx(xs,{className:f("py-2 px-2",!l&&"border-b"),player:i,noshape:t})},i!==void 0?i.id:`bye-${l}`))},e.id)}function Kt({trigger:e,game:t,readonly:a,numRounds:n=4}){const{findPlayer:o}=c.useContext(le),i=o(t.p1id),l=o(t.p2id),r=a||!i||!l,[d,m]=c.useState(t.p1points),[p,u]=c.useState(t.p2points),[h,k]=c.useState(t.p1twenties),[x,g]=c.useState(t.p2twenties);c.useEffect(()=>{m(t.p1points),u(t.p2points),k(t.p1twenties),g(t.p2twenties)},[t]),c.useEffect(()=>{a||(!i||!l)&&(t.gameRounds=new Array(n).fill({p1points:1,p2points:1}),y(t))},[i,l,a]);const N=()=>(t.gameRounds||[]).reduce(([C,A],P)=>[C+((P==null?void 0:P.p1points)||0),A+(P==null?void 0:P.p2points)],[0,0]),y=async j=>{[j.p1points,j.p2points]=N(),j.p1points==0&&j.p2points==0&&(j.p1points=j.p2points=void 0),j.id==null?await R.games.add(j):await R.games.update(j.id,j)},S=(j,C)=>{C=isNaN(C||NaN)?void 0:C,j==1?(m(C),t.p1points=C):(u(C),t.p2points=C),y(t)},b=(j,C)=>{C=isNaN(C||NaN)?void 0:C,j==1?(k(C),t.p1twenties=C):(g(C),t.p2twenties=C),y(t)},v=(j,C,A)=>{t.gameRounds||(t.gameRounds=Array(C)),t.gameRounds[C]||(t.gameRounds[C]={p1points:0,p2points:0});const P=[{p1points:0,p2points:0},{p1points:2,p2points:0},{p1points:0,p2points:2},{p1points:1,p2points:1}],D=t.gameRounds[C].p1points*10+t.gameRounds[C].p2points;let M=0;switch(`p${j}-${D}`){case"p1-0":M=1;break;case"p1-20":M=2;break;case"p1-2":M=3;break;case"p1-11":M=0;break;case"p2-0":M=2;break;case"p2-2":M=1;break;case"p2-20":M=3;break;case"p2-11":M=0;break}t.gameRounds[C]=P[M],t.gameRounds=t.gameRounds.slice(0,A),y(t)};e=e||s.jsx(wo,{game:t});const w=[{player:i,points:d,twenties:h},{player:l,points:p,twenties:x}],$=oo(t,n);return s.jsxs(fo,{children:[s.jsx(po,{asChild:!0,children:e}),s.jsx(qt,{className:"w-60 sm:w-fit p-0 divide-y text-sm",children:w.map(({player:j,points:C,twenties:A},P)=>{const D=P+1,M=!j;return s.jsx("div",{className:"p-2 sm:px-3 sm:py-1",children:s.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[s.jsx("div",{className:f("w-56 sm:w-40 font-bold truncate",M&&"text-muted-foreground"),children:(j==null?void 0:j.alias)||(j==null?void 0:j.name)||"bye"}),s.jsxs("div",{className:f("flex gap-1 items-center",M&&"invisible"),children:[ss(n).map(L=>s.jsx("div",{className:"game",children:s.jsx(Ts,{small:a,disabled:r,game:t,rn:L,pn:D,onClick:()=>v(D,L,n)})},L)),t.stage=="elim"?s.jsx("div",{className:f("game",!$&&"invisible"),children:s.jsx(Ts,{small:a,disabled:r,game:t,rn:n,pn:D,onClick:()=>v(D,n,n+1)})}):void 0]}),s.jsxs("div",{className:f("flex gap-1 items-center",M&&"invisible"),children:[s.jsx(B,{readOnly:!0,disabled:r,id:"points",className:"w-10 pl-1 text-right",onChange:L=>S(D,parseInt(L.target.value)),value:isNaN(C||NaN)?"":C})," ",s.jsx("span",{className:"text-muted-foreground",children:"pts"}),s.jsx(B,{disabled:r,id:"twenties",className:"w-10 pl-1 text-right",onChange:L=>b(D,parseInt(L.target.value)),value:isNaN(A||NaN)?"":A})," ",s.jsx("span",{className:"text-muted-foreground",children:"20s"})]})]},P)},D)})})]})}const jo=({game:e,hasNextRound:t})=>{const{players:a}=_(),n=e?a.find(h=>h.id==(e==null?void 0:e.p1id)):void 0,o=e?a.find(h=>h.id==(e==null?void 0:e.p2id)):void 0,i=ee(e),l=no(e),r=ne(e),d=h=>!r&&i!=null&&i==(h==null?void 0:h.id)||l,m=h=>!r&&i!=null&&i!=(h==null?void 0:h.id),p="bg-slate-300 bg-opacity-50",u="text-muted-foreground";return s.jsx(Kt,{readonly:t,game:e,trigger:s.jsx(E,{className:"py-0 px-0 block w-fit h-fit",variant:"outline",children:[n,o].map((h,k)=>s.jsx("span",{children:s.jsx(xs,{className:f("py-2 px-2",!k&&"border-b",d(h)&&p,m(h)&&u),player:h})},h!==void 0?h.id:`bye-${k}`))},e.id)},e.id)};function No({stage:e,round:t,nRounds:a}){const{games:n}=us(),{players:o}=_(),[i,l]=c.useState(!1),{thisRound:r,hasNextRound:d}=c.useMemo(()=>{const x=n.filter(y=>y.stage==e&&y.round==t),g=e=="seed"&&t==a-1;let N;return g?N=!!n.find(y=>y.stage=="elim"&&y.round==0):N=!!n.find(y=>y.stage==e&&y.round==t+1),{thisRound:x,hasNextRound:N}},[n,a,t,e]),{canResetMatches:m,canAddMatches:p,canDeleteMatches:u}=c.useMemo(()=>{const x=r.find(w=>ve(w)?!1:Ht(w)),g=!d&&!x,{unmatchedPlayers:N,gamesToDelete:y,byeGames:S}=me(o,r),b=e=="seed"&&!d&&N.length>1,v=e=="seed"&&!d&&y.length-S.length>0;return{canResetMatches:g,canAddMatches:b,canDeleteMatches:v}},[r,d,o,e]),h=()=>{m&&(l(!0),R.games.bulkDelete(r.map(x=>x.id)).finally(()=>{setTimeout(()=>l(!1),750)}))},k=()=>{if(!p&&!u)return;l(!0);const{gamesToDelete:x,gamesToAdd:g}=hs(t,o,n,a);R.games.bulkDelete(x).then(()=>R.games.bulkAdd(g)).finally(()=>{setTimeout(()=>l(!1),750)})};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-2 w-full text-sm text-center text-muted-foreground",children:["Round ",t+1]}),s.jsx("div",{className:"p-1 flex flex-wrap gap-2 justify-center",children:r.map(x=>s.jsx(jo,{game:x,hasNextRound:d},x.id))}),p||u?s.jsx("div",{className:"p-1 flex justify-center",children:s.jsxs(oe,{className:"max-w-80 sm:max-w-md sm:w-md flex gap-2 items-center justify-between",children:[s.jsx("div",{children:s.jsx(se,{children:p?"There are unmatched players.":"Some matches have abset players."})}),s.jsxs(Y,{variant:"secondary",working:i,onClick:k,children:[p?"Add":"Delete"," Matches"]})]})}):void 0,m?s.jsx("div",{className:"p-1 flex justify-center",children:s.jsxs(oe,{className:"max-w-80 sm:max-w-md sm:w-md flex gap-2 items-center justify-between",children:[s.jsx("div",{children:s.jsx(se,{children:"No games have been scored this round."})}),s.jsx(Y,{variant:"secondary",working:i,onClick:h,children:"Reset Matches"})]})}):void 0]})}const yo=(e,t,a,n=[],o=4,i=!1)=>{const l=[];if(e===0){const r=n.filter(p=>p.stage=="seed"),d=Math.pow(2,t-e);ps(a,r);const m=a.slice(0,d);a=[];for(let p=0;p<m.length/2;p++){const u=m[p],h=m[d-1-p];a.push(u),a.push(h)}}else a=n.filter(m=>m.stage=="elim"&&m.round==e-1).reduce((m,p)=>{const u=ee(p);return u!=null&&m.push(u),m},[]);a.length%2!=0&&a.push(void 0);for(let r=0;r<a.length;r+=2){let d=a[r],m=a[r+1];d==null&&([d,m]=[m,d]);const{p1points:p,p2points:u,p1twenties:h,p2twenties:k,gameRounds:x}=Jt(d,m,o,i);l.push({stage:"elim",round:e,n:r/2,p1id:d,p2id:m,p1points:p,p2points:u,p1twenties:h,p2twenties:k,gameRounds:x})}return l},Yt=(e,t,a,n=[],o=4,i=!1)=>{const l=n.filter(u=>u.stage=="elim"&&u.round>=e),r=!1,{unmatchedPlayers:d,gamesToDelete:m}=me(a,l,r);return{gamesToAdd:yo(e,t,d,n,o,i),gamesToDelete:m}},ko=(e,t,a=4)=>{const n=[...t],o=[],{unmatchedPlayers:i}=me(e,[]),l=Ee(i.length);for(let r=0;r<l;r++){const d=r<l-1,{gamesToAdd:m}=Yt(r,l,e,n,a,d);m.forEach(p=>{n.push(p),o.push(p)})}return{gamesToAdd:o,nRounds:l}},Ps=({isStartElim:e})=>s.jsxs(oe,{className:"text-left max-w-80 sm:max-w-md sm:w-md mb-4",children:[s.jsx(fs,{children:"Heads up!"}),s.jsxs(se,{children:["There are unscored games in the last ",e?"seed":void 0," round."]})]}),Xt=c.forwardRef(({className:e,...t},a)=>s.jsx(ht,{className:f("grid gap-2",e),...t,ref:a}));Xt.displayName=ht.displayName;const Zt=c.forwardRef(({className:e,...t},a)=>s.jsx(xt,{ref:a,className:f("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:s.jsx(Qa,{className:"flex items-center justify-center",children:s.jsx(Ze,{className:"h-3.5 w-3.5 fill-primary"})})}));Zt.displayName=xt.displayName;const Co=({nPresent:e,value:t,onValueChange:a,className:n})=>{const o=Ee(e),i=Math.floor(Math.log2(e));return s.jsx(Xt,{className:n,value:t.toString(),onValueChange:l=>a(parseInt(l)),children:ss(i).reverse().map(l=>{const r=l+1,d=Math.pow(2,r);return s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Zt,{value:`${r}`,id:`r${r}`}),s.jsxs(W,{htmlFor:`r${r}`,children:["Top ",d," Players â¢ ",r," Round",r>1?"s":void 0,o==r?s.jsx("span",{className:"text-muted-foreground italic",children:" Recommended"}):void 0]})]},r)})})},So=({nPresent:e})=>{const t=De(e);return s.jsxs(oe,{className:"text-left max-w-80 sm:max-w-md sm:w-md mb-4",children:[s.jsx(fs,{children:"Heads up!"}),s.jsxs(se,{children:["There are not enough seed rounds to rank ",e," players completely.",s.jsxs(se,{className:"mt-1",children:[t," seed rounds are recommended."]})]})]})};function Ro(){const[e,t]=c.useState(),[a,n]=c.useState(0),{games:o}=us(),{players:i,nPresent:l}=_(),[r,d]=c.useState(!1),[m,p]=c.useState(0),[u,h]=c.useState("seed"),k=m==0;c.useEffect(()=>{e&&(n(e.selectedScrollSnap()),e.on("select",()=>n(e.selectedScrollSnap())))},[e]),c.useEffect(()=>{if(!k)return;const A=Math.max(Ee(l),0);p(A)},[l,k]);const{nSeedRounds:x,nElimRounds:g,isLastSeedUnscored:N,isLastElimUnscored:y,atEnd:S}=c.useMemo(()=>{let A=0,P=0;o.forEach(T=>{T.stage=="seed"?A=Math.max(A,T.round+1):P=Math.max(P,T.round+1)});const D=!!o.find(T=>T.stage=="seed"&&T.round==A-1&&ne(T)),M=!!o.find(T=>T.stage=="elim"&&T.round==P-1&&ne(T)),L=o.filter(T=>T.stage=="elim"&&T.round==P-1).length==1;return{nSeedRounds:A,nElimRounds:P,isLastSeedUnscored:D,isLastElimUnscored:M,atEnd:L}},[o]),b=u=="seed"?x:g,v=u=="seed"?N:y,w=u=="seed"?g==0:!S,$=De(l),j=A=>{h(A);const P=A=="seed"?x-(N?1:0):g-(y?1:0);e==null||e.scrollTo(0,!0),setTimeout(()=>e==null?void 0:e.scrollTo(P),100)},C=A=>{if(d(!0),u=="seed"){const{gamesToAdd:D}=hs(A,i,o,4);R.games.bulkAdd(D).finally(()=>setTimeout(()=>d(!1),750))}else{const{gamesToAdd:D}=Yt(A,m,i,o,4);R.games.bulkAdd(D).finally(()=>setTimeout(()=>d(!1),750))}};return s.jsxs(ie,{children:[s.jsxs(Re,{id:"matches-title",title:"Matches",children:[s.jsx("p",{children:"The first stage is made up of seed rounds where players are matched randomly in the first round, then against players they haven't yet been matched against, with similar scores if possible."}),s.jsx("p",{children:"The second stage is a set of elimination rounds where top players are matched based on their ranking from the seed rounds."})]}),s.jsx(so,{value:u,onValueChange:j,className:"w-full flex justify-center",children:s.jsxs(Ut,{className:"grid w-80 grid-cols-2 mx-1",children:[s.jsx(Je,{value:"seed",children:"Seed"}),s.jsx(Je,{value:"elim",children:"Elimination"})]})}),s.jsx("div",{className:"flex  justify-center",children:s.jsxs(Bt,{className:"w-full",setApi:t,children:[b?s.jsxs(He,{children:[ss(b).map(A=>s.jsx(xe,{className:"min-h-80",children:s.jsx(No,{stage:u,round:A,nRounds:b})},A)),w?s.jsx(xe,{className:"p-1 pt-4 flex flex-wrap gap-2 justify-center items-start sm:items-center min-h-80",children:s.jsxs("div",{className:"text-center",children:[v?s.jsx(Ps,{}):void 0,l==1?s.jsx("p",{children:"There is only 1 player present."}):u=="seed"?s.jsxs("p",{children:["There are ",l," players present."]}):void 0,l<2?s.jsxs("p",{children:["Use the ",s.jsx(V,{className:"font-bold hover:underline",to:"/players",children:"Players"})," page to add players."]}):u=="seed"||!v?s.jsxs(Y,{working:r,onClick:()=>C(b),children:["Start ",u=="seed"?"Seed":"Elimination"," Round ",b+1]}):void 0]})}):void 0]}):s.jsx(He,{children:s.jsx(xe,{className:"p-1 pt-4 flex flex-wrap gap-2 justify-center items-start sm:items-center min-h-80",children:s.jsxs("div",{className:"text-center",children:[u=="elim"&&g==0&&x<$?s.jsx(So,{nPresent:l}):void 0,u=="elim"&&a==0&&N?s.jsx(Ps,{isStartElim:!0}):void 0,l==0?s.jsx("p",{children:"There are no players present."}):void 0,l==1?s.jsx("p",{children:"There is only 1 player present."}):void 0,l<2?s.jsxs("p",{children:["Use the ",s.jsx(V,{className:"font-bold hover:underline",to:"/players",children:"Players"})," page to add players."]}):s.jsxs(s.Fragment,{children:[s.jsxs(Y,{disabled:u=="elim"&&!m,working:r,onClick:()=>C(0),children:["Start ",u=="seed"?"Tournament":"Elimination"]}),u=="seed"&&l>1?s.jsx("div",{children:s.jsxs(W,{children:[l," players â¢ ",Math.ceil(l/2)," match",l!=2?"es":void 0]})}):void 0,u=="elim"?s.jsx("div",{className:"max-w-80 m-auto",children:s.jsx(Co,{className:"mt-4",nPresent:l,value:m,onValueChange:p})}):void 0]})]})})}),s.jsx(Ot,{className:"hidden md:inline-flex"}),s.jsx(Wt,{className:"hidden md:inline-flex"})]})})]})}const Qt=c.forwardRef(({className:e,...t},a)=>s.jsx("div",{className:"relative w-full overflow-auto",children:s.jsx("table",{ref:a,className:f("w-full caption-bottom text-sm",e),...t})}));Qt.displayName="Table";const ea=c.forwardRef(({className:e,...t},a)=>s.jsx("thead",{ref:a,className:f("[&_tr]:border-b",e),...t}));ea.displayName="TableHeader";const sa=c.forwardRef(({className:e,...t},a)=>s.jsx("tbody",{ref:a,className:f("[&_tr:last-child]:border-0",e),...t}));sa.displayName="TableBody";const $o=c.forwardRef(({className:e,...t},a)=>s.jsx("tfoot",{ref:a,className:f("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));$o.displayName="TableFooter";const qe=c.forwardRef(({className:e,...t},a)=>s.jsx("tr",{ref:a,className:f("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));qe.displayName="TableRow";const H=c.forwardRef(({className:e,...t},a)=>s.jsx("th",{ref:a,className:f("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t}));H.displayName="TableHead";const J=c.forwardRef(({className:e,...t},a)=>s.jsx("td",{ref:a,className:f("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t}));J.displayName="TableCell";const To=c.forwardRef(({className:e,...t},a)=>s.jsx("caption",{ref:a,className:f("mt-4 text-sm text-muted-foreground",e),...t}));To.displayName="TableCaption";function Ao(e,t,a){let n=0,o=0,i=0;return{wld:a.reduce((r,d)=>{if(d.stage!=t)return r;if(d.p1id==e.id){n+=d.p1points||0,o+=d.p1twenties||0;const m=ve(d),p=ee(d);m?r.push({wld:"bye",game:d}):p==e.id?(r.push({wld:"win",game:d}),i+=1):p!=null?r.push({wld:"loss",game:d}):r.push({wld:"draw",game:d})}else if(d.p2id==e.id){n+=d.p2points||0,o+=d.p2twenties||0;const m=ve(d),p=ee(d);m?r.push({wld:"bye",game:d}):p==e.id?(r.push({wld:"win",game:d}),i+=1):p!=null?r.push({wld:"loss",game:d}):r.push({wld:"draw",game:d})}return r},[]),points:n,twenties:o,wins:i}}function Ms({wld:e}){const t="w-6 h-5 px-0 justify-center uppercase text-white",a={win:"bg-emerald-700 hover:bg-emerald-600",loss:"bg-rose-800 hover:bg-rose-700",draw:"bg-slate-500 hover:bg-slate-400",bye:"bg-slate-400 hover:bg-slate-300"};return s.jsx("div",{className:"flex flex-wrap gap-1 -ml-1 sm:w-60",children:e.map((n,o)=>s.jsx(Kt,{readonly:!0,game:n.game,trigger:s.jsx(E,{className:f(t,a[n.wld]),children:n.wld.substring(0,1)},o)},o))})}function Po(){const{players:e,games:t}=K(async()=>{const a=await R.players.filter(o=>!!o.present).toArray(),n=await R.games.where("stage").equals("seed").toArray();return ps(a,n),{players:a,games:n}})||{players:[],games:[]};return s.jsx(kt,{players:e,children:s.jsxs(ie,{children:[s.jsxs(Re,{id:"rankings-page",title:"Rankings",children:[s.jsx("p",{children:"Players are ranked based on their win-loss-draw record. Players get 2 points for a win, 1 point for a draw, and no points for a loss."}),s.jsx("p",{children:"Ties are broken by the total number of twenties scored."})]}),s.jsxs(ds,{children:[s.jsxs(Qt,{className:"w-full",children:[s.jsx(ea,{children:s.jsxs(qe,{className:"hidden sm:table-row",children:[s.jsx(H,{className:"text-right w-2",children:s.jsx("span",{className:"hidden sm:inline",children:"Rank"})}),s.jsx(H,{children:"Name"}),s.jsx(H,{className:"sm:w-3 hidden sm:table-cell",children:"Record"}),s.jsx(H,{className:"hidden sm:table-cell text-right",children:"Points"}),s.jsx(H,{className:"hidden sm:table-cell text-right",children:"20s"}),s.jsx(H,{className:"sm:hidden table-cell text-right"})]})}),s.jsx(sa,{children:e.map((a,n)=>{const{wld:o,points:i,twenties:l}=Ao(a,"seed",t);return s.jsxs(qe,{children:[s.jsxs(J,{className:"text-right w-2",children:[n+1,"."]}),s.jsx(J,{className:"sm:max-w-none",children:s.jsxs("div",{className:"flex flex-wrap space-x-2 space-y-2",children:[s.jsx(xs,{player:a}),s.jsx("div",{className:"sm:hidden",children:s.jsx(Ms,{wld:o})})]})}),s.jsx(J,{className:"hidden sm:table-cell",children:s.jsx("div",{className:"flex flex-wrap sm:w-fit flex-wrap sm:flex-nowrap gap-1",children:s.jsx(Ms,{wld:o})})}),s.jsx(J,{className:"hidden sm:table-cell text-right",children:i}),s.jsx(J,{className:"hidden sm:table-cell text-right",children:l}),s.jsx(J,{className:"sm:hidden table-cell text-right",children:s.jsxs("div",{className:"w-14",children:[i," ",s.jsx("span",{className:"text-muted-foreground font-semibold pr-1",children:"pts"}),s.jsx("br",{}),l," ",s.jsx("span",{className:"text-muted-foreground font-semibold",children:"20s"}),s.jsx("br",{})]})})]},a.id)})})]}),e.length==0?s.jsxs("div",{className:"w-full text-center mt-32",children:[s.jsx("p",{children:"There are no players present."}),s.jsxs("p",{children:["Use the ",s.jsx(V,{className:"font-bold hover:underline",to:"/players",children:"Players"})," page to add players."]})]}):void 0]})]})})}function Mo({show:e,onHide:t,onConfirm:a}){return s.jsx(cs,{open:e,onOpenChange:t,children:s.jsxs($e,{children:[s.jsx(Te,{children:"Are you absolutely sure?"}),s.jsx(Ae,{children:"Restoring a previously saved tournament will replace the current one. All current player names, games, scores, and rankings will be lost."}),s.jsxs(de,{className:"gap-1 sm:gap-0",children:[s.jsx(ce,{className:"transition-colors bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:a,children:"Yes, Replace It"}),s.jsx(Pe,{onClick:t,children:"No, Keep It"})]})]})})}const Do=({show:e,onHide:t,details:a})=>s.jsx(en,{open:e,onOpenChange:t,children:s.jsxs(sn,{children:[s.jsx(tn,{children:"The chosen file could not be restored."}),a?s.jsxs(s.Fragment,{children:[s.jsx(an,{children:"See details below."}),s.jsx("pre",{className:"text-wrap",children:a})]}):void 0,s.jsx(de,{children:s.jsx(ce,{onClick:t,children:"Ok, I'll try another file"})})]})}),Eo={$id:"/Game",type:"object",anyOf:[{required:["id","stage","round","n","p1id"]},{required:["id","stage","round","n","p2id"]}],properties:{id:{type:"number"},stage:{type:"string",enum:["seed","elim"]},round:{type:"number"},n:{type:"number"},p1id:{type:"number"},p2id:{type:"number"},p1points:{type:"number"},p2points:{type:"number"},p1twenties:{type:"number"},p2twenties:{type:"number"},gameRounds:{type:"array",items:{type:"object",properties:{p1points:{type:"number"},p2points:{type:"number"}}}}}},Io={$id:"/Player",type:"object",required:["id","name"],properties:{id:{type:"number"},name:{type:"string"},present:{type:"boolean"}}},Lo={type:"object",required:["players"],properties:{players:{type:"array",items:{$ref:"/Player"},minItems:1},games:{type:"array",items:{$ref:"/Game"}}}},Ie=new Sa;Ie.addSchema(Io,"/Player");Ie.addSchema(Eo,"/Game");const zo=Ie.compile(Lo),Go=e=>{const t=e;if(!zo(t))throw new Error(Ie.errorsText());const{players:a,games:n}=t;if(!n)return;const o=new Set,i=d=>{if(o.has(d))return!0;const m=a==null?void 0:a.find(p=>p.id===d);return m&&o.add(m.id),!!m},l=[],r=new Set;if(n.forEach((d,m)=>{d.p1id&&!r.has(d.p1id)&&!i(d.p1id)&&(r.has(d.p1id)||l.push(`instance.games[${m}].p1id is not found in instance.players`),r.add(d.p1id)),d.p2id&&!r.has(d.p2id)&&!i(d.p2id)&&(r.has(d.p2id)||l.push(`instance.games[${m}].p2id is not found in instance.players`),r.add(d.p2id))}),r.size>0)throw new Error(l.map((d,m)=>`${m}: ${d}`).join(`
`))},Fo=({anyData:e})=>{const[t,a]=c.useState(!1),[n,o]=c.useState("crokinole-tourney.json"),[i,l]=c.useState(!1),[r,d]=c.useState(),[m,p]=c.useState(!1),[u,h]=c.useState(),{nPlayers:k}=c.useContext(le),x=async S=>{if(S.preventDefault(),!e)return;a(!0),setTimeout(()=>a(!1),1e3);const b=document.createElement("a"),v=await R.allData();b.href=window.URL.createObjectURL(new Blob([JSON.stringify(v,null,2)])),b.setAttribute("download",n),document.body.appendChild(b),b.click()},g=()=>{if(!r)return;p(!1),l(!0),setTimeout(()=>l(!1),1e3);const S=new FileReader;S.onload=b=>{var v;try{const w=JSON.parse((v=b.target)==null?void 0:v.result);Go(w),R.replace(w)}catch(w){h(w==null?void 0:w.toString())}},S.readAsText(r)},N=async S=>{S.preventDefault(),r!=null&&(e?p(!0):g())},y=S=>{const b=S.target;b.files&&d(b.files[0])};return s.jsxs(q,{children:[s.jsxs(Ce,{children:[s.jsx(Se,{children:"Save and Restore"}),s.jsx(Z,{children:"All data is stored locally and is never uploaded to a server."})]}),s.jsxs("form",{onSubmit:x,children:[s.jsxs(O,{className:"d-flex flex-column flex-lg-row gap-3 flex-wrap justify-content-lg-stretch",children:[s.jsxs("div",{className:"grid w-full items-center gap-2 sm:flex sm:items-end",children:[s.jsxs("div",{className:"flex flex-col space-y-1.5",children:[s.jsx(W,{htmlFor:"save-as",children:"Save As"}),s.jsx(B,{id:"save-as",className:"sm:w-96",disabled:!k,value:n,onChange:S=>o(S.target.value)})]}),s.jsx(Y,{variant:"secondary",disabled:!k,working:t,type:"submit",children:"Save"})]}),k?void 0:s.jsx(Z,{className:"italic",children:"There is no tournament data to save."})]}),s.jsx(O,{className:"flex justify-end"})]}),s.jsx("form",{onSubmit:N,children:s.jsx(O,{className:"d-flex flex-column flex-lg-row gap-3 flex-wrap justify-content-lg-stretch",children:s.jsxs("div",{className:"grid w-full items-center gap-2 sm:flex sm:items-end",children:[s.jsxs("div",{className:"flex flex-col space-y-1.5",children:[s.jsx(W,{htmlFor:"restore-from",children:"Restore From"}),s.jsx(B,{id:"restore-from",className:"sm:w-96",type:"file",onChange:y})]}),s.jsx(Y,{variant:"secondary",disabled:!r,working:i,type:"submit",children:"Restore"})]})})}),s.jsx(Mo,{show:m,onHide:()=>p(!1),onConfirm:g}),s.jsx(Do,{show:!!u,onHide:()=>h(void 0),details:u})]})},ta=c.forwardRef(({className:e,...t},a)=>s.jsx(bt,{ref:a,className:f("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:s.jsx(nn,{className:f("flex items-center justify-center text-current"),children:s.jsx(Ze,{className:"h-4 w-4"})})}));ta.displayName=bt.displayName;const Vo=({anyData:e})=>{const[t,a]=c.useState(!0),n=async()=>await R.reset(t==!0),o="transition-colors bg-destructive text-destructive-foreground hover:bg-destructive/90";return e=!0,s.jsxs(q,{className:"text-sm border-destructive/50 dark:border-destructive [&>svg]:text-destructive",children:[s.jsxs(Ce,{children:[s.jsx(Se,{children:"Danger Zone"}),s.jsxs(Z,{children:[s.jsx("i",{children:"Warning!"})," Resetting the tournament will remove all player names, game match-ups, scores, and ranking."]})]}),s.jsx(O,{children:s.jsxs(cs,{children:[s.jsx(Xn,{asChild:!0,children:s.jsx(E,{className:"text-nowrap",disabled:!e,variant:"destructive",children:e?"Reset Tournament":"No Tournament Data"})}),s.jsxs($e,{children:[s.jsxs(ms,{children:[s.jsx(Te,{children:"Are you absolutely sure?"}),s.jsxs(Ae,{children:["Resetting the tournament will remove all ",t?"":"player names,"," games, scores, and rakings."]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(ta,{id:"keep-players",checked:t,onCheckedChange:i=>a(i)}),s.jsx("label",{htmlFor:"keep-players",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Keep player names"})]}),s.jsxs(de,{className:"gap-2 sm:gap-0",children:[s.jsx(ce,{className:o,onClick:n,children:"Yes, Reset It"}),s.jsx(Pe,{children:"No, Keep It"})]})]})]})})]})},Bo=["Joey Tribbiani","Rachel Green","Monica Geller","Phoebe Buffay","Chandler Bing","Ross Geller","Fraiser Crane","Niles Crane","Daphne Moon","Roz Doyle","Martin Crane","Jerry Seinfeld","George Costanza","Elain Benes","Cosmo Kramer","Fran Fine","Max Sheffield","C.C. Babcock","Niles","Maggie Sheffield","Brighton Sheffield","Gracie Sheffield","Will Truman","Grace Adler","Karen Walker","Jack McFarland","Carrie Bradshaw","Charlotte York","Miranda Hobbes","Samantha Jones","Homer Simpson","Marge Simpson","Bart Simpson","Lisa Simpson","Maggie Simpson","Ned Flanders","Moe Szyslak","Seymour Skinner","Apu Nahasapeemapetilon","Barney Gumble","Clancy Wiggum","Kent Brockman","Jim Kirk","Spock","Montgomery Scott","Leonard McCoy","Nyota Uhura","Hikaru Sulu","Pavel Chekov","Janice Rand","Jean-Luc Picard","William Riker","Geordi La Forge","Tasha Yar","Worf","Beverly Crusher","Diana Troi","Data","Wesley Crusher","Christopher Pike","Christine Chapel","La'an Noonien-Singh","Erica Ortegas","Joseph M'Benga","Una Chin-Riley","Clark Kent","Louis Lane","Jimmy Olsen","Perry White","Lex Luthor","Lana Lang","Vicki Vale","Luke Charles","Heracles Panhellenios","Dane Whitman","Victor Shade","Clint Barton","Peter Parker","Bruce Banner","Steve Rogers","Pietro Maximoff","Thor Odinson","Janet Van Dyne","Hank Pym","Tony Stark","Wanda Maximoff","Carol Danvers","Bucky Barnes","Natasha Romanoff","Sam Wilson","Steven Strange","Jessica Jones","Trish Walker","Maria Hill","Ben Grimm","Matt Murdock","Susan Storm","Reed Richards","Amadeus Cho","Jimmy Howlett","Nick Fury","Phil Coulson","Hubert Wolfeschlegelsteinhausenbergerdorff"];function Oo(e,t=0){const a=be(Bo).slice(0,e).map((n,o)=>({name:n,present:o>=t}));return be(a)}const Wo=(e,t,a,n)=>{n=Math.max(t-n,0);const o=Math.max(Math.max(e-a,n),0),i=Math.min(Math.max(o-n,0),o);return Oo(o,i)};async function Uo(){if(await R.games.count()>0)throw new Error("games already exist in the tournament");const e=await R.players.toArray(),t=e.filter(d=>d.present).length,a=Wo(20,15,e.length,t);await R.players.bulkAdd(a);const n=await R.players.toArray(),{gamesToAdd:o,nRounds:i}=uo(n);await R.games.bulkAdd(o);const{gamesToAdd:l,nRounds:r}=ko(n,o);return await R.games.bulkAdd(l),{nSeedRounds:i,nElimRounds:r}}const _o=({anyGames:e})=>{const[t,a]=c.useState(!1),{nPresent:n}=_(),{setNSeedRounds:o,setNElimRounds:i}=us(),l=async()=>{a(!0);const{nSeedRounds:r,nElimRounds:d}=await Uo().finally(()=>setTimeout(()=>a(!1),750));o(r),i(d)};return s.jsxs(q,{children:[s.jsxs(Ce,{children:[s.jsx(Se,{children:"Demo Tournament"}),s.jsx(Z,{children:"If you have no tournament data, you can generate a random tournament with scores for all the rounds except the final."})]}),s.jsxs(O,{children:[s.jsx(Y,{variant:"secondary",working:t,onClick:l,className:"text-nowrap",disabled:e||n==1,children:"Create Demo Tournament"}),s.jsx(Z,{children:e?s.jsx("span",{className:"text-md italic",children:"Reset the current tournament to create a demo tournament."}):n>1?s.jsxs("span",{className:"text-md italic",children:["Tournament will use ",n," present players."]}):n==1?s.jsxs("span",{className:"text-md italic",children:["There is only ",n," player present."]}):void 0})]})]})};function Ho(){const e=K(async()=>await R.anyData()),t=K(async()=>await R.games.count()>0);return s.jsxs(ie,{children:[s.jsx(Re,{id:"settings-page",title:"Settings",children:s.jsx("p",{children:"Your tournament data will only be stored on your local device. You can export and restore your tournament data to a json file."})}),s.jsxs(ds,{className:"grid gap-2",children:[s.jsx(Fo,{anyData:e}),s.jsx(_o,{anyGames:t}),s.jsx(Vo,{anyData:e})]})]})}function Jo(){const{pathname:e}=Ra();return c.useEffect(()=>{window.scrollTo(0,0)},[e]),null}function qo(){const e=[{label:"Players",path:"players",element:s.jsx(eo,{}),icon:s.jsx(Ye,{strokeWidth:1})},{label:"Matches",path:"matches",element:s.jsx(Ro,{}),icon:s.jsx(Oe,{strokeWidth:1,className:"rotate-90"})},{label:"Rankings",path:"rankings",element:s.jsx(Po,{}),icon:s.jsx(Es,{strokeWidth:1})},{label:"Settings",path:"settings",element:s.jsx(Ho,{}),icon:s.jsx(Aa,{strokeWidth:1})}];return s.jsx(wn,{defaultTheme:"light",children:s.jsx(ao,{children:s.jsxs($a,{basename:"/crokinole-tourney/",children:[s.jsx(Jo,{}),s.jsx(jn,{pages:e}),s.jsxs(Ta,{children:[e.map(t=>s.jsx(Cs,{path:t.path,element:t.element},t.label)),s.jsx(Cs,{path:"/",element:s.jsx(yn,{})})]})]})})})}ha.createRoot(document.getElementById("root")).render(s.jsx(ae.StrictMode,{children:s.jsx(qo,{})}));
